\hypertarget{tsc__service_8cpp_source}{}\doxysection{tsc\+\_\+service.\+cpp}
\label{tsc__service_8cpp_source}\index{tsc\_client\_service/src/tsc\_service.cpp@{tsc\_client\_service/src/tsc\_service.cpp}}
\mbox{\hyperlink{tsc__service_8cpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00001}00001 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{tsc__service_8h}{tsc\_service.h}}"{}}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00002}00002 }
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00003}00003 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespacetraffic__signal__controller__service}{traffic\_signal\_controller\_service}} \{}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00004}00004     }
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00005}00005 }
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00006}\mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_a0f10530cccdd582172877692d6f480f5}{00006}}     \textcolor{keywordtype}{bool} \mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_a0f10530cccdd582172877692d6f480f5}{tsc\_service::initialize}}() \{}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00007}00007         \textcolor{keywordflow}{try}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00008}00008         \{}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00009}00009             \textcolor{comment}{// Intialize spat kafka producer}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00010}00010             std::string bootstrap\_server = \mbox{\hyperlink{classstreets__service_1_1streets__configuration_a03603871626201e07690effb9f2440bf}{streets\_service::streets\_configuration::get\_string\_config}}(\textcolor{stringliteral}{"{}bootstrap\_server"{}});}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00011}00011             std::string spat\_topic\_name = \mbox{\hyperlink{classstreets__service_1_1streets__configuration_a03603871626201e07690effb9f2440bf}{streets\_service::streets\_configuration::get\_string\_config}}(\textcolor{stringliteral}{"{}spat\_producer\_topic"{}});}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00012}00012             \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_ac8b524b54e3db0a25765546e2c136dd2}{initialize\_kafka\_producer}}(bootstrap\_server, spat\_topic\_name)) \{}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00013}00013                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00014}00014             \}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00015}00015             }
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00016}00016             \textcolor{comment}{// Initialize SNMP Client}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00017}00017             std::string target\_ip = \mbox{\hyperlink{classstreets__service_1_1streets__configuration_a03603871626201e07690effb9f2440bf}{streets\_service::streets\_configuration::get\_string\_config}}(\textcolor{stringliteral}{"{}target\_ip"{}});}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00018}00018             \textcolor{keywordtype}{int} target\_port = \mbox{\hyperlink{classstreets__service_1_1streets__configuration_ab33a5d183c0ca2b2f0d757f5466f200b}{streets\_service::streets\_configuration::get\_int\_config}}(\textcolor{stringliteral}{"{}target\_port"{}});}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00019}00019             std::string community = \mbox{\hyperlink{classstreets__service_1_1streets__configuration_a03603871626201e07690effb9f2440bf}{streets\_service::streets\_configuration::get\_string\_config}}(\textcolor{stringliteral}{"{}community"{}});}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00020}00020             \textcolor{keywordtype}{int} snmp\_version = \mbox{\hyperlink{classstreets__service_1_1streets__configuration_ab33a5d183c0ca2b2f0d757f5466f200b}{streets\_service::streets\_configuration::get\_int\_config}}(\textcolor{stringliteral}{"{}snmp\_version"{}});}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00021}00021             \textcolor{keywordtype}{int} timeout = \mbox{\hyperlink{classstreets__service_1_1streets__configuration_ab33a5d183c0ca2b2f0d757f5466f200b}{streets\_service::streets\_configuration::get\_int\_config}}(\textcolor{stringliteral}{"{}timeout"{}});}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00022}00022             \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_a0bbce68544a01f99199a07fb642342f9}{initialize\_snmp\_client}}(target\_ip, target\_port, community, snmp\_version, timeout)) \{}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00023}00023                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00024}00024             \}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00025}00025             \textcolor{comment}{//Initialize TSC State}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00026}00026             \mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_a8612905672ceede1d032fd1123c2f484}{use\_tsc\_state\_spat\_update\_}} = \mbox{\hyperlink{classstreets__service_1_1streets__configuration_a48f38b0b6ecb3043cc051b624f12824b}{streets\_service::streets\_configuration::get\_boolean\_config}}(\textcolor{stringliteral}{"{}use\_tsc\_state\_spat\_update"{}});}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00027}00027             \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_adad711d135587e232d5cd92447b9a5af}{initialize\_tsc\_state}}(\mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_a9e901a004e42f8fd670d54e16f4fb3bb}{snmp\_client\_ptr}}))\{}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00028}00028                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00029}00029             \}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00030}00030             \textcolor{comment}{// Enable SPaT}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00031}00031             \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_a34c50831f1ed8f48d8123b05b6724b32}{enable\_spat}}()) \{}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00032}00032                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00033}00033             \}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00034}00034             \textcolor{comment}{// Initialize spat\_worker}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00035}00035             std::string socket\_ip = \mbox{\hyperlink{classstreets__service_1_1streets__configuration_a03603871626201e07690effb9f2440bf}{streets\_service::streets\_configuration::get\_string\_config}}(\textcolor{stringliteral}{"{}udp\_socket\_ip"{}});}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00036}00036             \textcolor{keywordtype}{int} socket\_port = \mbox{\hyperlink{classstreets__service_1_1streets__configuration_ab33a5d183c0ca2b2f0d757f5466f200b}{streets\_service::streets\_configuration::get\_int\_config}}(\textcolor{stringliteral}{"{}udp\_socket\_port"{}});}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00037}00037             \textcolor{keywordtype}{int} socket\_timeout = \mbox{\hyperlink{classstreets__service_1_1streets__configuration_ab33a5d183c0ca2b2f0d757f5466f200b}{streets\_service::streets\_configuration::get\_int\_config}}(\textcolor{stringliteral}{"{}socket\_timeout"{}});}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00038}00038             \textcolor{keywordtype}{bool} use\_msg\_timestamp =  \mbox{\hyperlink{classstreets__service_1_1streets__configuration_a48f38b0b6ecb3043cc051b624f12824b}{streets\_service::streets\_configuration::get\_boolean\_config}}(\textcolor{stringliteral}{"{}use\_tsc\_timestamp"{}});         }
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00039}00039             \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_a470c3a6c64e310bc4ac0da205a2aeafb}{initialize\_spat\_worker}}(socket\_ip, socket\_port, socket\_timeout, use\_msg\_timestamp)) \{}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00040}00040                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00041}00041             \}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00042}00042             \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_aac8bd449d953386ac8db45dd89a5ec4d}{initialize\_intersection\_client}}()) \{}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00043}00043                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00044}00044             \}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00045}00045             \textcolor{comment}{// Add all phases to a single map}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00046}00046             \textcolor{keyword}{auto} all\_phases = \mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_a26027ff7d1a2fdf05a67be10543aa1bd}{tsc\_state\_ptr}}-\/>get\_vehicle\_phase\_map();}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00047}00047             \textcolor{keyword}{auto} ped\_phases = \mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_a26027ff7d1a2fdf05a67be10543aa1bd}{tsc\_state\_ptr}}-\/>get\_ped\_phase\_map();}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00048}00048             \textcolor{comment}{// Insert pedestrian phases into map of vehicle phases.}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00049}00049             all\_phases.insert(ped\_phases.begin(), ped\_phases.end());}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00050}00050             \mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_a54e9845c840c058c682e215fe39a6e0c}{initialize\_spat}}(\mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_ab618504f0fe46fe639c43e48f9d6a264}{intersection\_client\_ptr}}-\/>get\_intersection\_name(), \mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_ab618504f0fe46fe639c43e48f9d6a264}{intersection\_client\_ptr}}-\/>get\_intersection\_id(), }
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00051}00051                                 all\_phases);}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00052}00052             }
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00053}00053             \textcolor{comment}{// Initialize spat ptr}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00054}00054             SPDLOG\_INFO(\textcolor{stringliteral}{"{}Traffic Signal Controller Service initialized successfully!"{}});}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00055}00055             \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00056}00056         \}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00057}00057         \textcolor{keywordflow}{catch} (\textcolor{keyword}{const} \mbox{\hyperlink{classstreets__service_1_1streets__configuration__exception}{streets\_service::streets\_configuration\_exception}} \&ex)}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00058}00058         \{}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00059}00059             SPDLOG\_ERROR(\textcolor{stringliteral}{"{}Signal Optimization Service Initialization failure: \{0\} "{}}, ex.what());}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00060}00060             \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00061}00061         \}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00062}00062     \}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00063}00063 }
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00064}\mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_ac8b524b54e3db0a25765546e2c136dd2}{00064}}     \textcolor{keywordtype}{bool} \mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_ac8b524b54e3db0a25765546e2c136dd2}{tsc\_service::initialize\_kafka\_producer}}(\textcolor{keyword}{const} std::string \&bootstrap\_server, \textcolor{keyword}{const} std::string \&spat\_producer\_topc) \{}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00065}00065         \textcolor{keyword}{auto} client = std::make\_unique<kafka\_clients::kafka\_client>();}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00066}00066         \mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_a1dfbd2157cd62094844fb2e1a6d70711}{spat\_producer}} = client-\/>create\_producer(bootstrap\_server, spat\_producer\_topc);}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00067}00067         \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_a1dfbd2157cd62094844fb2e1a6d70711}{spat\_producer}}-\/>init())}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00068}00068         \{}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00069}00069             SPDLOG\_CRITICAL(\textcolor{stringliteral}{"{}Kafka spat producer initialize error"{}});}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00070}00070             \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00071}00071         \}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00072}00072         SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Initialized SPAT Kafka producer!"{}});}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00073}00073         \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00074}00074     \}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00075}00075 }
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00076}\mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_a0bbce68544a01f99199a07fb642342f9}{00076}}     \textcolor{keywordtype}{bool} \mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_a0bbce68544a01f99199a07fb642342f9}{tsc\_service::initialize\_snmp\_client}}(\textcolor{keyword}{const} std::string \&server\_ip, \textcolor{keyword}{const} \textcolor{keywordtype}{int} server\_port, \textcolor{keyword}{const} std::string \&community,}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00077}00077                                         \textcolor{keyword}{const} \textcolor{keywordtype}{int} snmp\_version, \textcolor{keyword}{const} \textcolor{keywordtype}{int} timeout) \{}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00078}00078         \textcolor{keywordflow}{try} \{}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00079}00079             \mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_a9e901a004e42f8fd670d54e16f4fb3bb}{snmp\_client\_ptr}} = std::make\_shared<snmp\_client>(server\_ip, server\_port, community, snmp\_version, timeout);}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00080}00080             SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}SNMP Client initialized!"{}});}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00081}00081             \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00082}00082         \}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00083}00083         \textcolor{keywordflow}{catch} (\textcolor{keyword}{const} \mbox{\hyperlink{classtraffic__signal__controller__service_1_1snmp__client__exception}{snmp\_client\_exception}} \&e) \{}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00084}00084             SPDLOG\_ERROR(\textcolor{stringliteral}{"{}Exception encountered initializing snmp client : \(\backslash\)n \{0\}"{}}, e.what());}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00085}00085             \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00086}00086         \}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00087}00087     \}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00088}00088 }
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00089}\mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_adad711d135587e232d5cd92447b9a5af}{00089}}     \textcolor{keywordtype}{bool} \mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_adad711d135587e232d5cd92447b9a5af}{tsc\_service::initialize\_tsc\_state}}(\textcolor{keyword}{const} std::shared\_ptr<snmp\_client> \_snmp\_client\_ptr ) \{}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00090}00090         \mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_a26027ff7d1a2fdf05a67be10543aa1bd}{tsc\_state\_ptr}} = std::make\_shared<tsc\_state>(\_snmp\_client\_ptr );}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00091}00091         \textcolor{keywordflow}{if} ( !\mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_a26027ff7d1a2fdf05a67be10543aa1bd}{tsc\_state\_ptr}}-\/>initialize() )\{}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00092}00092             SPDLOG\_ERROR(\textcolor{stringliteral}{"{}Failed to initialize tsc\_state!"{}});}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00093}00093             \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00094}00094         \}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00095}00095         SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}TSC State initialized!"{}});}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00096}00096         \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00097}00097     \}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00098}\mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_a34c50831f1ed8f48d8123b05b6724b32}{00098}}     \textcolor{keywordtype}{bool} \mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_a34c50831f1ed8f48d8123b05b6724b32}{tsc\_service::enable\_spat}}()\textcolor{keyword}{ const}\{}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00099}00099         \textcolor{comment}{// Enable SPaT }}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00100}00100         \mbox{\hyperlink{structtraffic__signal__controller__service_1_1snmp__response__obj}{snmp\_response\_obj}} \mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_a34c50831f1ed8f48d8123b05b6724b32}{enable\_spat}};}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00101}00101         \mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_a34c50831f1ed8f48d8123b05b6724b32}{enable\_spat}}.type = \mbox{\hyperlink{structtraffic__signal__controller__service_1_1snmp__response__obj_a7379a4a3fcabddd7000d9be76111c38aa5d5cd46919fa987731fb2edefe0f2a0c}{snmp\_response\_obj::response\_type::INTEGER}};}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00102}00102         \mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_a34c50831f1ed8f48d8123b05b6724b32}{enable\_spat}}.val\_int = 2;}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00103}00103         \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_a9e901a004e42f8fd670d54e16f4fb3bb}{snmp\_client\_ptr}}-\/>process\_snmp\_request(\mbox{\hyperlink{namespacentcip__oids_ab1f88eabb00f61c8b06fea2deae959b5}{ntcip\_oids::ENABLE\_SPAT\_OID}}, \mbox{\hyperlink{namespacetraffic__signal__controller__service_aa91e53dd22b41ddac648a9b468615b61a8c52684db8f49511e9b44471716bf164}{request\_type::SET}}, \mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_a34c50831f1ed8f48d8123b05b6724b32}{enable\_spat}}))\{}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00104}00104             SPDLOG\_ERROR(\textcolor{stringliteral}{"{}Failed to enable SPaT broadcasting on Traffic Signal Controller!"{}});}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00105}00105             \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00106}00106         \}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00107}00107         SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Enabled UDP broadcasting of NTCIP SPaT data from TSC!"{}});}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00108}00108         \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00109}00109     \}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00110}00110 }
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00111}\mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_a470c3a6c64e310bc4ac0da205a2aeafb}{00111}}     \textcolor{keywordtype}{bool} \mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_a470c3a6c64e310bc4ac0da205a2aeafb}{tsc\_service::initialize\_spat\_worker}}(\textcolor{keyword}{const} std::string \&udp\_socket\_ip, \textcolor{keyword}{const} \textcolor{keywordtype}{int} udp\_socket\_port, }
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00112}00112                                         \textcolor{keyword}{const} \textcolor{keywordtype}{int} timeout, \textcolor{keyword}{const} \textcolor{keywordtype}{bool} use\_tsc\_timestamp) \{}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00113}00113         \mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_a390a1495b441c84b4ad620113635556f}{spat\_worker\_ptr}} = std::make\_shared<spat\_worker>(udp\_socket\_ip, udp\_socket\_port, timeout, use\_tsc\_timestamp);}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00114}00114         \textcolor{comment}{// HTTP request to update intersection information}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00115}00115         \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_a390a1495b441c84b4ad620113635556f}{spat\_worker\_ptr}}-\/>initialize())}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00116}00116         \{}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00117}00117             SPDLOG\_ERROR(\textcolor{stringliteral}{"{}Failed to initialize spat worker!"{}});}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00118}00118             \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00119}00119         \}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00120}00120         SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Spat worker initialized successfully!"{}});}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00121}00121         \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00122}00122     \}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00123}00123 }
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00124}\mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_aac8bd449d953386ac8db45dd89a5ec4d}{00124}}     \textcolor{keywordtype}{bool} \mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_aac8bd449d953386ac8db45dd89a5ec4d}{tsc\_service::initialize\_intersection\_client}}() \{}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00125}00125         \mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_ab618504f0fe46fe639c43e48f9d6a264}{intersection\_client\_ptr}} = std::make\_shared<intersection\_client>();}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00126}00126         \textcolor{keywordflow}{if} ( !\mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_ab618504f0fe46fe639c43e48f9d6a264}{intersection\_client\_ptr}}-\/>request\_intersection\_info() ) \{}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00127}00127             SPDLOG\_ERROR(\textcolor{stringliteral}{"{}Failed to retrieve intersection information from intersection model!"{}});}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00128}00128             \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00129}00129         \}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00130}00130         SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Intersection client initialized successfully!"{}});}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00131}00131         \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00132}00132     \}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00133}00133     }
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00134}\mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_a54e9845c840c058c682e215fe39a6e0c}{00134}}     \textcolor{keywordtype}{void} \mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_a54e9845c840c058c682e215fe39a6e0c}{tsc\_service::initialize\_spat}}(\textcolor{keyword}{const} std::string \&intersection\_name, \textcolor{keyword}{const} \textcolor{keywordtype}{int} intersection\_id, }
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00135}00135                                 \textcolor{keyword}{const} std::unordered\_map<int,int> \&phase\_number\_to\_signal\_group) \{}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00136}00136         \mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_ae77457ef9ea248e80a34a2a145a59096}{spat\_ptr}} =  std::make\_shared<signal\_phase\_and\_timing::spat>();}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00137}00137         \mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_ae77457ef9ea248e80a34a2a145a59096}{spat\_ptr}}-\/>initialize\_intersection( intersection\_name, intersection\_id, phase\_number\_to\_signal\_group);}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00138}00138     \}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00139}00139 }
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00140}00140 }
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00141}\mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_aa4fb7763e7ae8b9e630fd7fa10bc2479}{00141}}     \textcolor{keywordtype}{void} \mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_aa4fb7763e7ae8b9e630fd7fa10bc2479}{tsc\_service::produce\_spat\_json}}()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00142}00142         \textcolor{keywordflow}{try} \{}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00143}00143             \textcolor{keywordflow}{while}(\textcolor{keyword}{true}) \{}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00144}00144                 \textcolor{keywordflow}{try} \{}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00145}00145                     \mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_a390a1495b441c84b4ad620113635556f}{spat\_worker\_ptr}}-\/>receive\_spat(\mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_ae77457ef9ea248e80a34a2a145a59096}{spat\_ptr}});}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00146}00146                     }
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00147}00147                     \textcolor{keywordflow}{if}(\mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_a8612905672ceede1d032fd1123c2f484}{use\_tsc\_state\_spat\_update\_}})\{}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00148}00148                         \textcolor{keywordflow}{try}\{}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00149}00149                             \mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_a26027ff7d1a2fdf05a67be10543aa1bd}{tsc\_state\_ptr}}-\/>add\_future\_movement\_events(\mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_ae77457ef9ea248e80a34a2a145a59096}{spat\_ptr}});}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00150}00150                         \}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00151}00151                         \textcolor{keywordflow}{catch}(\textcolor{keyword}{const} \mbox{\hyperlink{classtraffic__signal__controller__service_1_1monitor__states__exception}{traffic\_signal\_controller\_service::monitor\_states\_exception}} \&e)\{}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00152}00152                             SPDLOG\_ERROR(\textcolor{stringliteral}{"{}Could not update movement events, spat not published. Encounted exception : \(\backslash\)n \{0\}"{}}, e.what());}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00153}00153                         \}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00154}00154                     \}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00155}00155                     }
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00156}00156                     \mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_a1dfbd2157cd62094844fb2e1a6d70711}{spat\_producer}}-\/>send(\mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_ae77457ef9ea248e80a34a2a145a59096}{spat\_ptr}}-\/>toJson());}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00157}00157                     }
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00158}00158                 \}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00159}00159                 \textcolor{keywordflow}{catch}( \textcolor{keyword}{const} \mbox{\hyperlink{classsignal__phase__and__timing_1_1signal__phase__and__timing__exception}{signal\_phase\_and\_timing::signal\_phase\_and\_timing\_exception}} \&e ) \{}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00160}00160                     SPDLOG\_ERROR(\textcolor{stringliteral}{"{}Encounted exception : \(\backslash\)n \{0\}"{}}, e.what());}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00161}00161                 \}   }
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00162}00162             \}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00163}00163         \}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00164}00164         \textcolor{keywordflow}{catch}( \textcolor{keyword}{const} \mbox{\hyperlink{classtraffic__signal__controller__service_1_1udp__socket__listener__exception}{udp\_socket\_listener\_exception}} \&e) \{}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00165}00165             SPDLOG\_ERROR(\textcolor{stringliteral}{"{}Encounted exception : \(\backslash\)n \{0\}"{}}, e.what());}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00166}00166         \}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00167}00167         }
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00168}00168     \}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00169}00169 }
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00170}00170     }
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00171}00171 }
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00172}\mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_a9e2ac871cb45ef4a98354ca5bc49b25b}{00172}}     \textcolor{keywordtype}{void} \mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_a9e2ac871cb45ef4a98354ca5bc49b25b}{tsc\_service::start}}() \{}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00173}00173         std::thread spat\_t(\&\mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_aa4fb7763e7ae8b9e630fd7fa10bc2479}{tsc\_service::produce\_spat\_json}}, \textcolor{keyword}{this});}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00174}00174         spat\_t.join();}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00175}00175     \}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00176}00176 }
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00177}\mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_aa82f97b9874e91dd19f3557d8fc4905f}{00177}}     \mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_aa82f97b9874e91dd19f3557d8fc4905f}{tsc\_service::\string~tsc\_service}}()}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00178}00178     \{}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00179}00179         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_a1dfbd2157cd62094844fb2e1a6d70711}{spat\_producer}})}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00180}00180         \{}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00181}00181             SPDLOG\_WARN(\textcolor{stringliteral}{"{}Stopping spat producer!"{}});}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00182}00182             \mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service_a1dfbd2157cd62094844fb2e1a6d70711}{spat\_producer}}-\/>stop();}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00183}00183         \}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00184}00184     \}}
\DoxyCodeLine{\Hypertarget{tsc__service_8cpp_source_l00185}00185 \}}

\end{DoxyCode}
