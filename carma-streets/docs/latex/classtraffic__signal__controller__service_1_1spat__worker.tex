\hypertarget{classtraffic__signal__controller__service_1_1spat__worker}{}\doxysection{traffic\+\_\+signal\+\_\+controller\+\_\+service\+::spat\+\_\+worker Class Reference}
\label{classtraffic__signal__controller__service_1_1spat__worker}\index{traffic\_signal\_controller\_service::spat\_worker@{traffic\_signal\_controller\_service::spat\_worker}}


{\ttfamily \#include $<$spat\+\_\+worker.\+h$>$}



Collaboration diagram for traffic\+\_\+signal\+\_\+controller\+\_\+service\+::spat\+\_\+worker\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classtraffic__signal__controller__service_1_1spat__worker__coll__graph}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classtraffic__signal__controller__service_1_1spat__worker_a3a679b92d5d397cf74684a90ab56dab8}{spat\+\_\+worker}} (const std\+::string \&ip, const int \&port, const int \&socket\+\_\+timeout, const bool use\+\_\+msg\+\_\+timestamp)
\begin{DoxyCompactList}\small\item\em Construct a new Spat Worker object. This will initialize the member variables to the values assigned in the manifest json file. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{classtraffic__signal__controller__service_1_1spat__worker_ac79506c9870fa7010c7c4403939a87cb}{initialize}} ()
\begin{DoxyCompactList}\small\item\em Initilaize UDP Listener socket. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classtraffic__signal__controller__service_1_1spat__worker_aa38e623a3c2a391069809669672e4014}{receive\+\_\+spat}} (const std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{structsignal__phase__and__timing_1_1spat}{signal\+\_\+phase\+\_\+and\+\_\+timing\+::spat}} $>$ \+\_\+spat\+\_\+ptr) const
\begin{DoxyCompactList}\small\item\em Create a UDP socket to the ip and port member variables. If it is successfully created, the received NTCIP SPaT packets and print out their content. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Private Attributes}
\begin{DoxyCompactItemize}
\item 
std\+::string \mbox{\hyperlink{classtraffic__signal__controller__service_1_1spat__worker_a9a3ae5052adf4ec92ed6a4b0037be944}{socket\+\_\+ip\+\_\+}}
\begin{DoxyCompactList}\small\item\em ip address of \mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service}{tsc\+\_\+service}} \end{DoxyCompactList}\item 
int \mbox{\hyperlink{classtraffic__signal__controller__service_1_1spat__worker_a6910dda204a67ee0a45324029e209654}{socket\+\_\+port\+\_\+}}
\begin{DoxyCompactList}\small\item\em ethernet port on \mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service}{tsc\+\_\+service}} host to receive spat messages on \end{DoxyCompactList}\item 
int \mbox{\hyperlink{classtraffic__signal__controller__service_1_1spat__worker_a63226b291bc20ac8d9334899095a9aba}{socket\+\_\+timeout\+\_\+}}
\begin{DoxyCompactList}\small\item\em timeout in milliseconds for udp socket to \mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service}{tsc\+\_\+service}} \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{classtraffic__signal__controller__service_1_1spat__worker_a73335c776e6bfa02cb7ec1b4588985a0}{socket\+\_\+created\+\_\+}} = false
\begin{DoxyCompactList}\small\item\em boolean to verify whether socket has successfully been created \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{classtraffic__signal__controller__service_1_1spat__worker_a4ee619a743fa9ddcfea5347f82988630}{\+\_\+use\+\_\+msg\+\_\+timestamp}}
\begin{DoxyCompactList}\small\item\em bool flag which controls whether \mbox{\hyperlink{classtraffic__signal__controller__service_1_1spat__worker}{spat\+\_\+worker}} will use timestamp received from TSC of local system time to populate spat message. \end{DoxyCompactList}\item 
std\+::unique\+\_\+ptr$<$ \mbox{\hyperlink{classtraffic__signal__controller__service_1_1udp__socket__listener}{udp\+\_\+socket\+\_\+listener}} $>$ \mbox{\hyperlink{classtraffic__signal__controller__service_1_1spat__worker_af4376217cd80cff72b70d38c2d0d55d1}{spat\+\_\+listener}}
\begin{DoxyCompactList}\small\item\em UDP Socket listener to receive UDP NTCIP data packets from Traffic Signal Controller. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}


Definition at line \mbox{\hyperlink{spat__worker_8h_source_l00015}{15}} of file \mbox{\hyperlink{spat__worker_8h_source}{spat\+\_\+worker.\+h}}.



\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classtraffic__signal__controller__service_1_1spat__worker_a3a679b92d5d397cf74684a90ab56dab8}\label{classtraffic__signal__controller__service_1_1spat__worker_a3a679b92d5d397cf74684a90ab56dab8}} 
\index{traffic\_signal\_controller\_service::spat\_worker@{traffic\_signal\_controller\_service::spat\_worker}!spat\_worker@{spat\_worker}}
\index{spat\_worker@{spat\_worker}!traffic\_signal\_controller\_service::spat\_worker@{traffic\_signal\_controller\_service::spat\_worker}}
\doxysubsubsection{\texorpdfstring{spat\_worker()}{spat\_worker()}}
{\footnotesize\ttfamily traffic\+\_\+signal\+\_\+controller\+\_\+service\+::spat\+\_\+worker\+::spat\+\_\+worker (\begin{DoxyParamCaption}\item[{const std\+::string \&}]{ip,  }\item[{const int \&}]{port,  }\item[{const int \&}]{socket\+\_\+timeout,  }\item[{const bool}]{use\+\_\+msg\+\_\+timestamp }\end{DoxyParamCaption})}



Construct a new Spat Worker object. This will initialize the member variables to the values assigned in the manifest json file. 


\begin{DoxyParams}{Parameters}
{\em ip} & The ip address of the \mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service}{tsc\+\_\+service}} \\
\hline
{\em port} & The ethernet port to receive spat messages on \\
\hline
{\em socket\+Timeout} & Timeout, in seconds, for udp socket to TSC \\
\hline
{\em use\+\_\+msg\+\_\+timestamp} & bool flag which controls whether \mbox{\hyperlink{classtraffic__signal__controller__service_1_1spat__worker}{spat\+\_\+worker}} will use timestamp received from TSC of local system time to populate spat message. \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{spat__worker_8cpp_source_l00008}{8}} of file \mbox{\hyperlink{spat__worker_8cpp_source}{spat\+\_\+worker.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00008                                                                                                                            :}
\DoxyCodeLine{00009                           \mbox{\hyperlink{classtraffic__signal__controller__service_1_1spat__worker_a9a3ae5052adf4ec92ed6a4b0037be944}{socket\_ip\_}}(ip), \mbox{\hyperlink{classtraffic__signal__controller__service_1_1spat__worker_a6910dda204a67ee0a45324029e209654}{socket\_port\_}}(port), \mbox{\hyperlink{classtraffic__signal__controller__service_1_1spat__worker_a63226b291bc20ac8d9334899095a9aba}{socket\_timeout\_}}(socket\_timeout), \mbox{\hyperlink{classtraffic__signal__controller__service_1_1spat__worker_a4ee619a743fa9ddcfea5347f82988630}{\_use\_msg\_timestamp}}(use\_msg\_timestamp)}
\DoxyCodeLine{00010     \{}
\DoxyCodeLine{00011         SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Creating Spat Worker"{}});}
\DoxyCodeLine{00012         }
\DoxyCodeLine{00013     \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{classtraffic__signal__controller__service_1_1spat__worker_ac79506c9870fa7010c7c4403939a87cb}\label{classtraffic__signal__controller__service_1_1spat__worker_ac79506c9870fa7010c7c4403939a87cb}} 
\index{traffic\_signal\_controller\_service::spat\_worker@{traffic\_signal\_controller\_service::spat\_worker}!initialize@{initialize}}
\index{initialize@{initialize}!traffic\_signal\_controller\_service::spat\_worker@{traffic\_signal\_controller\_service::spat\_worker}}
\doxysubsubsection{\texorpdfstring{initialize()}{initialize()}}
{\footnotesize\ttfamily bool traffic\+\_\+signal\+\_\+controller\+\_\+service\+::spat\+\_\+worker\+::initialize (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Initilaize UDP Listener socket. 

\begin{DoxyReturn}{Returns}
true if initialization is successful. 

false if initialization is unsuccessful. 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{spat__worker_8cpp_source_l00014}{14}} of file \mbox{\hyperlink{spat__worker_8cpp_source}{spat\+\_\+worker.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00014                                  \{}
\DoxyCodeLine{00015         \mbox{\hyperlink{classtraffic__signal__controller__service_1_1spat__worker_af4376217cd80cff72b70d38c2d0d55d1}{spat\_listener}} = std::make\_unique<udp\_socket\_listener>( \mbox{\hyperlink{classtraffic__signal__controller__service_1_1spat__worker_a9a3ae5052adf4ec92ed6a4b0037be944}{socket\_ip\_}}, \mbox{\hyperlink{classtraffic__signal__controller__service_1_1spat__worker_a6910dda204a67ee0a45324029e209654}{socket\_port\_}}, \mbox{\hyperlink{classtraffic__signal__controller__service_1_1spat__worker_a63226b291bc20ac8d9334899095a9aba}{socket\_timeout\_}});}
\DoxyCodeLine{00016         \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classtraffic__signal__controller__service_1_1spat__worker_af4376217cd80cff72b70d38c2d0d55d1}{spat\_listener}}-\/>initialize()) \{}
\DoxyCodeLine{00017             SPDLOG\_ERROR(\textcolor{stringliteral}{"{}Failed to initialize udp socket!"{}});}
\DoxyCodeLine{00018             \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00019         \}}
\DoxyCodeLine{00020         \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00021     \}}

\end{DoxyCode}


References \mbox{\hyperlink{spat__worker_8h_source_l00021}{socket\+\_\+ip\+\_\+}}, \mbox{\hyperlink{spat__worker_8h_source_l00026}{socket\+\_\+port\+\_\+}}, \mbox{\hyperlink{spat__worker_8h_source_l00031}{socket\+\_\+timeout\+\_\+}}, and \mbox{\hyperlink{spat__worker_8h_source_l00047}{spat\+\_\+listener}}.

\mbox{\Hypertarget{classtraffic__signal__controller__service_1_1spat__worker_aa38e623a3c2a391069809669672e4014}\label{classtraffic__signal__controller__service_1_1spat__worker_aa38e623a3c2a391069809669672e4014}} 
\index{traffic\_signal\_controller\_service::spat\_worker@{traffic\_signal\_controller\_service::spat\_worker}!receive\_spat@{receive\_spat}}
\index{receive\_spat@{receive\_spat}!traffic\_signal\_controller\_service::spat\_worker@{traffic\_signal\_controller\_service::spat\_worker}}
\doxysubsubsection{\texorpdfstring{receive\_spat()}{receive\_spat()}}
{\footnotesize\ttfamily void traffic\+\_\+signal\+\_\+controller\+\_\+service\+::spat\+\_\+worker\+::receive\+\_\+spat (\begin{DoxyParamCaption}\item[{const std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{structsignal__phase__and__timing_1_1spat}{signal\+\_\+phase\+\_\+and\+\_\+timing\+::spat}} $>$}]{\+\_\+spat\+\_\+ptr }\end{DoxyParamCaption}) const}



Create a UDP socket to the ip and port member variables. If it is successfully created, the received NTCIP SPaT packets and print out their content. 


\begin{DoxyExceptions}{Exceptions}
{\em \mbox{\hyperlink{classtraffic__signal__controller__service_1_1udp__socket__listener__exception}{udp\+\_\+socket\+\_\+listener\+\_\+exception}}} & if the UDP socket fails to connect or the connection times out. The connection will timout after a configurable ammount of time if no data is received at UDP socket. \\
\hline
\end{DoxyExceptions}


Definition at line \mbox{\hyperlink{spat__worker_8cpp_source_l00023}{23}} of file \mbox{\hyperlink{spat__worker_8cpp_source}{spat\+\_\+worker.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00024     \{}
\DoxyCodeLine{00025         std::vector<char> spat\_buf = \mbox{\hyperlink{classtraffic__signal__controller__service_1_1spat__worker_af4376217cd80cff72b70d38c2d0d55d1}{spat\_listener}}-\/>receive();}
\DoxyCodeLine{00026         \mbox{\hyperlink{structntcip_1_1ntcip__1202__ext}{ntcip::ntcip\_1202\_ext}} ntcip\_1202\_data;}
\DoxyCodeLine{00027         std::memcpy(\&ntcip\_1202\_data, spat\_buf.data(), spat\_buf.size());}
\DoxyCodeLine{00028         \_spat\_ptr-\/>update(ntcip\_1202\_data, \mbox{\hyperlink{classtraffic__signal__controller__service_1_1spat__worker_a4ee619a743fa9ddcfea5347f82988630}{\_use\_msg\_timestamp}});}
\DoxyCodeLine{00029 }
\DoxyCodeLine{00030            }
\DoxyCodeLine{00031     \}}

\end{DoxyCode}


References \mbox{\hyperlink{spat__worker_8h_source_l00042}{\+\_\+use\+\_\+msg\+\_\+timestamp}}, and \mbox{\hyperlink{spat__worker_8h_source_l00047}{spat\+\_\+listener}}.



\doxysubsection{Member Data Documentation}
\mbox{\Hypertarget{classtraffic__signal__controller__service_1_1spat__worker_a4ee619a743fa9ddcfea5347f82988630}\label{classtraffic__signal__controller__service_1_1spat__worker_a4ee619a743fa9ddcfea5347f82988630}} 
\index{traffic\_signal\_controller\_service::spat\_worker@{traffic\_signal\_controller\_service::spat\_worker}!\_use\_msg\_timestamp@{\_use\_msg\_timestamp}}
\index{\_use\_msg\_timestamp@{\_use\_msg\_timestamp}!traffic\_signal\_controller\_service::spat\_worker@{traffic\_signal\_controller\_service::spat\_worker}}
\doxysubsubsection{\texorpdfstring{\_use\_msg\_timestamp}{\_use\_msg\_timestamp}}
{\footnotesize\ttfamily bool traffic\+\_\+signal\+\_\+controller\+\_\+service\+::spat\+\_\+worker\+::\+\_\+use\+\_\+msg\+\_\+timestamp\hspace{0.3cm}{\ttfamily [private]}}



bool flag which controls whether \mbox{\hyperlink{classtraffic__signal__controller__service_1_1spat__worker}{spat\+\_\+worker}} will use timestamp received from TSC of local system time to populate spat message. 



Definition at line \mbox{\hyperlink{spat__worker_8h_source_l00042}{42}} of file \mbox{\hyperlink{spat__worker_8h_source}{spat\+\_\+worker.\+h}}.



Referenced by \mbox{\hyperlink{spat__worker_8cpp_source_l00023}{receive\+\_\+spat()}}.

\mbox{\Hypertarget{classtraffic__signal__controller__service_1_1spat__worker_a73335c776e6bfa02cb7ec1b4588985a0}\label{classtraffic__signal__controller__service_1_1spat__worker_a73335c776e6bfa02cb7ec1b4588985a0}} 
\index{traffic\_signal\_controller\_service::spat\_worker@{traffic\_signal\_controller\_service::spat\_worker}!socket\_created\_@{socket\_created\_}}
\index{socket\_created\_@{socket\_created\_}!traffic\_signal\_controller\_service::spat\_worker@{traffic\_signal\_controller\_service::spat\_worker}}
\doxysubsubsection{\texorpdfstring{socket\_created\_}{socket\_created\_}}
{\footnotesize\ttfamily bool traffic\+\_\+signal\+\_\+controller\+\_\+service\+::spat\+\_\+worker\+::socket\+\_\+created\+\_\+ = false\hspace{0.3cm}{\ttfamily [private]}}



boolean to verify whether socket has successfully been created 



Definition at line \mbox{\hyperlink{spat__worker_8h_source_l00036}{36}} of file \mbox{\hyperlink{spat__worker_8h_source}{spat\+\_\+worker.\+h}}.

\mbox{\Hypertarget{classtraffic__signal__controller__service_1_1spat__worker_a9a3ae5052adf4ec92ed6a4b0037be944}\label{classtraffic__signal__controller__service_1_1spat__worker_a9a3ae5052adf4ec92ed6a4b0037be944}} 
\index{traffic\_signal\_controller\_service::spat\_worker@{traffic\_signal\_controller\_service::spat\_worker}!socket\_ip\_@{socket\_ip\_}}
\index{socket\_ip\_@{socket\_ip\_}!traffic\_signal\_controller\_service::spat\_worker@{traffic\_signal\_controller\_service::spat\_worker}}
\doxysubsubsection{\texorpdfstring{socket\_ip\_}{socket\_ip\_}}
{\footnotesize\ttfamily std\+::string traffic\+\_\+signal\+\_\+controller\+\_\+service\+::spat\+\_\+worker\+::socket\+\_\+ip\+\_\+\hspace{0.3cm}{\ttfamily [private]}}



ip address of \mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service}{tsc\+\_\+service}} 



Definition at line \mbox{\hyperlink{spat__worker_8h_source_l00021}{21}} of file \mbox{\hyperlink{spat__worker_8h_source}{spat\+\_\+worker.\+h}}.



Referenced by \mbox{\hyperlink{spat__worker_8cpp_source_l00014}{initialize()}}.

\mbox{\Hypertarget{classtraffic__signal__controller__service_1_1spat__worker_a6910dda204a67ee0a45324029e209654}\label{classtraffic__signal__controller__service_1_1spat__worker_a6910dda204a67ee0a45324029e209654}} 
\index{traffic\_signal\_controller\_service::spat\_worker@{traffic\_signal\_controller\_service::spat\_worker}!socket\_port\_@{socket\_port\_}}
\index{socket\_port\_@{socket\_port\_}!traffic\_signal\_controller\_service::spat\_worker@{traffic\_signal\_controller\_service::spat\_worker}}
\doxysubsubsection{\texorpdfstring{socket\_port\_}{socket\_port\_}}
{\footnotesize\ttfamily int traffic\+\_\+signal\+\_\+controller\+\_\+service\+::spat\+\_\+worker\+::socket\+\_\+port\+\_\+\hspace{0.3cm}{\ttfamily [private]}}



ethernet port on \mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service}{tsc\+\_\+service}} host to receive spat messages on 



Definition at line \mbox{\hyperlink{spat__worker_8h_source_l00026}{26}} of file \mbox{\hyperlink{spat__worker_8h_source}{spat\+\_\+worker.\+h}}.



Referenced by \mbox{\hyperlink{spat__worker_8cpp_source_l00014}{initialize()}}.

\mbox{\Hypertarget{classtraffic__signal__controller__service_1_1spat__worker_a63226b291bc20ac8d9334899095a9aba}\label{classtraffic__signal__controller__service_1_1spat__worker_a63226b291bc20ac8d9334899095a9aba}} 
\index{traffic\_signal\_controller\_service::spat\_worker@{traffic\_signal\_controller\_service::spat\_worker}!socket\_timeout\_@{socket\_timeout\_}}
\index{socket\_timeout\_@{socket\_timeout\_}!traffic\_signal\_controller\_service::spat\_worker@{traffic\_signal\_controller\_service::spat\_worker}}
\doxysubsubsection{\texorpdfstring{socket\_timeout\_}{socket\_timeout\_}}
{\footnotesize\ttfamily int traffic\+\_\+signal\+\_\+controller\+\_\+service\+::spat\+\_\+worker\+::socket\+\_\+timeout\+\_\+\hspace{0.3cm}{\ttfamily [private]}}



timeout in milliseconds for udp socket to \mbox{\hyperlink{classtraffic__signal__controller__service_1_1tsc__service}{tsc\+\_\+service}} 



Definition at line \mbox{\hyperlink{spat__worker_8h_source_l00031}{31}} of file \mbox{\hyperlink{spat__worker_8h_source}{spat\+\_\+worker.\+h}}.



Referenced by \mbox{\hyperlink{spat__worker_8cpp_source_l00014}{initialize()}}.

\mbox{\Hypertarget{classtraffic__signal__controller__service_1_1spat__worker_af4376217cd80cff72b70d38c2d0d55d1}\label{classtraffic__signal__controller__service_1_1spat__worker_af4376217cd80cff72b70d38c2d0d55d1}} 
\index{traffic\_signal\_controller\_service::spat\_worker@{traffic\_signal\_controller\_service::spat\_worker}!spat\_listener@{spat\_listener}}
\index{spat\_listener@{spat\_listener}!traffic\_signal\_controller\_service::spat\_worker@{traffic\_signal\_controller\_service::spat\_worker}}
\doxysubsubsection{\texorpdfstring{spat\_listener}{spat\_listener}}
{\footnotesize\ttfamily std\+::unique\+\_\+ptr$<$\mbox{\hyperlink{classtraffic__signal__controller__service_1_1udp__socket__listener}{udp\+\_\+socket\+\_\+listener}}$>$ traffic\+\_\+signal\+\_\+controller\+\_\+service\+::spat\+\_\+worker\+::spat\+\_\+listener\hspace{0.3cm}{\ttfamily [private]}}



UDP Socket listener to receive UDP NTCIP data packets from Traffic Signal Controller. 



Definition at line \mbox{\hyperlink{spat__worker_8h_source_l00047}{47}} of file \mbox{\hyperlink{spat__worker_8h_source}{spat\+\_\+worker.\+h}}.



Referenced by \mbox{\hyperlink{spat__worker_8cpp_source_l00014}{initialize()}}, and \mbox{\hyperlink{spat__worker_8cpp_source_l00023}{receive\+\_\+spat()}}.



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
tsc\+\_\+client\+\_\+service/include/\mbox{\hyperlink{spat__worker_8h}{spat\+\_\+worker.\+h}}\item 
tsc\+\_\+client\+\_\+service/src/\mbox{\hyperlink{spat__worker_8cpp}{spat\+\_\+worker.\+cpp}}\end{DoxyCompactItemize}
