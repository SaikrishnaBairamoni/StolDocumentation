\hypertarget{scheduling__service_2src_2intersection__client_8cpp_source}{}\doxysection{intersection\+\_\+client.\+cpp}
\label{scheduling__service_2src_2intersection__client_8cpp_source}\index{scheduling\_service/src/intersection\_client.cpp@{scheduling\_service/src/intersection\_client.cpp}}
\mbox{\hyperlink{scheduling__service_2src_2intersection__client_8cpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00001}00001 }
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00002}00002 \textcolor{preprocessor}{\#include "{}intersection\_client.h"{}}}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00003}00003 }
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00004}00004 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespacescheduling__service}{scheduling\_service}} \{}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00005}00005 }
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00006}\mbox{\hyperlink{classscheduling__service_1_1intersection__client_ac510cca78365a620384ff9faeaad572f}{00006}}     \textcolor{keywordtype}{bool} \mbox{\hyperlink{classscheduling__service_1_1intersection__client_ac510cca78365a620384ff9faeaad572f}{intersection\_client::update\_intersection\_info}}(\textcolor{keyword}{const} \textcolor{keywordtype}{int} sleep\_millisecs, \textcolor{keyword}{const} \textcolor{keywordtype}{int} int\_client\_request\_attempts)}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00007}00007     \{}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00008}00008         \textcolor{keyword}{auto} sleep\_secs = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}\textcolor{keyword}{>}(sleep\_millisecs);}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00009}00009         \textcolor{keywordtype}{int} attempt\_count = 0;}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00010}00010         \textcolor{keywordflow}{while} (attempt\_count < int\_client\_request\_attempts)}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00011}00011         \{   }
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00012}00012             \textcolor{comment}{// Send HTTP request, and update intersection information. If updated successfully, it returns true and exit the while loop.}}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00013}00013             \textcolor{keywordflow}{if} (\mbox{\hyperlink{classscheduling__service_1_1intersection__client_ad6bd9f3f48ee4e352798f418b88b730a}{request\_intersection\_info}}())}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00014}00014             \{}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00015}00015                 SPDLOG\_INFO(\textcolor{stringliteral}{"{}Intersection information is updated successfuly! "{}});}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00016}00016                 \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00017}00017             \}}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00018}00018             \textcolor{comment}{// sleep takes seconds}}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00019}00019             std::this\_thread::sleep\_for(std::chrono::milliseconds(sleep\_secs));}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00020}00020             attempt\_count++;}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00021}00021         \}}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00022}00022         \textcolor{comment}{// If failed to update the intersection information after certain numbers of attempts}}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00023}00023         SPDLOG\_ERROR(\textcolor{stringliteral}{"{}Updating Intersection information failed. "{}});}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00024}00024         \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00025}00025     \}}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00026}00026 }
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00027}00027 }
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00028}\mbox{\hyperlink{classscheduling__service_1_1intersection__client_ad6bd9f3f48ee4e352798f418b88b730a}{00028}}     \textcolor{keywordtype}{bool} \mbox{\hyperlink{classscheduling__service_1_1intersection__client_ad6bd9f3f48ee4e352798f418b88b730a}{intersection\_client::request\_intersection\_info}}()}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00029}00029     \{}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00030}00030         \textcolor{keywordtype}{bool} intersection\_info\_valid = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00031}00031         \mbox{\hyperlink{classOpenAPI_1_1OAIDefaultApi}{OpenAPI::OAIDefaultApi}} apiInstance;}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00032}00032         QEventLoop loop;}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00033}00033         \textcolor{comment}{// Lambda expression slot for get intersection information signal ( See Qt Signal/Slot documentation)}}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00034}00034         connect(\&apiInstance, \&\mbox{\hyperlink{classOpenAPI_1_1OAIDefaultApi_a1d28886ea13c3f1818c0477fe309f9fd}{OpenAPI::OAIDefaultApi::getIntersectionInfoSignal}}, [\&intersection\_info\_valid, \&loop, \textcolor{keyword}{this}]}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00035}00035             (\textcolor{keyword}{const} \mbox{\hyperlink{classOpenAPI_1_1OAIIntersection__info}{OpenAPI::OAIIntersection\_info}} \&int\_info)\{     }
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00036}00036 }
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00037}00037             SPDLOG\_INFO(\textcolor{stringliteral}{"{}request\_intersection\_info succeed!"{}});}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00038}00038             SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}intersection name: \{0\}"{}}, int\_info.\mbox{\hyperlink{classOpenAPI_1_1OAIIntersection__info_acace7999c0bb220673f9306ee7de4860}{getName}}().toStdString());}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00039}00039             SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}intersection id: \{0\}"{}}, int\_info.\mbox{\hyperlink{classOpenAPI_1_1OAIIntersection__info_adf6e28ef3d4823f3d591c5793b28015e}{getId}}());}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00040}00040 }
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00041}00041             \mbox{\hyperlink{classscheduling__service_1_1intersection__client_af101024f9f717f0afdfc385c2d1799a5}{intersection\_info\_ptr}} = std::make\_shared<OpenAPI::OAIIntersection\_info>(int\_info);}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00042}00042             intersection\_info\_valid = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00043}00043 }
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00044}00044             loop.quit(); }
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00045}00045         \});}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00046}00046         \textcolor{comment}{// Lambda expression slot for get intersection information error signal ( See Qt Signal/Slot documentation)}}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00047}00047         connect(\&apiInstance, \&\mbox{\hyperlink{classOpenAPI_1_1OAIDefaultApi_a115becc3a08d245dc8591b7d263497d1}{OpenAPI::OAIDefaultApi::getIntersectionInfoSignalE}}, }
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00048}00048             [\&intersection\_info\_valid, \&loop, \textcolor{keyword}{this}]}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00049}00049                 ( [[maybe\_unused]] \textcolor{keyword}{const} \mbox{\hyperlink{classOpenAPI_1_1OAIIntersection__info}{OpenAPI::OAIIntersection\_info}} \&int\_info, QNetworkReply::NetworkError error, QString error\_str )\{ }
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00050}00050             SPDLOG\_ERROR(\textcolor{stringliteral}{"{}Error happened while issuing intersection model GET information request : \{0\} code : \{1\}"{}},  error\_str.toStdString(), error);}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00051}00051             intersection\_info\_valid = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00052}00052             \mbox{\hyperlink{classscheduling__service_1_1intersection__client_af101024f9f717f0afdfc385c2d1799a5}{intersection\_info\_ptr}} = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00053}00053             loop.quit(); }
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00054}00054         \});}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00055}00055 }
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00056}00056         apiInstance.\mbox{\hyperlink{classOpenAPI_1_1OAIDefaultApi_a682ffe8581eaecb7e32df4d3c66b6762}{getIntersectionInfo}}();}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00057}00057 }
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00058}00058         QTimer::singleShot(5000, \&loop, \&QEventLoop::quit);}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00059}00059         loop.exec();}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00060}00060 }
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00061}00061         SPDLOG\_INFO(\textcolor{stringliteral}{"{}Done with request\_intersection\_info"{}});}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00062}00062         \textcolor{keywordflow}{return} intersection\_info\_valid;}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00063}00063     \}}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00064}00064 }
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00065}00065 }
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00066}\mbox{\hyperlink{classscheduling__service_1_1intersection__client_ad3f7253d9f88279fde9ae9eeb2552459}{00066}}     std::shared\_ptr<OpenAPI::OAIIntersection\_info> \mbox{\hyperlink{classscheduling__service_1_1intersection__client_ad3f7253d9f88279fde9ae9eeb2552459}{intersection\_client::get\_intersection\_info}}()\textcolor{keyword}{ const }}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00067}00067 \textcolor{keyword}{    }\{}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00068}00068         \textcolor{keywordflow}{return} \mbox{\hyperlink{classscheduling__service_1_1intersection__client_af101024f9f717f0afdfc385c2d1799a5}{intersection\_info\_ptr}};}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00069}00069     \}}
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00070}00070 }
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00071}00071 }
\DoxyCodeLine{\Hypertarget{scheduling__service_2src_2intersection__client_8cpp_source_l00072}00072 \}}

\end{DoxyCode}
