\hypertarget{html__redirects_8py_source}{}\doxysection{html\+\_\+redirects.\+py}
\label{html__redirects_8py_source}\index{doc/\_extensions/zephyr/html\_redirects.py@{doc/\_extensions/zephyr/html\_redirects.py}}
\mbox{\hyperlink{html__redirects_8py}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00001}\mbox{\hyperlink{namespacezephyr_1_1html__redirects}{00001}} \textcolor{comment}{\# Copyright 2018-\/2019 Espressif Systems (Shanghai) PTE LTD}}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00002}00002 \textcolor{comment}{\#}}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00003}00003 \textcolor{comment}{\# SPDX-\/License-\/Identifier: Apache-\/2.0}}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00004}00004 }
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00005}00005 \textcolor{comment}{\# Licensed under the Apache License, Version 2.0 (the "{}License"{});}}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00006}00006 \textcolor{comment}{\# you may not use this file except in compliance with the License.}}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00007}00007 \textcolor{comment}{\# You may obtain a copy of the License at}}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00008}00008 \textcolor{comment}{\#}}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00009}00009 \textcolor{comment}{\#     http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00010}00010 \textcolor{comment}{\#}}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00011}00011 \textcolor{comment}{\# Unless required by applicable law or agreed to in writing, software}}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00012}00012 \textcolor{comment}{\# distributed under the License is distributed on an "{}AS IS"{} BASIS,}}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00013}00013 \textcolor{comment}{\# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.}}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00014}00014 \textcolor{comment}{\# See the License for the specific language governing permissions and}}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00015}00015 \textcolor{comment}{\# limitations under the License.}}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00016}00016 \textcolor{comment}{\#}}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00017}00017 }
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00018}00018 }
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00019}00019 \textcolor{comment}{\# Mechanism to generate static HTML redirect pages in the output}}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00020}00020 \textcolor{comment}{\#}}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00021}00021 \textcolor{comment}{\# Uses redirect\_template.html and the list of pages given in}}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00022}00022 \textcolor{comment}{\# conf.html\_redirect\_pages}}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00023}00023 \textcolor{comment}{\#}}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00024}00024 \textcolor{comment}{\# Adapted from ideas in https://tech.signavio.com/2017/managing-\/sphinx-\/redirects}}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00025}00025 \textcolor{keyword}{import} os.path}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00026}00026 }
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00027}00027 \textcolor{keyword}{from} sphinx.builders.html \textcolor{keyword}{import} StandaloneHTMLBuilder}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00028}00028 }
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00029}\mbox{\hyperlink{namespacezephyr_1_1html__redirects_a79a148d55211d98ac7c66170d41e9fad}{00029}} REDIRECT\_TEMPLATE = \textcolor{stringliteral}{r"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00030}00030 \textcolor{stringliteral}{<html>}}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00031}00031 \textcolor{stringliteral}{  <head>}}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00032}00032 \textcolor{stringliteral}{    <meta http-\/equiv="{}refresh"{}} content=\textcolor{stringliteral}{"{}0; url=\$NEWURL"{}} />}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00033}00033     <script>}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00034}00034      var id=window.location.href.split(\textcolor{stringliteral}{"{}\#"{}})[1];}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00035}00035 }
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00036}00036      \textcolor{keywordflow}{if} (id \&\& (/\string^[a-\/zA-\/Z\(\backslash\):\(\backslash\)/0-\/9\(\backslash\)\_\(\backslash\)-\/\(\backslash\).]+\$/.test(id))) \{}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00037}00037         window.location.href = \textcolor{stringliteral}{"{}\$NEWURL"{}}+\textcolor{stringliteral}{"{}\#"{}}+id;}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00038}00038         \}}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00039}00039      \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00040}00040         window.location.href = \textcolor{stringliteral}{"{}\$NEWURL"{}};}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00041}00041      \};}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00042}00042     </script>}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00043}00043   </head>}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00044}00044   <body>}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00045}00045   <p>Page has moved <a href=\textcolor{stringliteral}{"{}\$NEWURL"{}}>here</a>.</p>}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00046}00046   </body>}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00047}00047 </html>}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00048}00048 \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00049}00049 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00050}00050 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00051}\mbox{\hyperlink{namespacezephyr_1_1html__redirects_a58b4fe4a4861d82737a29c85a6b2ee69}{00051}} \textcolor{stringliteral}{def setup(app):}}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00052}00052 \textcolor{stringliteral}{    app.add\_config\_value('html\_redirect\_pages'}, [], \textcolor{stringliteral}{'html'})}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00053}00053     app.connect(\textcolor{stringliteral}{'build-\/finished'}, create\_redirect\_pages)}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00054}00054 }
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00055}00055     \textcolor{comment}{\# Since we're just setting up a build-\/finished hook, which runs}}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00056}00056     \textcolor{comment}{\# after both reading and writing, this extension is safe for both.}}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00057}00057     \textcolor{keywordflow}{return} \{}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00058}00058         \textcolor{stringliteral}{'parallel\_read\_safe'}: \textcolor{keyword}{True},}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00059}00059         \textcolor{stringliteral}{'parallel\_write\_safe'}: \textcolor{keyword}{True},}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00060}00060     \}}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00061}00061 }
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00062}00062 }
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00063}\mbox{\hyperlink{namespacezephyr_1_1html__redirects_a0cc0b386955d8ee0ed4fc97699bd2ab3}{00063}} \textcolor{keyword}{def }\mbox{\hyperlink{namespacezephyr_1_1html__redirects_a0cc0b386955d8ee0ed4fc97699bd2ab3}{create\_redirect\_pages}}(app, docname):}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00064}00064     \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} isinstance(app.builder, StandaloneHTMLBuilder):}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00065}00065         \textcolor{keywordflow}{return}  \textcolor{comment}{\# only relevant for standalone HTML output}}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00066}00066 }
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00067}00067     \textcolor{keywordflow}{for} (old\_url, new\_url) \textcolor{keywordflow}{in} app.config.html\_redirect\_pages:}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00068}00068         \textcolor{keywordflow}{if} old\_url.startswith(\textcolor{stringliteral}{'/'}):}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00069}00069             old\_url = old\_url[1:]}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00070}00070 }
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00071}00071         new\_url = app.builder.get\_relative\_uri(old\_url, new\_url)}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00072}00072         out\_file = app.builder.get\_outfilename(old\_url)}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00073}00073 }
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00074}00074         out\_dir = os.path.dirname(out\_file)}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00075}00075         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} os.path.exists(out\_dir):}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00076}00076             os.makedirs(out\_dir)}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00077}00077 }
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00078}00078         content = REDIRECT\_TEMPLATE.replace(\textcolor{stringliteral}{"{}\$NEWURL"{}}, new\_url)}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00079}00079 }
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00080}00080         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} os.path.exists(out\_file):}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00081}00081             \textcolor{keyword}{with} open(out\_file, \textcolor{stringliteral}{"{}w"{}}) \textcolor{keyword}{as} rp:}
\DoxyCodeLine{\Hypertarget{html__redirects_8py_source_l00082}00082                 rp.write(content)}

\end{DoxyCode}
