\hypertarget{all__stop__vehicle__scheduler_8cpp_source}{}\doxysection{all\+\_\+stop\+\_\+vehicle\+\_\+scheduler.\+cpp}
\label{all__stop__vehicle__scheduler_8cpp_source}\index{streets\_utils/streets\_vehicle\_scheduler/src/all\_stop\_vehicle\_scheduler.cpp@{streets\_utils/streets\_vehicle\_scheduler/src/all\_stop\_vehicle\_scheduler.cpp}}
\mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00001}00001 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{all__stop__vehicle__scheduler_8h}{all\_stop\_vehicle\_scheduler.h}}"{}}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00002}00002 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00003}00003 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespacestreets__vehicle__scheduler}{streets\_vehicle\_scheduler}} \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00004}00004 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00005}\mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a4b4afb653bc02a75e3c113806c9f4004}{00005}}     \textcolor{keywordtype}{void} \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a4b4afb653bc02a75e3c113806c9f4004}{all\_stop\_vehicle\_scheduler::set\_flexibility\_limit}}( \textcolor{keyword}{const} \textcolor{keywordtype}{int} limit ) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00006}00006         \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a004c41012f860faa9634e42c7d5740f7}{flexibility\_limit}} = limit;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00007}00007     \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00008}00008 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00009}\mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a930961b3e285b2a2d08f4276ffa22658}{00009}}     \textcolor{keywordtype}{void} \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a930961b3e285b2a2d08f4276ffa22658}{all\_stop\_vehicle\_scheduler::schedule\_vehicles}}( std::unordered\_map<std::string,streets\_vehicles::vehicle> \&vehicles, }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00010}00010                                                             std::shared\_ptr<intersection\_schedule> \&i\_sched) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00011}00011         }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00012}00012         \textcolor{keywordflow}{try} }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00013}00013         \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00014}00014             \textcolor{keyword}{auto} schedule = std::dynamic\_pointer\_cast<all\_stop\_intersection\_schedule> (i\_sched);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00015}00015 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00016}00016             \textcolor{keywordflow}{if} ( vehicles.empty() ) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00017}00017                 SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}No vehicles to schedule."{}});}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00018}00018                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00019}00019             \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00020}00020             \textcolor{comment}{// Estimate Vehicles at common time }}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00021}00021             \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1vehicle__scheduler_a85947f43b293504a108619374c0c0dae}{estimate\_vehicles\_at\_common\_time}}( vehicles, schedule-\/>timestamp);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00022}00022             \textcolor{comment}{// Create vectors of EVs RDVs and DVs}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00023}00023             std::list<streets\_vehicles::vehicle> DVs;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00024}00024             std::list<streets\_vehicles::vehicle> RDVs;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00025}00025 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00026}00026             std::list<streets\_vehicles::vehicle> EVs;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00027}00027             \textcolor{keywordflow}{for} ( \textcolor{keyword}{const} \textcolor{keyword}{auto} \&[v\_id, veh] : vehicles) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00028}00028                 \textcolor{keywordflow}{if} ( veh.\_cur\_state == \mbox{\hyperlink{namespacestreets__vehicles_a41f5c896d8020c141aa96235cf1405aca58d6a88f13e2db7f5059c41047876f00}{streets\_vehicles::vehicle\_state::DV}} ) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00029}00029                     \textcolor{comment}{// Once vehicle is considered as DV it has confirmed that it has received access.}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00030}00030                     \textcolor{keywordflow}{if} ( \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a35eb7b98052f4ef88850471478fcdddb}{is\_rdv\_previously\_granted\_access}}(veh) ) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00031}00031                         \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a223e57041ae7ca6c4810877c8c74a49e}{remove\_rdv\_previously\_granted\_access}}(veh);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00032}00032                     \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00033}00033                     DVs.push\_back(veh);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00034}00034                 \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00035}00035                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( veh.\_cur\_state == \mbox{\hyperlink{namespacestreets__vehicles_a41f5c896d8020c141aa96235cf1405acab08ef04fe84cf4f6645fef073717f36f}{streets\_vehicles::vehicle\_state::RDV}} ) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00036}00036                     \textcolor{comment}{// Consider any RDVs previously granted access as a DV}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00037}00037                     \textcolor{keywordflow}{if} ( \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a35eb7b98052f4ef88850471478fcdddb}{is\_rdv\_previously\_granted\_access}}(veh) ) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00038}00038                         DVs.push\_back(veh);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00039}00039                     \} }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00040}00040                     \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00041}00041                         RDVs.push\_back(veh);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00042}00042                     \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00043}00043                 \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00044}00044                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( veh.\_cur\_state == \mbox{\hyperlink{namespacestreets__vehicles_a41f5c896d8020c141aa96235cf1405aca834d41112f2943c357f660165b6eb6de}{streets\_vehicles::vehicle\_state::EV}}) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00045}00045                     EVs.push\_back(veh);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00046}00046                 \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00047}00047             \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00048}00048             }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00049}00049             SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Vehicles to schedule are DVs : \{0\}, RDVs : \{1\}, EVs \{2\} "{}}, DVs.size(), RDVs.size(), EVs.size());}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00050}00050 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00051}00051             \textcolor{comment}{// Schedule DVs}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00052}00052             \textcolor{keywordflow}{if} ( !DVs.empty() )}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00053}00053                 \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a16230014f5d43ef2546a54496c08a9cd}{schedule\_dvs}}( DVs, schedule);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00054}00054             \textcolor{comment}{// Schedule RDVs}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00055}00055             \textcolor{keywordflow}{if} ( !RDVs.empty() )}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00056}00056                 \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a0729a968f0b8f0b0ec11453157df101c}{schedule\_rdvs}}( RDVs, schedule);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00057}00057             \textcolor{comment}{// Schedule EVs}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00058}00058             \textcolor{keywordflow}{if} ( !EVs.empty() )}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00059}00059                 \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_acd0ec98c5efc93aadb38563e3b98d1bb}{schedule\_evs}}( EVs, schedule);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00060}00060         }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00061}00061         \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00062}00062         \textcolor{keywordflow}{catch} ( \textcolor{keyword}{const} \mbox{\hyperlink{classstreets__service_1_1streets__configuration__exception}{streets\_service::streets\_configuration\_exception}} \&ex ) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00063}00063             SPDLOG\_ERROR(\textcolor{stringliteral}{"{}all stop scheduler failure: \{0\} "{}}, ex.what());}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00064}00064         \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00065}00065 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00066}00066     \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00067}00067 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00068}\mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_acab5956159419bef2c5391d59e3fe9ee}{00068}}     \textcolor{keywordtype}{double} \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_acab5956159419bef2c5391d59e3fe9ee}{all\_stop\_vehicle\_scheduler::estimate\_delta\_x\_prime}}(\textcolor{keyword}{const} \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\_vehicles::vehicle}} \&veh, }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00069}00069                                                                 \textcolor{keyword}{const} \mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info}{OpenAPI::OAILanelet\_info}} \&entry\_lane)\textcolor{keyword}{ const}\{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00070}00070         \textcolor{keywordflow}{if} ( veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a54872859b3a12ee290b98e0eedd2864f}{\_cur\_state}} == \mbox{\hyperlink{namespacestreets__vehicles_a41f5c896d8020c141aa96235cf1405aca834d41112f2943c357f660165b6eb6de}{streets\_vehicles::vehicle\_state::EV}} ) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00071}00071             \textcolor{comment}{// Get Entry Lanelet}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00072}00072             \textcolor{keywordtype}{double} delta\_x\_prime = (pow(entry\_lane.\mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info_a9ed2860829d5aeba3062f26e78afcbdc}{getSpeedLimit}}(),2)-\/pow(veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a026375b9e6ffc8f8c8aee72465f352dc}{\_cur\_speed}},2))/(2*veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a1180998ca4eeb7d695d135a1e4a75424}{\_accel\_max}}) -\/ }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00073}00073                 pow(entry\_lane.\mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info_a9ed2860829d5aeba3062f26e78afcbdc}{getSpeedLimit}}(), 2)/(2*veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a253341595deb3473620116dcf63d9927}{\_decel\_max}}); }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00074}00074             \textcolor{keywordflow}{return}  delta\_x\_prime;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00075}00075         \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00076}00076         \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00077}00077             SPDLOG\_WARN(\textcolor{stringliteral}{"{}Cannot estimate delta x prime for vehicle \{0\} because it's state \{1\} != EV !"{}} );}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00078}00078         \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00079}00079         \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00080}00080     \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00081}00081 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00082}\mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_ae5a42af1af20b06df9ad6af5d3170406}{00082}}     \textcolor{keywordtype}{double} \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_ae5a42af1af20b06df9ad6af5d3170406}{all\_stop\_vehicle\_scheduler::calculate\_v\_hat}}(\textcolor{keyword}{const} \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\_vehicles::vehicle}} \&veh)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00083}00083         \textcolor{keywordtype}{double} numerator = veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a253341595deb3473620116dcf63d9927}{\_decel\_max}} *( 2 * veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a21a6378ca2401ac4bc9ca6f6364833fb}{\_cur\_distance}}*veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a1180998ca4eeb7d695d135a1e4a75424}{\_accel\_max}} + pow(veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a026375b9e6ffc8f8c8aee72465f352dc}{\_cur\_speed}}, 2));}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00084}00084         \textcolor{keywordtype}{double} denominator = veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a253341595deb3473620116dcf63d9927}{\_decel\_max}}-\/veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a1180998ca4eeb7d695d135a1e4a75424}{\_accel\_max}};}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00085}00085         \textcolor{keywordtype}{double} v\_hat = sqrt(numerator/denominator);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00086}00086         \textcolor{comment}{// If v\_hat is less that current vehicle speed, const maximum deceleration will not stop before stop bar}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00087}00087         \textcolor{keywordflow}{if} ( v\_hat < veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a026375b9e6ffc8f8c8aee72465f352dc}{\_cur\_speed}}) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00088}00088             SPDLOG\_ERROR(\textcolor{stringliteral}{"{}Stopping trajectory not possible for vehicle \{0\} with speed \{1\} m/s and v\_hat \{2\} m/s!"{}}, veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a470605f661a8f625329ebbb10888e2b8}{\_id}}, veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a026375b9e6ffc8f8c8aee72465f352dc}{\_cur\_speed}}, v\_hat);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00089}00089         \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00090}00090         \textcolor{keywordflow}{return} v\_hat;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00091}00091     \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00092}00092 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00093}\mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a3ba56cc964002b21475a475995938b89}{00093}}     \textcolor{keywordtype}{double} \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a3ba56cc964002b21475a475995938b89}{all\_stop\_vehicle\_scheduler::calculate\_acceleration\_time}}( \textcolor{keyword}{const} \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\_vehicles::vehicle}} \&veh, \textcolor{keyword}{const} \textcolor{keywordtype}{double} v\_hat)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00094}00094         \textcolor{comment}{// If v\_hat is less than current vehicle speed there is only time for deceleration}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00095}00095         \textcolor{comment}{// Note: This is an error case and means stopping before the stop bar is not possible given current kinematic information}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00096}00096         \textcolor{comment}{// and deceleration limits}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00097}00097         \textcolor{keywordflow}{if} ( v\_hat < veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a026375b9e6ffc8f8c8aee72465f352dc}{\_cur\_speed}} )\{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00098}00098             \textcolor{keywordflow}{return} 0.0;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00099}00099         \} }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00100}00100         \textcolor{keywordflow}{return} (v\_hat-\/veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a026375b9e6ffc8f8c8aee72465f352dc}{\_cur\_speed}})/veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a1180998ca4eeb7d695d135a1e4a75424}{\_accel\_max}};}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00101}00101     \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00102}00102 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00103}\mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_afedbbc9205b39ceb8707d950b5c26556}{00103}}     \textcolor{keywordtype}{double} \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_afedbbc9205b39ceb8707d950b5c26556}{all\_stop\_vehicle\_scheduler::calculate\_cruising\_time}}( \textcolor{keyword}{const} \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\_vehicles::vehicle}} \&veh, \textcolor{keyword}{const} \textcolor{keywordtype}{double} v\_hat, \textcolor{keyword}{const} \textcolor{keywordtype}{double} delta\_x\_prime)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00104}00104         \textcolor{comment}{// If v\_hat is less than current speed there is only time for deceleration}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00105}00105         \textcolor{comment}{// Note: This is an error case and means stopping before the stop bar is not possible given current kinematic information}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00106}00106         \textcolor{comment}{// and deceleration limits}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00107}00107         \textcolor{keywordflow}{if} ( v\_hat < veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a026375b9e6ffc8f8c8aee72465f352dc}{\_cur\_speed}} ) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00108}00108             \textcolor{keywordflow}{return} 0.0;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00109}00109         \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00110}00110         \textcolor{keywordflow}{return} (veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a21a6378ca2401ac4bc9ca6f6364833fb}{\_cur\_distance}} -\/ delta\_x\_prime)/v\_hat; }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00111}00111     \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00112}00112 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00113}\mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a63107a1e136be3a00f3a1445531904aa}{00113}}     \textcolor{keywordtype}{double} \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a63107a1e136be3a00f3a1445531904aa}{all\_stop\_vehicle\_scheduler::calculate\_deceleration\_time}}( \textcolor{keyword}{const} \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\_vehicles::vehicle}} \&veh, \textcolor{keyword}{const} \textcolor{keywordtype}{double} v\_hat)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00114}00114         \textcolor{keywordflow}{return} -\/v\_hat/veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a253341595deb3473620116dcf63d9927}{\_decel\_max}};}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00115}00115     \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00116}00116 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00117}\mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a16230014f5d43ef2546a54496c08a9cd}{00117}}     \textcolor{keywordtype}{void} \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a16230014f5d43ef2546a54496c08a9cd}{all\_stop\_vehicle\_scheduler::schedule\_dvs}}( std::list<streets\_vehicles::vehicle> \&dvs,}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00118}00118                                                 \textcolor{keyword}{const} std::shared\_ptr<all\_stop\_intersection\_schedule> \&schedule)\textcolor{keyword}{ const}\{       }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00119}00119         \textcolor{comment}{// Sort based on departure position}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00120}00120         dvs.sort( \mbox{\hyperlink{namespacestreets__vehicle__scheduler_aa9f946d7c588b2697fd379fbed72f382}{departure\_position\_comparator}});}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00121}00121         \textcolor{comment}{// Regardless of previously set departure index, set DV with lowest departure position to departure position 1}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00122}00122         \textcolor{comment}{// to account for DVs that have become LVs}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00123}00123         \textcolor{keywordtype}{int} departure\_position\_index = 1;                                                    }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00124}00124         \textcolor{keywordflow}{for} ( \textcolor{keyword}{const} \textcolor{keyword}{auto} \&departing\_veh : dvs ) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00125}00125             SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Scheduling DV with ID \{0\} ."{}}, departing\_veh.\_id);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00126}00126             \textcolor{comment}{// get link lane info}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00127}00127             \mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info}{OpenAPI::OAILanelet\_info}} lane\_info =  \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1vehicle__scheduler_af2c80eb87e5a9cabaad660544003663c}{get\_link\_lanelet\_info}}( departing\_veh );}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00128}00128             \textcolor{comment}{// calculate clearance time in milliseconds }}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00129}00129             uint64\_t clearance\_time = \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a15b4da36dba827263da4c844028c6db1}{estimate\_clearance\_time}}(departing\_veh, lane\_info);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00130}00130 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00131}00131             \mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule}{all\_stop\_vehicle\_schedule}} veh\_sched;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00132}00132             \textcolor{comment}{// set id}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00133}00133             veh\_sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1vehicle__schedule_ad9c43fcd19029d3f8ddc56486a0a2cf1}{v\_id}} = departing\_veh.\_id;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00134}00134             \textcolor{comment}{// set est }}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00135}00135             veh\_sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule_aa0731dcf4322f99d8793262aee907147}{est}} = departing\_veh.\_actual\_st;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00136}00136             \textcolor{comment}{// set st}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00137}00137             veh\_sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule_afa84a7abfc51bcf1494e9306993814b2}{st}} = departing\_veh.\_actual\_st;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00138}00138             \textcolor{comment}{// set et}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00139}00139             \textcolor{comment}{// if the vehicle is a previously granted access rdv but did not confirm it has received access and thus, doesn't have an actual et}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00140}00140             \textcolor{keywordflow}{if} (\mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a35eb7b98052f4ef88850471478fcdddb}{is\_rdv\_previously\_granted\_access}}(departing\_veh))}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00141}00141             \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00142}00142                 veh\_sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule_a7590a81d8cd1d8bb37f1a99e66ec0197}{et}} =  schedule-\/>timestamp;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00143}00143             \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00144}00144             \textcolor{comment}{// otherwise}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00145}00145             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00146}00146             \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00147}00147                 veh\_sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule_a7590a81d8cd1d8bb37f1a99e66ec0197}{et}} =  departing\_veh.\_actual\_et;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00148}00148             \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00149}00149             \textcolor{comment}{// departure time is equal to current time plus clearance time for DVs}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00150}00150             veh\_sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule_ab735125526f509961867602dc459f8e6}{dt}} =  schedule-\/>timestamp + clearance\_time;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00151}00151             \textcolor{comment}{// set departure position to departure position index}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00152}00152             veh\_sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule_a6bbade68e4c22a7bf0ac1fe77120ae02}{dp}} = departure\_position\_index;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00153}00153             \textcolor{comment}{// Increment index for next DV}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00154}00154             departure\_position\_index++;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00155}00155             \textcolor{comment}{// set state}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00156}00156             veh\_sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule_a1cfe6f93f9f59877dd3585f1f6dbf5c0}{state}} = departing\_veh.\_cur\_state;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00157}00157             \textcolor{comment}{// set vehicle link id}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00158}00158             veh\_sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1vehicle__schedule_a7329784dde8da0782afa24ae9473a12d}{link\_id}} =  departing\_veh.\_link\_id;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00159}00159             \textcolor{comment}{// set vehicle entry lane id}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00160}00160             veh\_sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1vehicle__schedule_a84fbf12e6e10638b71247bb9435aa3a5}{entry\_lane}} =  departing\_veh.\_entry\_lane\_id;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00161}00161             \textcolor{comment}{// set access}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00162}00162             veh\_sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule_a50640de602629b4f186ab3b8e0a51510}{access}} =  \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00163}00163             SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Added schedule for \{0\} with dt \{1\}."{}}, veh\_sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1vehicle__schedule_ad9c43fcd19029d3f8ddc56486a0a2cf1}{v\_id}}, veh\_sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule_ab735125526f509961867602dc459f8e6}{dt}});}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00164}00164             \textcolor{comment}{// add vehicle\_schedule}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00165}00165             schedule-\/>vehicle\_schedules.push\_back(veh\_sched);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00166}00166 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00167}00167         \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00168}00168 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00169}00169     \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00170}00170 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00171}\mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a0729a968f0b8f0b0ec11453157df101c}{00171}}     \textcolor{keywordtype}{void} \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a0729a968f0b8f0b0ec11453157df101c}{all\_stop\_vehicle\_scheduler::schedule\_rdvs}}( std::list<streets\_vehicles::vehicle> \&rdvs, \textcolor{keyword}{const} std::shared\_ptr<all\_stop\_intersection\_schedule> \&schedule ) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00172}00172         \textcolor{comment}{// Vector of considered intersection\_schedule\_options}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00173}00173         std::vector<std::shared\_ptr<all\_stop\_intersection\_schedule>> schedule\_options;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00174}00174         \textcolor{comment}{// Sort rdvs ascending order based on departure position}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00175}00175         rdvs.sort(\mbox{\hyperlink{namespacestreets__vehicle__scheduler_aa9f946d7c588b2697fd379fbed72f382}{departure\_position\_comparator}});}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00176}00176         \textcolor{comment}{// Earliest possible departure position for RDVs is last scheduled DV departure position +1 }}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00177}00177         \textcolor{keywordtype}{int} starting\_departure\_position;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00178}00178         \textcolor{keywordflow}{if} ( !schedule-\/>vehicle\_schedules.empty() ) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00179}00179             starting\_departure\_position = schedule-\/>vehicle\_schedules.back().dp +1;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00180}00180         \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00181}00181         \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00182}00182             \textcolor{comment}{// If no scheduled DVs, first available departure position is 1}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00183}00183             starting\_departure\_position =  1;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00184}00184         \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00185}00185         SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Staring the schedule RDVs from departure index \{0\}!"{}}, starting\_departure\_position );}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00186}00186         \textcolor{comment}{// TODO: for 8 possible approaches this may need to be optimized (greedy search)}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00187}00187         \textcolor{keywordflow}{do} \{ }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00188}00188             SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Considering scheduling options with \{0\} as first RDV."{}} ,rdvs.front().\_id);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00189}00189             \textcolor{comment}{// update schedule option to include already scheduled vehicles}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00190}00190             \textcolor{keyword}{auto} option = std::make\_shared<all\_stop\_intersection\_schedule> (*schedule);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00191}00191             \textcolor{comment}{// consider current permutation of RDV departure order}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00192}00192             \textcolor{keywordtype}{bool} valid\_option =  \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a77c415e3ef29a00acc67c7aac87a270b}{consider\_departure\_position\_permutation}}(rdvs, option, starting\_departure\_position);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00193}00193             SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Scheduling option is valid : \{0\}."{}}, valid\_option);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00194}00194             \textcolor{comment}{// is permutation valid in terms of flexibility limit? Has any vehicle's departure index changed by more}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00195}00195             \textcolor{comment}{// than the current flexibility limit.}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00196}00196             \textcolor{keywordflow}{if} ( valid\_option ) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00197}00197                 schedule\_options.push\_back(option);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00198}00198             \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00199}00199 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00200}00200         \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00201}00201         \textcolor{keywordflow}{while} (std::next\_permutation( rdvs.begin(), rdvs.end(), \mbox{\hyperlink{namespacestreets__vehicle__scheduler_aa9f946d7c588b2697fd379fbed72f382}{departure\_position\_comparator}}));}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00202}00202         \textcolor{comment}{// If no valid options were added.}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00203}00203         \textcolor{keywordflow}{if} ( schedule\_options.empty()) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00204}00204             \textcolor{keywordflow}{throw} \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1scheduling__exception}{scheduling\_exception}}(\textcolor{stringliteral}{"{}There are no valid schedules for RDVs! Please check flexibility\_limit setting."{}});}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00205}00205         \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00206}00206         \textcolor{comment}{// Sort in ascending order based on delay.}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00207}00207         std::sort(schedule\_options.begin(), schedule\_options.end(), \mbox{\hyperlink{namespacestreets__vehicle__scheduler_ab6598f6bcdf2edaadecc3f4b68debb66}{delay\_comparator}});}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00208}00208 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00209}00209         SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}All all scheduling options, the option with RDV \{0\} first has the least delay of \{1\}."{}},}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00210}00210                                 schedule\_options.front()-\/>vehicle\_schedules[starting\_departure\_position-\/1].v\_id,}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00211}00211                                 schedule\_options.front()-\/>get\_delay());}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00212}00212        }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00213}00213         \textcolor{comment}{// Add scheduled RDVs starting at last scheduled DV position to schedule}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00214}00214         \textcolor{keywordflow}{for} ( \textcolor{keyword}{const} \textcolor{keyword}{auto} \&sched : schedule\_options.front()-\/>vehicle\_schedules)\{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00215}00215             \textcolor{comment}{// starting at first available departure position for dvs, add rdvs from best option to current schedule}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00216}00216             \textcolor{keywordflow}{if} (starting\_departure\_position <= sched.dp ) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00217}00217                 \textcolor{comment}{// if rdv was granted access in this schedule add it to the list of RDVs granted access}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00218}00218                 \textcolor{keywordflow}{if} ( sched.access ) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00219}00219                         \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\_vehicles::vehicle}} rdv\_granted\_access = \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a0cf6941cc406bbd51889c129231e9443}{get\_vehicle\_with\_id}}( rdvs, sched.v\_id );}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00220}00220                         SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Added RDV \{0\} to list of RDVs previously granted access."{}}, rdv\_granted\_access.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a470605f661a8f625329ebbb10888e2b8}{\_id}});}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00221}00221                         \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a77c53828e29e53a9a7ff752afb65b549}{rdvs\_previously\_granted\_access}}.push\_back(rdv\_granted\_access);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00222}00222                 \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00223}00223                 schedule-\/>vehicle\_schedules.push\_back( sched );}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00224}00224                 starting\_departure\_position ++;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00225}00225             \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00226}00226         \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00227}00227         SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Schedule for RDVs: \(\backslash\)n"{}} + schedule-\/>toCSV());}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00228}00228     \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00229}00229 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00230}\mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_acd0ec98c5efc93aadb38563e3b98d1bb}{00230}}     \textcolor{keywordtype}{void} \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_acd0ec98c5efc93aadb38563e3b98d1bb}{all\_stop\_vehicle\_scheduler::schedule\_evs}}( std::list<streets\_vehicles::vehicle> \&evs, \textcolor{keyword}{const} std::shared\_ptr<all\_stop\_intersection\_schedule> \&schedule )\textcolor{keyword}{ const }\{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00231}00231         \textcolor{comment}{// Map of entry lane ids to preceding already scheduled vehicle}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00232}00232         std::unordered\_map<int , all\_stop\_vehicle\_schedule> preceding\_vehicle\_entry\_lane\_map;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00233}00233         \textcolor{keywordflow}{for} ( \textcolor{keyword}{const} \textcolor{keyword}{auto} \&entry\_lane : \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1vehicle__scheduler_a5fa37276e5ccb41e38cbef573e830e8e}{intersection\_info}}-\/>getEntryLanelets() ) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00234}00234             \textcolor{keywordtype}{int} lane\_id = entry\_lane.getId();}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00235}00235             \mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule}{all\_stop\_vehicle\_schedule}} preceding\_veh;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00236}00236             \textcolor{comment}{// Only one RDV can exist for each approach}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00237}00237             \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto} \&veh\_sched : schedule-\/>vehicle\_schedules ) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00238}00238                 \textcolor{keywordflow}{if} ( veh\_sched.state == \mbox{\hyperlink{namespacestreets__vehicles_a41f5c896d8020c141aa96235cf1405acab08ef04fe84cf4f6645fef073717f36f}{streets\_vehicles::vehicle\_state::RDV}}) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00239}00239                     \textcolor{comment}{// All RDVs}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00240}00240                     preceding\_veh = veh\_sched;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00241}00241                     preceding\_vehicle\_entry\_lane\_map.try\_emplace(lane\_id, preceding\_veh);  }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00242}00242 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00243}00243                 \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00244}00244                 \textcolor{comment}{// Consider vehicles recently granted access}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00245}00245                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( veh\_sched.state == \mbox{\hyperlink{namespacestreets__vehicles_a41f5c896d8020c141aa96235cf1405aca58d6a88f13e2db7f5059c41047876f00}{streets\_vehicles::vehicle\_state::DV}} \&\& (veh\_sched.et-\/schedule-\/>timestamp) <= \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a13124a205e1c6615f6a137c507b2a4eb}{entering\_time\_buffer}}) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00246}00246                     SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Considering DV \{0\} as still in entry since entering time \{1\} -\/ timestamp \{2\} does not exceed buffer \{3\}"{}},}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00247}00247                             veh\_sched.v\_id, veh\_sched.et, schedule-\/>timestamp, \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a13124a205e1c6615f6a137c507b2a4eb}{entering\_time\_buffer}});}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00248}00248                     preceding\_veh = veh\_sched;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00249}00249                     preceding\_vehicle\_entry\_lane\_map.try\_emplace(lane\_id, preceding\_veh);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00250}00250                 \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00251}00251             \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00252}00252         \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00253}00253 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00254}00254         \textcolor{comment}{// Sort vehicles based on distance}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00255}00255         evs.sort(\mbox{\hyperlink{namespacestreets__vehicle__scheduler_ab550673e6a269f9f374ca3ca7ff6ba82}{distance\_comparator}});}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00256}00256         }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00257}00257         \textcolor{comment}{// Create a map of entry lane id keys and list of vehicle to be scheduled next in each lane.}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00258}00258         std::unordered\_map<int, std::list<streets\_vehicles::vehicle>> vehicle\_to\_be\_scheduled\_next;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00259}00259         \textcolor{keywordflow}{for} ( \textcolor{keyword}{const} \textcolor{keyword}{auto} \&entry\_lane : \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1vehicle__scheduler_a5fa37276e5ccb41e38cbef573e830e8e}{intersection\_info}}-\/>getEntryLanelets() ) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00260}00260             std::list<streets\_vehicles::vehicle> vehicles\_in\_lane;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00261}00261             \textcolor{keywordflow}{for} ( \textcolor{keyword}{const} \textcolor{keyword}{auto} \&ev : evs ) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00262}00262                 \textcolor{keywordflow}{if} ( ev.\_entry\_lane\_id == entry\_lane.getId()) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00263}00263                     SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Adding vehicle \{0\} to EVs list in entry lane \{1\}"{}}, ev.\_id, ev.\_entry\_lane\_id);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00264}00264                     vehicles\_in\_lane.push\_back(ev);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00265}00265                 \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00266}00266             \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00267}00267             \textcolor{keywordflow}{if} ( !vehicles\_in\_lane.empty())}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00268}00268                 vehicle\_to\_be\_scheduled\_next.try\_emplace( entry\_lane.getId(), vehicles\_in\_lane );}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00269}00269             \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00270}00270                 SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}No EVs in lane \{0\}."{}},\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(entry\_lane.getId()) );}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00271}00271             \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00272}00272         \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00273}00273         \textcolor{keywordflow}{if} ( !vehicle\_to\_be\_scheduled\_next.empty()) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00274}00274             \textcolor{keywordflow}{for} ( \textcolor{keyword}{const} \textcolor{keyword}{auto} \&[entry\_lane, next\_veh] : vehicle\_to\_be\_scheduled\_next ) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00275}00275                 SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Next Vehicle \{0\} to be scheduled in lane \{1\}"{}},next\_veh.front().\_id, entry\_lane);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00276}00276             \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00277}00277         \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00278}00278         \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00279}00279             \textcolor{keywordflow}{throw} \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1scheduling__exception}{scheduling\_exception}}(\textcolor{stringliteral}{"{}Map of vehicles to be scheduled is empty but list of EVs to be scheduled is not!"{}});}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00280}00280         \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00281}00281         \textcolor{comment}{// Get next available departure index, default to 1 if schedule is empty}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00282}00282         \textcolor{keywordtype}{int} last\_departure\_index = 1;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00283}00283         \textcolor{keywordflow}{if} ( !schedule-\/>vehicle\_schedules.empty()) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00284}00284             last\_departure\_index =  schedule-\/>vehicle\_schedules.back().dp + 1;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00285}00285         \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00286}00286         \textcolor{keywordflow}{do} \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00287}00287             \mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule}{all\_stop\_vehicle\_schedule}} sched;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00288}00288             \textcolor{comment}{// Calculate ST for each next vehicle in each lane and schedule the vehicle with the lowest ST}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00289}00289             uint64\_t lowest\_st = 0;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00290}00290 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00291}00291             \textcolor{comment}{// Populate Map}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00292}00292             \textcolor{comment}{// Find next vehicle for each entry lanelet}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00293}00293             \textcolor{keywordflow}{for} ( \textcolor{keyword}{const} \textcolor{keyword}{auto} \&[entry\_lane, evs\_in\_lane] : vehicle\_to\_be\_scheduled\_next ) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00294}00294                 \textcolor{comment}{// Take first vehicle to be scheduled in lane.}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00295}00295                 \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\_vehicles::vehicle}} ev = evs\_in\_lane.front();}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00296}00296                 SPDLOG\_DEBUG( \textcolor{stringliteral}{"{}Estimating schedule for \{0\}."{}}, ev.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a470605f661a8f625329ebbb10888e2b8}{\_id}});}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00297}00297 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00298}00298                 \textcolor{comment}{// Get link lanelet information for ev}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00299}00299                 \mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info}{OpenAPI::OAILanelet\_info}} link\_lane = \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1vehicle__scheduler_af2c80eb87e5a9cabaad660544003663c}{get\_link\_lanelet\_info}}( ev );}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00300}00300                 SPDLOG\_DEBUG( \textcolor{stringliteral}{"{}Link lanelet for \{0\} is \{1\}."{}}, ev.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a470605f661a8f625329ebbb10888e2b8}{\_id}}, link\_lane.\mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info_a489d1a475686159298697bccabd2bd52}{getId}}());}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00301}00301                 \textcolor{comment}{// Calculate EST for vehicle}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00302}00302                 uint64\_t est = \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_ad5f0462b2d82168b7b71dcfd15eaa7f2}{estimate\_earliest\_time\_to\_stop\_bar}}(ev);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00303}00303                 SPDLOG\_DEBUG( \textcolor{stringliteral}{"{}EST for vehicle \{0\} is \{1\}."{}} ,ev.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a470605f661a8f625329ebbb10888e2b8}{\_id}}, est ) ;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00304}00304                 \textcolor{comment}{// Store ST value for vehicle}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00305}00305                 uint64\_t st;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00306}00306 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00307}00307 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00308}00308                 \textcolor{comment}{// If there is a preceding vehicle scheduled in this lane}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00309}00309                 \textcolor{keywordflow}{if} ( preceding\_vehicle\_entry\_lane\_map.find( ev.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_adc3dab0260f149fc908b9b7d49e1ba99}{\_cur\_lane\_id}} )  != preceding\_vehicle\_entry\_lane\_map.end() ) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00310}00310                     \textcolor{comment}{// Get preceding vehicle in lane}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00311}00311                     \mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule}{all\_stop\_vehicle\_schedule}} preceding\_veh = preceding\_vehicle\_entry\_lane\_map.find( ev.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_adc3dab0260f149fc908b9b7d49e1ba99}{\_cur\_lane\_id}} )-\/>second;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00312}00312                     SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Preceding vehicle schedule in lane \{0\} is \{1\}."{}}, preceding\_veh.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1vehicle__schedule_a84fbf12e6e10638b71247bb9435aa3a5}{entry\_lane}}, preceding\_veh.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1vehicle__schedule_ad9c43fcd19029d3f8ddc56486a0a2cf1}{v\_id}});}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00313}00313                     \textcolor{comment}{// If there is a preceding vehicle the st is calculated as max of EST and preceding vehicle ET plus a time}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00314}00314                     \textcolor{comment}{// buffer to account for the time it takes the preceding vehicle to enter the intersection}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00315}00315                     SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Preceding vehicle et \{0\}"{}}, preceding\_veh.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule_a7590a81d8cd1d8bb37f1a99e66ec0197}{et}});}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00316}00316                     st =  std::max( est, preceding\_veh.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule_a7590a81d8cd1d8bb37f1a99e66ec0197}{et}} + \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a13124a205e1c6615f6a137c507b2a4eb}{entering\_time\_buffer}} );}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00317}00317                     SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Setting st for vehicle \{0\} to max of \{1\} , \{2\}."{}}, ev.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a470605f661a8f625329ebbb10888e2b8}{\_id}}, est, preceding\_veh.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule_a7590a81d8cd1d8bb37f1a99e66ec0197}{et}} + \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a13124a205e1c6615f6a137c507b2a4eb}{entering\_time\_buffer}});}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00318}00318 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00319}00319                 \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00320}00320                 \textcolor{comment}{// IF there is no preceding vehicle ST == EST}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00321}00321                 \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00322}00322                     SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}No proceeding vehicle for \{0\}"{}}, ev.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a470605f661a8f625329ebbb10888e2b8}{\_id}});}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00323}00323                     st = est;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00324}00324                 \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00325}00325                 \textcolor{comment}{// If lowest st has not been set yet. This is currently the lowest st}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00326}00326                 \textcolor{keywordflow}{if} ( lowest\_st == 0 || lowest\_st > st ) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00327}00327                     lowest\_st = st;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00328}00328                     \textcolor{comment}{// Set schedule properties}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00329}00329                     sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1vehicle__schedule_ad9c43fcd19029d3f8ddc56486a0a2cf1}{v\_id}} =  ev.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a470605f661a8f625329ebbb10888e2b8}{\_id}};}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00330}00330                     sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule_aa0731dcf4322f99d8793262aee907147}{est}} = est;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00331}00331                     sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule_afa84a7abfc51bcf1494e9306993814b2}{st}} = st;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00332}00332                     sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1vehicle__schedule_a84fbf12e6e10638b71247bb9435aa3a5}{entry\_lane}} =  ev.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a4ef0e2e811b0f5cb00f14b89a353c3b5}{\_entry\_lane\_id}};}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00333}00333                     sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1vehicle__schedule_a7329784dde8da0782afa24ae9473a12d}{link\_id}} = ev.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_aaa9cbe97b2343b3f14841c1ed2bc8e3d}{\_link\_id}};}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00334}00334                     sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule_a1cfe6f93f9f59877dd3585f1f6dbf5c0}{state}} = \mbox{\hyperlink{namespacestreets__vehicles_a41f5c896d8020c141aa96235cf1405aca834d41112f2943c357f660165b6eb6de}{streets\_vehicles::vehicle\_state::EV}};}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00335}00335                     sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule_a50640de602629b4f186ab3b8e0a51510}{access}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00336}00336                     sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule_a6bbade68e4c22a7bf0ac1fe77120ae02}{dp}} = last\_departure\_index;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00337}00337                     sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule_a7590a81d8cd1d8bb37f1a99e66ec0197}{et}} = \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a9b5ee4ffdbd82cbf0c48f7981e7dff9c}{estimate\_entering\_time\_for\_ev}}(schedule-\/>vehicle\_schedules, ev, st);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00338}00338                     \textcolor{comment}{// Departure time is equal to entering time + clearance time}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00339}00339                     sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule_ab735125526f509961867602dc459f8e6}{dt}} = sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule_a7590a81d8cd1d8bb37f1a99e66ec0197}{et}} + \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a15b4da36dba827263da4c844028c6db1}{estimate\_clearance\_time}}( ev, link\_lane );}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00340}00340             }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00341}00341                 \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00342}00342                }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00343}00343             \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00344}00344             SPDLOG\_DEBUG( \textcolor{stringliteral}{"{}Found vehicle \{0\} with lowest stopping time \{1\} in lane \{2\}"{}}, sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1vehicle__schedule_ad9c43fcd19029d3f8ddc56486a0a2cf1}{v\_id}}, sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule_afa84a7abfc51bcf1494e9306993814b2}{st}}, sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1vehicle__schedule_a84fbf12e6e10638b71247bb9435aa3a5}{entry\_lane}});}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00345}00345             \textcolor{comment}{// Add lowest ST to schedule}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00346}00346             schedule-\/>vehicle\_schedules.push\_back(sched);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00347}00347             \textcolor{comment}{// Increment departure index}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00348}00348             last\_departure\_index++;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00349}00349             \textcolor{comment}{// Replace previous preceeding vehicle for lane with scheduled vehicle}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00350}00350             \textcolor{keywordflow}{if} ( preceding\_vehicle\_entry\_lane\_map.find(sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1vehicle__schedule_a84fbf12e6e10638b71247bb9435aa3a5}{entry\_lane}}) != preceding\_vehicle\_entry\_lane\_map.end()) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00351}00351                 preceding\_vehicle\_entry\_lane\_map.find(sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1vehicle__schedule_a84fbf12e6e10638b71247bb9435aa3a5}{entry\_lane}})-\/>second =  sched;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00352}00352             \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00353}00353             \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00354}00354                 preceding\_vehicle\_entry\_lane\_map.try\_emplace(sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1vehicle__schedule_a84fbf12e6e10638b71247bb9435aa3a5}{entry\_lane}}, sched);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00355}00355             \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00356}00356             \textcolor{comment}{// Pop vehicle off of list of vehicles to be scheduled for each lane}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00357}00357             vehicle\_to\_be\_scheduled\_next.find(sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1vehicle__schedule_a84fbf12e6e10638b71247bb9435aa3a5}{entry\_lane}})-\/>second.pop\_front();}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00358}00358             \textcolor{comment}{// If pop makes list empty remove map entry}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00359}00359             \textcolor{keywordflow}{if} ( vehicle\_to\_be\_scheduled\_next.find(sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1vehicle__schedule_a84fbf12e6e10638b71247bb9435aa3a5}{entry\_lane}})-\/>second.empty() ) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00360}00360                 SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}All vehicles in approach lanelet \{0\} have been scheduled!"{}}, sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1vehicle__schedule_a84fbf12e6e10638b71247bb9435aa3a5}{entry\_lane}});}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00361}00361                 vehicle\_to\_be\_scheduled\_next.erase(sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1vehicle__schedule_a84fbf12e6e10638b71247bb9435aa3a5}{entry\_lane}});}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00362}00362             \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00363}00363             }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00364}00364         \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00365}00365         \textcolor{keywordflow}{while} ( !vehicle\_to\_be\_scheduled\_next.empty() );}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00366}00366     \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00367}00367 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00368}\mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a9b5ee4ffdbd82cbf0c48f7981e7dff9c}{00368}}     uint64\_t \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a9b5ee4ffdbd82cbf0c48f7981e7dff9c}{all\_stop\_vehicle\_scheduler::estimate\_entering\_time\_for\_ev}}( \textcolor{keyword}{const} std::vector<all\_stop\_vehicle\_schedule> \&vehicle\_schedules, \textcolor{keyword}{const} \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\_vehicles::vehicle}} \&ev, \textcolor{keyword}{const} uint64\_t st)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00369}00369         \textcolor{comment}{// Get link lanelet information for ev}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00370}00370         \mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info}{OpenAPI::OAILanelet\_info}} link\_lane = \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1vehicle__scheduler_af2c80eb87e5a9cabaad660544003663c}{get\_link\_lanelet\_info}}( ev );}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00371}00371         \textcolor{comment}{// Get schedule of conflicting vehicle with largest dt from already scheduled vehicles}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00372}00372         \textcolor{keywordflow}{if} ( !vehicle\_schedules.empty() ) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00373}00373             std::shared\_ptr<all\_stop\_vehicle\_schedule> conflict\_with\_largest\_dt = \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_aa06721804b8a4075b98c2e8ad40c84da}{get\_latest\_conflicting}}(link\_lane, vehicle\_schedules);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00374}00374             }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00375}00375             \textcolor{keywordflow}{if} ( conflict\_with\_largest\_dt != \textcolor{keyword}{nullptr}) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00376}00376                 SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Vehicle with largest conflict to \{0\} is \{1\}."{}}, ev.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a470605f661a8f625329ebbb10888e2b8}{\_id}}, conflict\_with\_largest\_dt-\/>v\_id);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00377}00377                 \textcolor{comment}{// Entering time is the maximum between the conflicting vehicles departure time and the current vehicles stopping time}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00378}00378                 \textcolor{keywordflow}{return} std::max(conflict\_with\_largest\_dt-\/>dt, st);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00379}00379             \}\textcolor{keywordflow}{else}\{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00380}00380                 \textcolor{comment}{// If there is no conflicting scheduled vehicle, st == et}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00381}00381                 \textcolor{keywordflow}{return} st;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00382}00382             \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00383}00383         \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00384}00384         \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00385}00385             \textcolor{comment}{// If schedule is empty there can be no conflict}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00386}00386             \textcolor{keywordflow}{return} st;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00387}00387         \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00388}00388     \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00389}00389 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00390}\mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_ad5f0462b2d82168b7b71dcfd15eaa7f2}{00390}}     uint64\_t \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_ad5f0462b2d82168b7b71dcfd15eaa7f2}{all\_stop\_vehicle\_scheduler::estimate\_earliest\_time\_to\_stop\_bar}}(\textcolor{keyword}{const} \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\_vehicles::vehicle}} \&veh)\textcolor{keyword}{ const}\{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00391}00391         \textcolor{comment}{// Distance to stop bar }}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00392}00392         \textcolor{keywordtype}{double} delta\_x = veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a21a6378ca2401ac4bc9ca6f6364833fb}{\_cur\_distance}};}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00393}00393         \textcolor{comment}{// Get Entry Lane}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00394}00394         \mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info}{OpenAPI::OAILanelet\_info}} lane\_info =  \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1vehicle__scheduler_af8916add714bef70d8f48efc0ccfca7b}{get\_entry\_lanelet\_info}}( veh );}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00395}00395         \textcolor{comment}{// Distance necessary to get to max speed and decelerate with decel\_max}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00396}00396         \textcolor{keywordtype}{double} delta\_x\_prime =  \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_acab5956159419bef2c5391d59e3fe9ee}{estimate\_delta\_x\_prime}}( veh, lane\_info );}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00397}00397         SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Delta X Prime = \{0\}."{}}, delta\_x\_prime);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00398}00398 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00399}00399         \textcolor{comment}{// Calculate v\_hat and planned cruising time interval}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00400}00400         \textcolor{keywordtype}{double} v\_hat;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00401}00401         \textcolor{keywordtype}{double} t\_cruising;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00402}00402         \textcolor{keywordflow}{if} ( delta\_x >= delta\_x\_prime ) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00403}00403             v\_hat = lane\_info.\mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info_a9ed2860829d5aeba3062f26e78afcbdc}{getSpeedLimit}}();}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00404}00404             SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}V hat = \{0\}."{}}, v\_hat);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00405}00405 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00406}00406             t\_cruising = \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_afedbbc9205b39ceb8707d950b5c26556}{calculate\_cruising\_time}}(veh, v\_hat, delta\_x\_prime); }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00407}00407             SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}T cruising = \{0\}."{}},t\_cruising);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00408}00408 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00409}00409         \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00410}00410         \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00411}00411             v\_hat =  \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_ae5a42af1af20b06df9ad6af5d3170406}{calculate\_v\_hat}}(veh);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00412}00412             SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}V hat = \{0\}."{}}, v\_hat);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00413}00413 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00414}00414             t\_cruising = 0.0;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00415}00415             SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}T cruising = \{0\}."{}},t\_cruising);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00416}00416 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00417}00417         \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00418}00418         }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00419}00419         \textcolor{comment}{// calculate planned acceleration time interval}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00420}00420         \textcolor{keywordtype}{double} t\_accel = \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a3ba56cc964002b21475a475995938b89}{calculate\_acceleration\_time}}(veh, v\_hat);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00421}00421         SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}T accel = \{0\}."{}},t\_accel);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00422}00422 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00423}00423         \textcolor{comment}{// calculate planned deceleration time interval}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00424}00424         \textcolor{keywordtype}{double} t\_decel = \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a63107a1e136be3a00f3a1445531904aa}{calculate\_deceleration\_time}}(veh, v\_hat);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00425}00425         SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}T decel = \{0\}."{}},t\_decel);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00426}00426 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00427}00427         \textcolor{comment}{// calculate time to stop bar}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00428}00428         \textcolor{keywordtype}{double} time\_to\_stop\_bar = t\_accel + t\_cruising + t\_decel;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00429}00429         \textcolor{keywordflow}{return} \textcolor{keyword}{static\_cast<}uint64\_t\textcolor{keyword}{>}(ceil(time\_to\_stop\_bar * 1000.0)) + veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a278b51810d25efcfcfb91bb13e43e6f3}{\_cur\_time}};}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00430}00430     \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00431}00431 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00432}\mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a77c415e3ef29a00acc67c7aac87a270b}{00432}}     \textcolor{keywordtype}{bool} \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a77c415e3ef29a00acc67c7aac87a270b}{all\_stop\_vehicle\_scheduler::consider\_departure\_position\_permutation}}( }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00433}00433                                                                                 \textcolor{keyword}{const} std::list<streets\_vehicles::vehicle> \&rdvs, }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00434}00434                                                                                 \textcolor{keyword}{const} std::shared\_ptr<all\_stop\_intersection\_schedule> \&option,}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00435}00435                                                                                 \textcolor{keywordtype}{int} starting\_departure\_position )\textcolor{keyword}{ const }\{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00436}00436         \textcolor{keywordflow}{for} ( \textcolor{keyword}{const} \textcolor{keyword}{auto} \&veh : rdvs ) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00437}00437             \textcolor{comment}{// If scheduling option moves vehicle departure position more than flexibility limit it is not a valid option.}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00438}00438             \textcolor{keywordflow}{if} ( abs(starting\_departure\_position -\/ veh.\_departure\_position) > \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a004c41012f860faa9634e42c7d5740f7}{flexibility\_limit}} ) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00439}00439                 SPDLOG\_WARN(}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00440}00440                     \textcolor{stringliteral}{"{}Not considering scheduling option since change in departure position for vehicle \{0\} exceeds flexibility limit \{1\}!"{}},}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00441}00441                     veh.\_id, \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a004c41012f860faa9634e42c7d5740f7}{flexibility\_limit}});}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00442}00442                 \textcolor{comment}{// Break out of scheduling estimation loop and do not consider this scheduling option}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00443}00443                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00444}00444             \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00445}00445             \mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule}{all\_stop\_vehicle\_schedule}} sched;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00446}00446             \textcolor{comment}{// Populate common vehicle schedule information}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00447}00447             sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1vehicle__schedule_ad9c43fcd19029d3f8ddc56486a0a2cf1}{v\_id}} = veh.\_id;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00448}00448             \textcolor{comment}{// RDVs should have already stopped}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00449}00449             sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule_afa84a7abfc51bcf1494e9306993814b2}{st}} = veh.\_actual\_st;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00450}00450             sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule_aa0731dcf4322f99d8793262aee907147}{est}} =  veh.\_actual\_st;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00451}00451             \textcolor{comment}{// set dp position for current permutation                      }}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00452}00452             sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule_a6bbade68e4c22a7bf0ac1fe77120ae02}{dp}} = starting\_departure\_position;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00453}00453             \textcolor{comment}{// Set connection link lanelet id}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00454}00454             sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1vehicle__schedule_a7329784dde8da0782afa24ae9473a12d}{link\_id}} = veh.\_link\_id;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00455}00455             \textcolor{comment}{// Set entry lanelet id }}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00456}00456             sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1vehicle__schedule_a84fbf12e6e10638b71247bb9435aa3a5}{entry\_lane}} = veh.\_entry\_lane\_id;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00457}00457             \textcolor{comment}{// Get vehicle lane info}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00458}00458             \mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info}{OpenAPI::OAILanelet\_info}} veh\_lane = \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1vehicle__scheduler_af2c80eb87e5a9cabaad660544003663c}{get\_link\_lanelet\_info}}(veh);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00459}00459             std::shared\_ptr<all\_stop\_vehicle\_schedule> latest\_conflicting\_vehicle = \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_aa06721804b8a4075b98c2e8ad40c84da}{get\_latest\_conflicting}}( veh\_lane, option-\/>vehicle\_schedules);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00460}00460             \textcolor{comment}{// If there is no conflicting scheduled vehicle (RDVs and DVs)}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00461}00461             \textcolor{keywordflow}{if} ( latest\_conflicting\_vehicle == \textcolor{keyword}{nullptr}) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00462}00462                 \textcolor{comment}{// Consider previously scheduled vehicle. Current vehicle cannot be granted access}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00463}00463                 \textcolor{comment}{// to intersection regardless of conflict status before previously scheduled vehicle}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00464}00464                 \textcolor{comment}{// to preserve departure order}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00465}00465                 \textcolor{keywordflow}{if} ( option-\/>vehicle\_schedules.empty() || option-\/>vehicle\_schedules.back().access ) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00466}00466                     \textcolor{comment}{// Give vehicle access since there are no proceeding vehicles}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00467}00467                     sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule_a50640de602629b4f186ab3b8e0a51510}{access}} = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00468}00468                     \textcolor{comment}{// Set vehicle state. Will not impact clearance time estimation since set on schedule}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00469}00469                     sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule_a1cfe6f93f9f59877dd3585f1f6dbf5c0}{state}} = \mbox{\hyperlink{namespacestreets__vehicles_a41f5c896d8020c141aa96235cf1405aca58d6a88f13e2db7f5059c41047876f00}{streets\_vehicles::vehicle\_state::DV}};}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00470}00470                     \textcolor{comment}{// Entering time equals schedule time}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00471}00471                     sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule_a7590a81d8cd1d8bb37f1a99e66ec0197}{et}} = option-\/>timestamp;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00472}00472                     \textcolor{comment}{// Departure time equals entering time + clearance time}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00473}00473                     sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule_ab735125526f509961867602dc459f8e6}{dt}} =  sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule_a7590a81d8cd1d8bb37f1a99e66ec0197}{et}} + \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a15b4da36dba827263da4c844028c6db1}{estimate\_clearance\_time}}( veh, veh\_lane);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00474}00474                 \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00475}00475                 \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00476}00476                     \textcolor{comment}{// Can not grant access to vehicle if previous vehicle does not have access yet.}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00477}00477                     sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule_a50640de602629b4f186ab3b8e0a51510}{access}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00478}00478                     \textcolor{comment}{// Set vehicle state. Will not impact clearance time estimation since set on schedule}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00479}00479                     sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule_a1cfe6f93f9f59877dd3585f1f6dbf5c0}{state}} = \mbox{\hyperlink{namespacestreets__vehicles_a41f5c896d8020c141aa96235cf1405acab08ef04fe84cf4f6645fef073717f36f}{streets\_vehicles::vehicle\_state::RDV}};}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00480}00480                     \textcolor{comment}{// Entering time equals schedule time}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00481}00481                     sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule_a7590a81d8cd1d8bb37f1a99e66ec0197}{et}} = option-\/>vehicle\_schedules.back().et;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00482}00482                     \textcolor{comment}{// Departure time equals entering time + clearance time}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00483}00483                     sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule_ab735125526f509961867602dc459f8e6}{dt}} =  sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule_a7590a81d8cd1d8bb37f1a99e66ec0197}{et}} + \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a15b4da36dba827263da4c844028c6db1}{estimate\_clearance\_time}}( veh, veh\_lane); }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00484}00484                 \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00485}00485             \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00486}00486             \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00487}00487                 SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Latest conflicting vehicle is \{0\} and next vehicle is \{1\}"{}}, latest\_conflicting\_vehicle-\/>v\_id, veh.\_id);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00488}00488                 sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule_a50640de602629b4f186ab3b8e0a51510}{access}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00489}00489                 sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule_a1cfe6f93f9f59877dd3585f1f6dbf5c0}{state}} =  \mbox{\hyperlink{namespacestreets__vehicles_a41f5c896d8020c141aa96235cf1405acab08ef04fe84cf4f6645fef073717f36f}{streets\_vehicles::vehicle\_state::RDV}};}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00490}00490                 sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule_a7590a81d8cd1d8bb37f1a99e66ec0197}{et}} =  std::max(latest\_conflicting\_vehicle-\/>dt, option-\/>vehicle\_schedules.back().et);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00491}00491                 \textcolor{comment}{// Departure time is estimated clearance time for vehicle and link lane plus entering time}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00492}00492                 sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule_ab735125526f509961867602dc459f8e6}{dt}} = sched.\mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule_a7590a81d8cd1d8bb37f1a99e66ec0197}{et}} + \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a15b4da36dba827263da4c844028c6db1}{estimate\_clearance\_time}}( veh, veh\_lane );}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00493}00493 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00494}00494                 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00495}00495             \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00496}00496             \textcolor{comment}{// Add vehicle schedule to option}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00497}00497             option-\/>vehicle\_schedules.push\_back(sched);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00498}00498             \textcolor{comment}{// Point to new previously scheduled vehicle}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00499}00499             \textcolor{comment}{// Increment departure position}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00500}00500             starting\_departure\_position++;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00501}00501 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00502}00502             }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00503}00503         \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00504}00504         SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Schedule Option: \(\backslash\)n"{}}+option-\/>toCSV());}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00505}00505         SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}With delay \{0\}."{}} ,option-\/>get\_delay() );}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00506}00506         \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00507}00507 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00508}00508             }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00509}00509     \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00510}00510 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00511}\mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a15b4da36dba827263da4c844028c6db1}{00511}}     uint64\_t \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a15b4da36dba827263da4c844028c6db1}{all\_stop\_vehicle\_scheduler::estimate\_clearance\_time}}( \textcolor{keyword}{const} \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\_vehicles::vehicle}} \&veh, }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00512}00512                                                                     \textcolor{keyword}{const} \mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info}{OpenAPI::OAILanelet\_info}} \&link\_lane\_info)\textcolor{keyword}{ const}\{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00513}00513         \textcolor{comment}{// Clearance time in seconds }}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00514}00514         \textcolor{keywordtype}{double} clearance\_time = 0;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00515}00515         \textcolor{comment}{// If vehicle is Departing Vehicle consider its location in the link lanelet.}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00516}00516         \textcolor{keywordflow}{if} ( veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a54872859b3a12ee290b98e0eedd2864f}{\_cur\_state}} == \mbox{\hyperlink{namespacestreets__vehicles_a41f5c896d8020c141aa96235cf1405aca58d6a88f13e2db7f5059c41047876f00}{streets\_vehicles::vehicle\_state::DV}} ) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00517}00517             \textcolor{comment}{// Distance covered during constant max acceleration to speed limit}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00518}00518             \textcolor{keywordtype}{double} constant\_acceleration\_delta\_x = (pow(link\_lane\_info.\mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info_a9ed2860829d5aeba3062f26e78afcbdc}{getSpeedLimit}}(), 2) -\/ pow( veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a026375b9e6ffc8f8c8aee72465f352dc}{\_cur\_speed}}, 2))/(2* veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a1180998ca4eeb7d695d135a1e4a75424}{\_accel\_max}});}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00519}00519             \textcolor{comment}{// If vehicle accelerates to speed limit with max acceleration is it still in link lanelet}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00520}00520             \textcolor{keywordflow}{if} ( veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a21a6378ca2401ac4bc9ca6f6364833fb}{\_cur\_distance}} > constant\_acceleration\_delta\_x ) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00521}00521                 clearance\_time = ( 2 * veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a1180998ca4eeb7d695d135a1e4a75424}{\_accel\_max}} * veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a21a6378ca2401ac4bc9ca6f6364833fb}{\_cur\_distance}} -\/ link\_lane\_info.\mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info_a9ed2860829d5aeba3062f26e78afcbdc}{getSpeedLimit}}()*veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a026375b9e6ffc8f8c8aee72465f352dc}{\_cur\_speed}} + pow(veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a026375b9e6ffc8f8c8aee72465f352dc}{\_cur\_speed}}, 2))/}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00522}00522                     (2*veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a1180998ca4eeb7d695d135a1e4a75424}{\_accel\_max}}*link\_lane\_info.\mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info_a9ed2860829d5aeba3062f26e78afcbdc}{getSpeedLimit}}());}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00523}00523             \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00524}00524                 clearance\_time = (sqrt(pow(veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a026375b9e6ffc8f8c8aee72465f352dc}{\_cur\_speed}}, 2)+2*veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a1180998ca4eeb7d695d135a1e4a75424}{\_accel\_max}}*veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a21a6378ca2401ac4bc9ca6f6364833fb}{\_cur\_distance}}) -\/veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a026375b9e6ffc8f8c8aee72465f352dc}{\_cur\_speed}})/}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00525}00525                         veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a1180998ca4eeb7d695d135a1e4a75424}{\_accel\_max}};}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00526}00526             \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00527}00527 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00528}00528         \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00529}00529         \textcolor{comment}{// Consider vehicle is stopped at stop bar}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00530}00530         \textcolor{keywordflow}{else}  \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00531}00531             \textcolor{comment}{// Distance covered during constant max acceleration to speed limit assuming initial 0 speed.}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00532}00532             \textcolor{keywordtype}{double} constant\_acceleration\_delta\_x = pow(link\_lane\_info.\mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info_a9ed2860829d5aeba3062f26e78afcbdc}{getSpeedLimit}}(), 2) / (2 * veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a1180998ca4eeb7d695d135a1e4a75424}{\_accel\_max}});}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00533}00533             \textcolor{comment}{// If vehicle accelerates to speed limit with max acceleration is it still in the link lanelet}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00534}00534             \textcolor{keywordflow}{if} ( constant\_acceleration\_delta\_x < link\_lane\_info.\mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info_abc1c4d5d24a2dafb175874ecad09cfad}{getLength}}())\{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00535}00535                 \textcolor{comment}{// If yes assume vehicle cruises at speed limit for the duration of the lanelet}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00536}00536                 clearance\_time = link\_lane\_info.\mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info_abc1c4d5d24a2dafb175874ecad09cfad}{getLength}}() / link\_lane\_info.\mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info_a9ed2860829d5aeba3062f26e78afcbdc}{getSpeedLimit}}() + }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00537}00537                             link\_lane\_info.\mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info_a9ed2860829d5aeba3062f26e78afcbdc}{getSpeedLimit}}() / (2 *veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a1180998ca4eeb7d695d135a1e4a75424}{\_accel\_max}});}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00538}00538             \} \textcolor{keywordflow}{else}\{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00539}00539                 \textcolor{comment}{// If not assume vehicle trajectory is constant acceleration from initial speed of 0}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00540}00540                 clearance\_time = sqrt(2 * link\_lane\_info.\mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info_abc1c4d5d24a2dafb175874ecad09cfad}{getLength}}() / veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a1180998ca4eeb7d695d135a1e4a75424}{\_accel\_max}}) ;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00541}00541             \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00542}00542         \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00543}00543         \textcolor{comment}{// Convert time to milliseconds and round up.}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00544}00544         \textcolor{keywordflow}{return} \textcolor{keyword}{static\_cast<}uint64\_t\textcolor{keyword}{>}(ceil(1000.0* clearance\_time));}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00545}00545     \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00546}00546 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00547}\mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_aa06721804b8a4075b98c2e8ad40c84da}{00547}}     std::shared\_ptr<all\_stop\_vehicle\_schedule> \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_aa06721804b8a4075b98c2e8ad40c84da}{all\_stop\_vehicle\_scheduler::get\_latest\_conflicting}}(\textcolor{keyword}{const} \mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info}{OpenAPI::OAILanelet\_info}} \&link\_lane, }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00548}00548                                                                                 \textcolor{keyword}{const} std::vector<all\_stop\_vehicle\_schedule> \&schedules)\textcolor{keyword}{ const }\{       }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00549}00549         std::shared\_ptr<all\_stop\_vehicle\_schedule> conflict = \textcolor{keyword}{nullptr}; }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00550}00550 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00551}00551         \textcolor{comment}{// Loop through all scheduled vehicles and return conflict with largest dt}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00552}00552         \textcolor{keywordflow}{for} ( \textcolor{keyword}{const} \textcolor{keyword}{auto} \&sched : schedules ) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00553}00553             \textcolor{comment}{// check if that have conflict with link\_lane}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00554}00554             \textcolor{keywordflow}{if} ( link\_lane.\mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info_ae71cdbd0f92de4b223a654f03d2112c6}{getConflictLaneletIds}}().contains(sched.link\_id)) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00555}00555                 \textcolor{comment}{// If no conflicting schedule has been set yet set conflict to first conflicting }}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00556}00556                 \textcolor{keywordflow}{if} ( conflict == \textcolor{keyword}{nullptr} ) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00557}00557                     conflict = std::make\_shared<all\_stop\_vehicle\_schedule>( sched);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00558}00558                 \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00559}00559                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( conflict-\/>dt < sched.dt ) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00560}00560                     conflict = std::make\_shared<all\_stop\_vehicle\_schedule>( sched);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00561}00561                 \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00562}00562             \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00563}00563             }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00564}00564         \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00565}00565         \textcolor{keywordflow}{return} conflict;                                              }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00566}00566     \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00567}\mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a223e57041ae7ca6c4810877c8c74a49e}{00567}}     \textcolor{keywordtype}{void} \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a223e57041ae7ca6c4810877c8c74a49e}{all\_stop\_vehicle\_scheduler::remove\_rdv\_previously\_granted\_access}}( \textcolor{keyword}{const} \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\_vehicles::vehicle}} \&veh) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00568}00568         \textcolor{keyword}{auto} previously\_granted\_itr = \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a77c53828e29e53a9a7ff752afb65b549}{rdvs\_previously\_granted\_access}}.begin();}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00569}00569         \textcolor{keywordflow}{while} ( previously\_granted\_itr != \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a77c53828e29e53a9a7ff752afb65b549}{rdvs\_previously\_granted\_access}}.end() ) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00570}00570             \textcolor{keywordflow}{if} ( previously\_granted\_itr-\/>\_id == veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a470605f661a8f625329ebbb10888e2b8}{\_id}} ) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00571}00571                 SPDLOG\_INFO(\textcolor{stringliteral}{"{}Removing DV \{0\} from list of RDVs previously granted access."{}}, previously\_granted\_itr-\/>\_id);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00572}00572                 \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a77c53828e29e53a9a7ff752afb65b549}{rdvs\_previously\_granted\_access}}.erase(previously\_granted\_itr);}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00573}00573                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00574}00574             \}\textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00575}00575                 previously\_granted\_itr++;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00576}00576             \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00577}00577         \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00578}00578     \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00579}00579 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00580}\mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a35eb7b98052f4ef88850471478fcdddb}{00580}}     \textcolor{keywordtype}{bool} \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a35eb7b98052f4ef88850471478fcdddb}{all\_stop\_vehicle\_scheduler::is\_rdv\_previously\_granted\_access}}( \textcolor{keyword}{const} \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\_vehicles::vehicle}} \&veh)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00581}00581         \textcolor{keywordflow}{if} ( \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a77c53828e29e53a9a7ff752afb65b549}{rdvs\_previously\_granted\_access}}.empty() ) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00582}00582             \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00583}00583         \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00584}00584         \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00585}00585             \textcolor{keywordflow}{for} ( \textcolor{keyword}{const} \textcolor{keyword}{auto} \&rdv: \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a77c53828e29e53a9a7ff752afb65b549}{rdvs\_previously\_granted\_access}} ) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00586}00586                 \textcolor{keywordflow}{if} ( rdv.\_id == veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a470605f661a8f625329ebbb10888e2b8}{\_id}} ) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00587}00587                     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00588}00588                 \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00589}00589             \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00590}00590             \textcolor{comment}{// not in list}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00591}00591             \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00592}00592         \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00593}00593     \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00594}00594 }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00595}\mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a0cf6941cc406bbd51889c129231e9443}{00595}}     \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\_vehicles::vehicle}} \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a0cf6941cc406bbd51889c129231e9443}{all\_stop\_vehicle\_scheduler::get\_vehicle\_with\_id}}( \textcolor{keyword}{const} std::list<streets\_vehicles::vehicle> \&veh\_list, \textcolor{keyword}{const} std::string \&veh\_id )\textcolor{keyword}{ const }\{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00596}00596         \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\_vehicles::vehicle}} rtn;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00597}00597         \textcolor{keywordtype}{bool} found\_veh = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00598}00598         \textcolor{keywordflow}{if} ( veh\_list.empty() ) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00599}00599             \textcolor{keywordflow}{throw} \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1scheduling__exception}{scheduling\_exception}}(\textcolor{stringliteral}{"{}Vehicle List is empty!"{}});}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00600}00600             }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00601}00601         \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00602}00602         \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00603}00603             \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto} \&veh : veh\_list ) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00604}00604                 \textcolor{keywordflow}{if} ( veh.\_id == veh\_id ) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00605}00605                     rtn = veh; }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00606}00606                     found\_veh = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00607}00607                 \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00608}00608             \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00609}00609         \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00610}00610         \textcolor{keywordflow}{if} (!found\_veh) \{}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00611}00611             \textcolor{keywordflow}{throw} \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1scheduling__exception}{scheduling\_exception}}(\textcolor{stringliteral}{"{}Vehicle"{}} +  veh\_id + \textcolor{stringliteral}{"{} not found!"{}});}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00612}00612  }
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00613}00613         \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00614}00614         \textcolor{keywordflow}{return} rtn;}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00615}00615     \}}
\DoxyCodeLine{\Hypertarget{all__stop__vehicle__scheduler_8cpp_source_l00616}00616 \}}

\end{DoxyCode}
