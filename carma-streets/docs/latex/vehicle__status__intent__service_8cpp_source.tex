\hypertarget{vehicle__status__intent__service_8cpp_source}{}\doxysection{vehicle\+\_\+status\+\_\+intent\+\_\+service.\+cpp}
\label{vehicle__status__intent__service_8cpp_source}\index{message\_services/src/services/vehicle\_status\_intent\_service.cpp@{message\_services/src/services/vehicle\_status\_intent\_service.cpp}}
\mbox{\hyperlink{vehicle__status__intent__service_8cpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00001}00001 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{vehicle__status__intent__service_8h}{vehicle\_status\_intent\_service.h}}"{}}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00002}00002 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00003}00003 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00004}00004 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00005}00005 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespacemessage__services}{message\_services}}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00006}00006 \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00007}00007 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00008}00008     \textcolor{keyword}{namespace }services}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00009}00009     \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00010}\mbox{\hyperlink{namespacemessage__services_1_1services_a4b7d4a8ab4ecfa31372593ca82fc843b}{00010}}         std::mutex \mbox{\hyperlink{namespacemessage__services_1_1services_a4b7d4a8ab4ecfa31372593ca82fc843b}{worker\_mtx}};}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00011}\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a257602e1d44824c7dd62df8ed5c5d2c0}{00011}}         \mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a257602e1d44824c7dd62df8ed5c5d2c0}{vehicle\_status\_intent\_service::vehicle\_status\_intent\_service}}() \{\}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00012}00012 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00013}00013 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00014}00014 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00015}\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a037ead29156388388d54f0e15234cfb7}{00015}}         \textcolor{keywordtype}{bool} \mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a037ead29156388388d54f0e15234cfb7}{vehicle\_status\_intent\_service::initialize}}(std::shared\_ptr<message\_translations::message\_lanelet2\_translation> msg\_lanelet2\_translate\_ptr)}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00016}00016         \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00017}00017             \textcolor{keywordflow}{try}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00018}00018             \{               }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00019}00019                 \textcolor{keyword}{auto} client = std::make\_shared<kafka\_clients::kafka\_client>();}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00020}00020 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00021}00021                 \textcolor{comment}{// kafka config}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00022}00022                 this-\/>\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a3bf985f4fc3fa806ddc8f5e281c00996}{bootstrap\_server}} = \mbox{\hyperlink{classstreets__service_1_1streets__configuration_a03603871626201e07690effb9f2440bf}{streets\_service::streets\_configuration::get\_string\_config}}(\textcolor{stringliteral}{"{}bootstrap\_server"{}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00023}00023 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00024}00024                 \textcolor{comment}{// consumer topics}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00025}00025                 this-\/>\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_aa6a07f8b2e2d190625385a9ddf1183c6}{bsm\_topic\_name}} = \mbox{\hyperlink{classstreets__service_1_1streets__configuration_a03603871626201e07690effb9f2440bf}{streets\_service::streets\_configuration::get\_string\_config}}(\textcolor{stringliteral}{"{}bsm\_consumer\_topic"{}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00026}00026                 this-\/>\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a1d329e164b88b28fbcc12ff70b09de2a}{bsm\_group\_id}} = \mbox{\hyperlink{classstreets__service_1_1streets__configuration_a03603871626201e07690effb9f2440bf}{streets\_service::streets\_configuration::get\_string\_config}}(\textcolor{stringliteral}{"{}bsm\_group\_id"{}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00027}00027 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00028}00028                 this-\/>\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a5c7c813aeab10449c1b2bf908602b9d9}{mp\_topic\_name}} = \mbox{\hyperlink{classstreets__service_1_1streets__configuration_a03603871626201e07690effb9f2440bf}{streets\_service::streets\_configuration::get\_string\_config}}(\textcolor{stringliteral}{"{}mp\_consumer\_topic"{}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00029}00029                 this-\/>\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a21fbc46d2c2fce0b5f63270775604ea5}{mp\_group\_id}} = \mbox{\hyperlink{classstreets__service_1_1streets__configuration_a03603871626201e07690effb9f2440bf}{streets\_service::streets\_configuration::get\_string\_config}}(\textcolor{stringliteral}{"{}mp\_group\_id"{}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00030}00030 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00031}00031                 this-\/>\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a2a9b4dba868e19ee1dfba50bd58a46c4}{mo\_topic\_name}} = \mbox{\hyperlink{classstreets__service_1_1streets__configuration_a03603871626201e07690effb9f2440bf}{streets\_service::streets\_configuration::get\_string\_config}}(\textcolor{stringliteral}{"{}mo\_consumer\_topic"{}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00032}00032                 this-\/>\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_ad9548dbec8a0b4f760043d09029b9e38}{mo\_group\_id}} = \mbox{\hyperlink{classstreets__service_1_1streets__configuration_a03603871626201e07690effb9f2440bf}{streets\_service::streets\_configuration::get\_string\_config}}(\textcolor{stringliteral}{"{}mo\_group\_id"{}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00033}00033 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00034}00034                 \textcolor{comment}{// producer topics}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00035}00035                 this-\/>\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a3f2850c83fa4e58b87f55429f30aefd0}{vsi\_topic\_name}} = \mbox{\hyperlink{classstreets__service_1_1streets__configuration_a03603871626201e07690effb9f2440bf}{streets\_service::streets\_configuration::get\_string\_config}}(\textcolor{stringliteral}{"{}vsi\_producer\_topic"{}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00036}00036 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00037}00037                 \mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a6272fce72c93356057183fcbcdc69d81}{\_bsm\_consumer\_worker}} = client-\/>create\_consumer(this-\/>\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a3bf985f4fc3fa806ddc8f5e281c00996}{bootstrap\_server}}, this-\/>\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_aa6a07f8b2e2d190625385a9ddf1183c6}{bsm\_topic\_name}}, this-\/>\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a1d329e164b88b28fbcc12ff70b09de2a}{bsm\_group\_id}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00038}00038                 \mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_af7dd9ed40494b323fbf94d5bdbee4e03}{\_mp\_consumer\_worker}} = client-\/>create\_consumer(this-\/>\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a3bf985f4fc3fa806ddc8f5e281c00996}{bootstrap\_server}}, this-\/>\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a5c7c813aeab10449c1b2bf908602b9d9}{mp\_topic\_name}}, this-\/>\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a21fbc46d2c2fce0b5f63270775604ea5}{mp\_group\_id}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00039}00039                 \mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a0bbcebca8d1fe2e82d58e4823a75b5cc}{\_mo\_consumer\_worker}} = client-\/>create\_consumer(this-\/>\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a3bf985f4fc3fa806ddc8f5e281c00996}{bootstrap\_server}}, this-\/>\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a2a9b4dba868e19ee1dfba50bd58a46c4}{mo\_topic\_name}}, this-\/>\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_ad9548dbec8a0b4f760043d09029b9e38}{mo\_group\_id}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00040}00040 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00041}00041                 \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a6272fce72c93356057183fcbcdc69d81}{\_bsm\_consumer\_worker}}-\/>init() || !\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_af7dd9ed40494b323fbf94d5bdbee4e03}{\_mp\_consumer\_worker}}-\/>init() || !\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a0bbcebca8d1fe2e82d58e4823a75b5cc}{\_mo\_consumer\_worker}}-\/>init())}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00042}00042                 \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00043}00043                     SPDLOG\_CRITICAL(\textcolor{stringliteral}{"{}kafka consumers (\_bsm\_consumer\_worker, \_mp\_consumer\_worker or \_mo\_consumer\_worker) initialize error"{}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00044}00044                 \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00045}00045                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00046}00046                 \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00047}00047                     \mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a6272fce72c93356057183fcbcdc69d81}{\_bsm\_consumer\_worker}}-\/>subscribe();}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00048}00048                     \mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_af7dd9ed40494b323fbf94d5bdbee4e03}{\_mp\_consumer\_worker}}-\/>subscribe();}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00049}00049                     \mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a0bbcebca8d1fe2e82d58e4823a75b5cc}{\_mo\_consumer\_worker}}-\/>subscribe();}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00050}00050                     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a6272fce72c93356057183fcbcdc69d81}{\_bsm\_consumer\_worker}}-\/>is\_running() || !\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_af7dd9ed40494b323fbf94d5bdbee4e03}{\_mp\_consumer\_worker}}-\/>is\_running() || !\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a0bbcebca8d1fe2e82d58e4823a75b5cc}{\_mo\_consumer\_worker}}-\/>is\_running())}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00051}00051                     \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00052}00052                         SPDLOG\_CRITICAL(\textcolor{stringliteral}{"{}consumer\_workers (\_bsm\_consumer\_worker, \_mp\_consumer\_worker or \_mo\_consumer\_worker) is not running"{}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00053}00053                         exit(-\/1);}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00054}00054                     \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00055}00055                 \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00056}00056 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00057}00057                 this-\/>\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_af0f31eaef9d77a89e351f37ec9201235}{\_vsi\_producer\_worker}} = client-\/>create\_producer(this-\/>\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a3bf985f4fc3fa806ddc8f5e281c00996}{bootstrap\_server}}, this-\/>\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a3f2850c83fa4e58b87f55429f30aefd0}{vsi\_topic\_name}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00058}00058                 \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_af0f31eaef9d77a89e351f37ec9201235}{\_vsi\_producer\_worker}}-\/>init())}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00059}00059                 \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00060}00060                     SPDLOG\_CRITICAL(\textcolor{stringliteral}{"{}kafka producer (\_vsi\_producer\_worker) initialize error"{}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00061}00061                     exit(-\/1);}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00062}00062                 \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00063}00063 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00064}00064                 this-\/>\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a8825fbe5dddce9c54ebd8d0e44cc92d5}{vsi\_est\_path\_point\_count}} = \mbox{\hyperlink{classstreets__service_1_1streets__configuration_ab33a5d183c0ca2b2f0d757f5466f200b}{streets\_service::streets\_configuration::get\_int\_config}}(\textcolor{stringliteral}{"{}vsi\_est\_path\_count"{}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00065}00065                 this-\/>\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_afb8d701d325db8deb6755090db8026e3}{MOBILITY\_PATH\_TRAJECTORY\_OFFSET\_DURATION}} = \mbox{\hyperlink{classstreets__service_1_1streets__configuration_ab33a5d183c0ca2b2f0d757f5466f200b}{streets\_service::streets\_configuration::get\_int\_config}}(\textcolor{stringliteral}{"{}mobility\_path\_trajectory\_offset\_duration"{}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00066}00066                 this-\/>\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a896a975dbedfc8f3d0e7aea120523f71}{VSI\_TH\_SLEEP\_MILLI\_SEC}} = \mbox{\hyperlink{classstreets__service_1_1streets__configuration_ab33a5d183c0ca2b2f0d757f5466f200b}{streets\_service::streets\_configuration::get\_int\_config}}(\textcolor{stringliteral}{"{}vsi\_th\_sleep\_milli\_sec"{}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00067}00067                 this-\/>\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a268bf943c5d0a89ffbbea67b0cf3eafb}{BSM\_MSG\_EXPIRE\_IN\_SEC}} = \mbox{\hyperlink{classstreets__service_1_1streets__configuration_ab33a5d183c0ca2b2f0d757f5466f200b}{streets\_service::streets\_configuration::get\_int\_config}}(\textcolor{stringliteral}{"{}bsm\_msg\_expire\_in\_sec"{}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00068}00068                 this-\/>\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a855ffa82acb58cc0daebca434cc12e2a}{CLEAN\_QUEUE\_IN\_SECS}} = \mbox{\hyperlink{classstreets__service_1_1streets__configuration_ab33a5d183c0ca2b2f0d757f5466f200b}{streets\_service::streets\_configuration::get\_int\_config}}(\textcolor{stringliteral}{"{}clean\_queue\_in\_secs"{}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00069}00069                 this-\/>\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a489996d8e9d01a5562c94c02e37c7584}{disable\_est\_path}} = \mbox{\hyperlink{classstreets__service_1_1streets__configuration_a48f38b0b6ecb3043cc051b624f12824b}{streets\_service::streets\_configuration::get\_boolean\_config}}(\textcolor{stringliteral}{"{}disable\_est\_path"{}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00070}00070                 this-\/>\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a229d4f5393c32a0d1c66ab186a821724}{is\_est\_path\_p2p\_distance\_only}} = \mbox{\hyperlink{classstreets__service_1_1streets__configuration_a48f38b0b6ecb3043cc051b624f12824b}{streets\_service::streets\_configuration::get\_boolean\_config}}(\textcolor{stringliteral}{"{}is\_est\_path\_p2p\_distance\_only"{}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00071}00071 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00072}00072                 this-\/>\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a838f02c78c01aec373cc5e9dd62bd616}{\_msg\_lanelet2\_translate\_ptr}} = msg\_lanelet2\_translate\_ptr;}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00073}00073 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00074}00074                 \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00075}00075             \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00076}00076             \textcolor{keywordflow}{catch} ( \textcolor{keyword}{const} \mbox{\hyperlink{classstreets__service_1_1streets__configuration__exception}{streets\_service::streets\_configuration\_exception}} \&ex ) \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00077}00077                 SPDLOG\_ERROR(\textcolor{stringliteral}{"{}Vehicle status Intent Service Initialization failure: \{0\} "{}}, ex.what());}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00078}00078                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00079}00079             \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00080}00080         \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00081}00081 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00082}\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a8cf177c69275dd3df6e35085eb011bce}{00082}}         \mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a8cf177c69275dd3df6e35085eb011bce}{vehicle\_status\_intent\_service::\string~vehicle\_status\_intent\_service}}()}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00083}00083         \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00084}00084             \textcolor{keywordflow}{if} (\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a6272fce72c93356057183fcbcdc69d81}{\_bsm\_consumer\_worker}})}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00085}00085             \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00086}00086                 \mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a6272fce72c93356057183fcbcdc69d81}{\_bsm\_consumer\_worker}}-\/>stop();}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00087}00087             \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00088}00088 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00089}00089             \textcolor{keywordflow}{if} (\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a0bbcebca8d1fe2e82d58e4823a75b5cc}{\_mo\_consumer\_worker}})}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00090}00090             \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00091}00091                 \mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a0bbcebca8d1fe2e82d58e4823a75b5cc}{\_mo\_consumer\_worker}}-\/>stop();}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00092}00092             \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00093}00093 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00094}00094             \textcolor{keywordflow}{if} (\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_af7dd9ed40494b323fbf94d5bdbee4e03}{\_mp\_consumer\_worker}})}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00095}00095             \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00096}00096                 \mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_af7dd9ed40494b323fbf94d5bdbee4e03}{\_mp\_consumer\_worker}}-\/>stop();}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00097}00097             \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00098}00098         \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00099}00099 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00100}\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a1f00f479f5268cf6cd38a128d009b184}{00100}}         \textcolor{keywordtype}{void} \mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a1f00f479f5268cf6cd38a128d009b184}{vehicle\_status\_intent\_service::start}}()}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00101}00101         \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00102}00102             std::shared\_ptr<message\_services::workers::bsm\_worker> bsm\_w\_ptr = std::make\_shared<message\_services::workers::bsm\_worker>();}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00103}00103             std::shared\_ptr<message\_services::workers::mobilitypath\_worker> mp\_w\_ptr = std::make\_shared<message\_services::workers::mobilitypath\_worker>();}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00104}00104             std::shared\_ptr<message\_services::workers::mobilityoperation\_worker> mo\_w\_ptr = std::make\_shared<message\_services::workers::mobilityoperation\_worker>();}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00105}00105             std::shared\_ptr<message\_services::workers::vehicle\_status\_intent\_worker> vsi\_w\_ptr = std::make\_shared<message\_services::workers::vehicle\_status\_intent\_worker>();}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00106}00106             \mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_ad24055517d5aaa2f6ea44b7f35f3e0e9}{run}}(bsm\_w\_ptr, mp\_w\_ptr, mo\_w\_ptr);}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00107}00107         \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00108}00108 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00109}\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_ad24055517d5aaa2f6ea44b7f35f3e0e9}{00109}}         \textcolor{keywordtype}{void} \mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_ad24055517d5aaa2f6ea44b7f35f3e0e9}{vehicle\_status\_intent\_service::run}}(std::shared\_ptr<message\_services::workers::bsm\_worker> bsm\_w\_ptr,}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00110}00110                                                 std::shared\_ptr<message\_services::workers::mobilitypath\_worker> mp\_w\_ptr,}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00111}00111                                                 std::shared\_ptr<message\_services::workers::mobilityoperation\_worker> mo\_w\_ptr)}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00112}00112         \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00113}00113             std::thread mp\_t(\&vehicle\_status\_intent\_service::msg\_consumer<workers::mobilitypath\_worker>, \textcolor{keyword}{this}, std::ref(mp\_w\_ptr), this-\/>\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_af7dd9ed40494b323fbf94d5bdbee4e03}{\_mp\_consumer\_worker}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00114}00114             std::thread bsm\_t(\&vehicle\_status\_intent\_service::msg\_consumer<workers::bsm\_worker>, \textcolor{keyword}{this}, std::ref(bsm\_w\_ptr), this-\/>\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a6272fce72c93356057183fcbcdc69d81}{\_bsm\_consumer\_worker}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00115}00115             std::thread mo\_t(\&vehicle\_status\_intent\_service::msg\_consumer<workers::mobilityoperation\_worker>, \textcolor{keyword}{this}, std::ref(mo\_w\_ptr), this-\/>\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a0bbcebca8d1fe2e82d58e4823a75b5cc}{\_mo\_consumer\_worker}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00116}00116 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00117}00117             std::shared\_ptr<models::vehicle\_status\_intent> vsi\_ptr = std::make\_shared<models::vehicle\_status\_intent>();}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00118}00118 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00119}00119             std::thread vsi\_t\{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00120}00120                 [bsm\_w\_ptr, mo\_w\_ptr, mp\_w\_ptr, \textcolor{keyword}{this}, vsi\_ptr]()}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00121}00121                 \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00122}00122                     \textcolor{keywordflow}{while} (\textcolor{keyword}{true})}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00123}00123                     \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00124}00124                         \textcolor{comment}{// Change spdlog from debug to info for printing output in terminal}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00125}00125                         SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Processing the BSM list size: \{0\}"{}}, bsm\_w\_ptr-\/>get\_curr\_map().size());}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00126}00126                         SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Processing the MobilityOperation list size: \{0\}"{}}, mo\_w\_ptr-\/>get\_curr\_list().size());}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00127}00127                         SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Processing the MobilityPath list size: \{0\}"{}}, mp\_w\_ptr-\/>get\_curr\_map().size());}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00128}00128                         \textcolor{keywordflow}{if} (mo\_w\_ptr \&\& mo\_w\_ptr-\/>get\_curr\_list().size() > 0 \&\& bsm\_w\_ptr \&\& bsm\_w\_ptr-\/>get\_curr\_map().size() > 0 \&\& mp\_w\_ptr \&\& mp\_w\_ptr-\/>get\_curr\_map().size() > 0)}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00129}00129                         \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00130}00130                             SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Processing the BSM, mobilityOperation and MP from list..."{}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00131}00131                             std::unique\_lock<std::mutex> lck(\mbox{\hyperlink{namespacemessage__services_1_1services_a4b7d4a8ab4ecfa31372593ca82fc843b}{worker\_mtx}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00132}00132                             \textcolor{keywordflow}{while} (mo\_w\_ptr \&\& !mo\_w\_ptr-\/>get\_curr\_list().empty())}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00133}00133                             \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00134}00134                                 SPDLOG\_INFO(\textcolor{stringliteral}{"{}MO list SIZE = \{0\}"{}}, mo\_w\_ptr-\/>get\_curr\_list().size());}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00135}00135                                 SPDLOG\_INFO(\textcolor{stringliteral}{"{}MP map SIZE = \{0\}"{}}, mp\_w\_ptr-\/>get\_curr\_map().size());}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00136}00136                                 SPDLOG\_INFO(\textcolor{stringliteral}{"{}BSM map SIZE = \{0\}"{}}, bsm\_w\_ptr-\/>get\_curr\_map().size());}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00137}00137                                 \mbox{\hyperlink{classmessage__services_1_1models_1_1mobilityoperation}{message\_services::models::mobilityoperation}} subj\_mo = mo\_w\_ptr-\/>get\_curr\_list().front();}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00138}00138                                 mo\_w\_ptr-\/>get\_curr\_list().pop\_front();}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00139}00139 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00140}00140                                 \mbox{\hyperlink{classmessage__services_1_1models_1_1mobilitypath}{message\_services::models::mobilitypath}} subj\_mp;}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00141}00141                                 \mbox{\hyperlink{classmessage__services_1_1models_1_1bsm}{message\_services::models::bsm}} subj\_bsm;}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00142}00142                                 \textcolor{keywordtype}{bool} is\_bsm\_msg\_count\_id\_found = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00143}00143                                 std::time\_t cur\_local\_timestamp = std::chrono::duration\_cast<std::chrono::milliseconds>(std::chrono::system\_clock::now().time\_since\_epoch()).count();}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00144}00144                                 std::string bsm\_msg\_id = subj\_mo.\mbox{\hyperlink{classmessage__services_1_1models_1_1mobilityoperation_abb41d37473812aedacd229dc295d098b}{generate\_hash\_bsm\_msg\_id}}(subj\_mo.\mbox{\hyperlink{classmessage__services_1_1models_1_1mobilityoperation_af120e50b8d8d7609cfba3ff620d34f82}{getHeader}}().\mbox{\hyperlink{structmessage__services_1_1models_1_1mobility__header_aa255791d982853fa272bed31d3e33dd1}{sender\_bsm\_id}}, std::stol(subj\_mo.\mbox{\hyperlink{classmessage__services_1_1models_1_1mobilityoperation_a556c84b1faf40bbd5ec80daf36312ff6}{get\_value\_from\_strategy\_params}}(\textcolor{stringliteral}{"{}msg\_count"{}})), std::stol(subj\_mo.\mbox{\hyperlink{classmessage__services_1_1models_1_1mobilityoperation_a556c84b1faf40bbd5ec80daf36312ff6}{get\_value\_from\_strategy\_params}}(\textcolor{stringliteral}{"{}sec\_mark"{}})));}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00145}00145                                 \textcolor{keywordflow}{if} (bsm\_w\_ptr-\/>get\_curr\_map().find(bsm\_msg\_id) != bsm\_w\_ptr-\/>get\_curr\_map().end())}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00146}00146                                 \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00147}00147                                     subj\_bsm = bsm\_w\_ptr-\/>get\_curr\_map()[bsm\_msg\_id];}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00148}00148 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00149}00149                                     \textcolor{keywordflow}{if} (std::abs(cur\_local\_timestamp -\/ subj\_bsm.\mbox{\hyperlink{classmessage__services_1_1models_1_1bsm_a4c1bcd0bb0507c93553886c6411a276c}{msg\_received\_timestamp\_}}) > (this-\/>BSM\_MSG\_EXPIRE\_IN\_SEC * 1000))}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00150}00150                                     \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00151}00151                                         SPDLOG\_INFO(\textcolor{stringliteral}{"{}BSM EXPIRED \{0\}"{}}, std::abs(cur\_local\_timestamp -\/ subj\_bsm.\mbox{\hyperlink{classmessage__services_1_1models_1_1bsm_a4c1bcd0bb0507c93553886c6411a276c}{msg\_received\_timestamp\_}}));}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00152}00152                                         bsm\_w\_ptr-\/>get\_curr\_map().erase(bsm\_msg\_id);}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00153}00153                                         \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00154}00154                                     \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00155}00155                                     is\_bsm\_msg\_count\_id\_found = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00156}00156                                 \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00157}00157                                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00158}00158                                 \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00159}00159                                     \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00160}00160                                 \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00161}00161 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00162}00162                                 std::string sender\_timestamp\_msg\_id = subj\_mo.\mbox{\hyperlink{classmessage__services_1_1models_1_1mobilityoperation_af4081f414e3a8a3515f1191dc91811e3}{generate\_hash\_sender\_timestamp\_id}}(subj\_mo.\mbox{\hyperlink{classmessage__services_1_1models_1_1mobilityoperation_af120e50b8d8d7609cfba3ff620d34f82}{getHeader}}().\mbox{\hyperlink{structmessage__services_1_1models_1_1mobility__header_ab1e13a6163e4364c8555b1f76266b90e}{sender\_id}}, subj\_mo.\mbox{\hyperlink{classmessage__services_1_1models_1_1mobilityoperation_af120e50b8d8d7609cfba3ff620d34f82}{getHeader}}().\mbox{\hyperlink{structmessage__services_1_1models_1_1mobility__header_a950a8571b2b4426afbe2d26979c2dff4}{timestamp}} / this-\/>MOBILITY\_OPERATION\_PATH\_MAX\_DURATION);}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00163}00163 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00164}00164                                 \textcolor{keywordflow}{if} (is\_bsm\_msg\_count\_id\_found \&\& mp\_w\_ptr-\/>get\_curr\_map().find(sender\_timestamp\_msg\_id) != mp\_w\_ptr-\/>get\_curr\_map().end())}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00165}00165                                 \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00166}00166                                     subj\_mp = mp\_w\_ptr-\/>get\_curr\_map()[sender\_timestamp\_msg\_id];}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00167}00167                                 \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00168}00168                                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00169}00169                                 \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00170}00170                                     \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00171}00171                                 \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00172}00172 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00173}00173                                 *vsi\_ptr = \mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a3e4969a209c1a53596fff646a47fe34b}{compose\_vehicle\_status\_intent}}(subj\_bsm, subj\_mo, subj\_mp);}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00174}00174                                 \textcolor{keywordflow}{if} (vsi\_ptr)}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00175}00175                                 \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00176}00176                                     SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Done composing vehicle\_status\_intent"{}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00177}00177                                     std::string msg\_to\_pub = vsi\_ptr-\/>asJson();}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00178}00178                                     this-\/>publish\_msg<const char *>(msg\_to\_pub.c\_str(), this-\/>\_vsi\_producer\_worker);}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00179}00179                                 \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00180}00180                                 mp\_w\_ptr-\/>get\_curr\_map().erase(sender\_timestamp\_msg\_id);}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00181}00181                                 bsm\_w\_ptr-\/>get\_curr\_map().erase(bsm\_msg\_id);}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00182}00182                             \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00183}00183                         \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00184}00184 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00185}00185                         std::time\_t cur\_timestamp = std::chrono::duration\_cast<std::chrono::milliseconds>(std::chrono::system\_clock::now().time\_since\_epoch()).count();}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00186}00186                         \textcolor{keywordflow}{if} (std::abs(cur\_timestamp -\/ this-\/>\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a12efa9a861d18997202e994b29b5e8a0}{prev\_msg\_expired\_timestamp\_}}) > (this-\/>\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a855ffa82acb58cc0daebca434cc12e2a}{CLEAN\_QUEUE\_IN\_SECS}} * 1000))}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00187}00187                         \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00188}00188                             SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Clean the BSM and MP..."{}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00189}00189                             SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}MO list SIZE = \{0\}"{}}, mo\_w\_ptr-\/>get\_curr\_list().size());}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00190}00190                             SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}MP map SIZE = \{0\}"{}}, mp\_w\_ptr-\/>get\_curr\_map().size());}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00191}00191                             SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}BSM map SIZE = \{0\}"{}}, bsm\_w\_ptr-\/>get\_curr\_map().size());}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00192}00192 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00193}00193                             \textcolor{keywordflow}{if} (mp\_w\_ptr \&\& !mp\_w\_ptr-\/>get\_curr\_map().empty())}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00194}00194                             \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00195}00195                                 SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Clean the MP..."{}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00196}00196                                 \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} itr = mp\_w\_ptr-\/>get\_curr\_map().cbegin(); itr != mp\_w\_ptr-\/>get\_curr\_map().cend();)}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00197}00197                                 \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00198}00198                                     \textcolor{keywordflow}{if} (mp\_w\_ptr \&\& std::abs(cur\_timestamp -\/ itr-\/>second.msg\_received\_timestamp\_) > (this-\/>CLEAN\_QUEUE\_IN\_SECS * 1000))}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00199}00199                                     \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00200}00200                                         std::unique\_lock<std::mutex> lck(\mbox{\hyperlink{namespacemessage__services_1_1services_a4b7d4a8ab4ecfa31372593ca82fc843b}{worker\_mtx}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00201}00201                                         mp\_w\_ptr-\/>get\_curr\_map().erase(itr++);}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00202}00202                                     \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00203}00203                                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00204}00204                                     \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00205}00205                                         ++itr;}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00206}00206                                     \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00207}00207                                 \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00208}00208                                 SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Cleaned the MP."{}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00209}00209                             \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00210}00210 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00211}00211                             \textcolor{keywordflow}{if} (bsm\_w\_ptr \&\& !bsm\_w\_ptr-\/>get\_curr\_map().empty())}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00212}00212                             \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00213}00213                                 SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Clean the BSM..."{}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00214}00214                                 \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} itr = bsm\_w\_ptr-\/>get\_curr\_map().cbegin(); itr != bsm\_w\_ptr-\/>get\_curr\_map().cend();)}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00215}00215                                 \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00216}00216                                     \textcolor{keywordflow}{if} (bsm\_w\_ptr \&\& std::abs(cur\_timestamp -\/ itr-\/>second.msg\_received\_timestamp\_) > (this-\/>CLEAN\_QUEUE\_IN\_SECS * 1000))}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00217}00217                                     \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00218}00218                                         std::unique\_lock<std::mutex> lck(\mbox{\hyperlink{namespacemessage__services_1_1services_a4b7d4a8ab4ecfa31372593ca82fc843b}{worker\_mtx}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00219}00219                                         bsm\_w\_ptr-\/>get\_curr\_map().erase(itr++);}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00220}00220                                     \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00221}00221                                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00222}00222                                     \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00223}00223                                         ++itr;}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00224}00224                                     \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00225}00225                                 \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00226}00226                                 SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Cleaned the BSM."{}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00227}00227                             \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00228}00228 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00229}00229                             \mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a12efa9a861d18997202e994b29b5e8a0}{prev\_msg\_expired\_timestamp\_}} = cur\_timestamp;}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00230}00230                         \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00231}00231                         std::this\_thread::sleep\_for(std::chrono::milliseconds(this-\/>\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a896a975dbedfc8f3d0e7aea120523f71}{VSI\_TH\_SLEEP\_MILLI\_SEC}}));}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00232}00232                     \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00233}00233                 \}\};}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00234}00234 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00235}00235             vsi\_t.join();}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00236}00236             mp\_t.join();}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00237}00237             mo\_t.join();}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00238}00238             bsm\_t.join();}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00239}00239         \}     }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00240}00240 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00241}\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a3e4969a209c1a53596fff646a47fe34b}{00241}}         \mbox{\hyperlink{classmessage__services_1_1models_1_1vehicle__status__intent}{models::vehicle\_status\_intent}} \mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a3e4969a209c1a53596fff646a47fe34b}{vehicle\_status\_intent\_service::compose\_vehicle\_status\_intent}}(\mbox{\hyperlink{classmessage__services_1_1models_1_1bsm}{models::bsm}} \&bsm,}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00242}00242                                                                                                    \mbox{\hyperlink{classmessage__services_1_1models_1_1mobilityoperation}{models::mobilityoperation}} \&mo,}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00243}00243                                                                                                    \mbox{\hyperlink{classmessage__services_1_1models_1_1mobilitypath}{models::mobilitypath}} \&mp)}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00244}00244         \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00245}00245             \mbox{\hyperlink{classmessage__services_1_1models_1_1vehicle__status__intent}{models::vehicle\_status\_intent}} vsi;}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00246}00246             \textcolor{keywordflow}{try}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00247}00247             \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00248}00248                 vsi.\mbox{\hyperlink{classmessage__services_1_1models_1_1vehicle__status__intent_a2cefe1ed615e057a55c6fd32b85a2066}{setVehicle\_id}}(mo.\mbox{\hyperlink{classmessage__services_1_1models_1_1mobilityoperation_af120e50b8d8d7609cfba3ff620d34f82}{getHeader}}().\mbox{\hyperlink{structmessage__services_1_1models_1_1mobility__header_ab1e13a6163e4364c8555b1f76266b90e}{sender\_id}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00249}00249                 vsi.\mbox{\hyperlink{classmessage__services_1_1models_1_1vehicle__status__intent_aa1e269c8873f40dee9ec438b3b34fc96}{setDepart\_position}}(std::stol(mo.\mbox{\hyperlink{classmessage__services_1_1models_1_1mobilityoperation_a556c84b1faf40bbd5ec80daf36312ff6}{get\_value\_from\_strategy\_params}}(\textcolor{stringliteral}{"{}depart\_pos"{}})));}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00250}00250                 vsi.\mbox{\hyperlink{classmessage__services_1_1models_1_1vehicle__status__intent_a6974225b7b4b7c54260f1d4c376dd533}{setCur\_timestamp}}(mo.\mbox{\hyperlink{classmessage__services_1_1models_1_1mobilityoperation_af120e50b8d8d7609cfba3ff620d34f82}{getHeader}}().\mbox{\hyperlink{structmessage__services_1_1models_1_1mobility__header_a950a8571b2b4426afbe2d26979c2dff4}{timestamp}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00251}00251                 vsi.\mbox{\hyperlink{classmessage__services_1_1models_1_1vehicle__status__intent_a86407fd5aa5bc140dfe4eeb58857c402}{setIs\_allowed}}(std::stol(mo.\mbox{\hyperlink{classmessage__services_1_1models_1_1mobilityoperation_a556c84b1faf40bbd5ec80daf36312ff6}{get\_value\_from\_strategy\_params}}(\textcolor{stringliteral}{"{}access"{}})));}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00252}00252                 vsi.\mbox{\hyperlink{classmessage__services_1_1models_1_1vehicle__status__intent_a1961108c1b43e7888913dcfa719429ce}{setMax\_accel}}(std::stod(mo.\mbox{\hyperlink{classmessage__services_1_1models_1_1mobilityoperation_a556c84b1faf40bbd5ec80daf36312ff6}{get\_value\_from\_strategy\_params}}(\textcolor{stringliteral}{"{}max\_accel"{}})));}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00253}00253                 vsi.\mbox{\hyperlink{classmessage__services_1_1models_1_1vehicle__status__intent_a9a2f1a0e8d094c574e458614cc4ca6a0}{setMax\_decel}}(std::stod(mo.\mbox{\hyperlink{classmessage__services_1_1models_1_1mobilityoperation_a556c84b1faf40bbd5ec80daf36312ff6}{get\_value\_from\_strategy\_params}}(\textcolor{stringliteral}{"{}max\_decel"{}})));}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00254}00254                 vsi.\mbox{\hyperlink{classmessage__services_1_1models_1_1vehicle__status__intent_a282954fce7bc32848e522bbba00396b7}{setReact\_timestamp}}(std::stod(mo.\mbox{\hyperlink{classmessage__services_1_1models_1_1mobilityoperation_a556c84b1faf40bbd5ec80daf36312ff6}{get\_value\_from\_strategy\_params}}(\textcolor{stringliteral}{"{}react\_time"{}})));}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00255}00255                 vsi.\mbox{\hyperlink{classmessage__services_1_1models_1_1vehicle__status__intent_a1425e23366059f0006c7e86bafed6a33}{setMinimum\_gap}}(std::stod(mo.\mbox{\hyperlink{classmessage__services_1_1models_1_1mobilityoperation_a556c84b1faf40bbd5ec80daf36312ff6}{get\_value\_from\_strategy\_params}}(\textcolor{stringliteral}{"{}min\_gap"{}})));}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00256}00256                 vsi.\mbox{\hyperlink{classmessage__services_1_1models_1_1vehicle__status__intent_aa1e269c8873f40dee9ec438b3b34fc96}{setDepart\_position}}(std::stol(mo.\mbox{\hyperlink{classmessage__services_1_1models_1_1mobilityoperation_a556c84b1faf40bbd5ec80daf36312ff6}{get\_value\_from\_strategy\_params}}(\textcolor{stringliteral}{"{}depart\_pos"{}})));}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00257}00257 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00258}00258                 \textcolor{comment}{// Update vehicle status intent with BSM}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00259}00259                 vsi.\mbox{\hyperlink{classmessage__services_1_1models_1_1vehicle__status__intent_a5355465311705ba972a13fa48de3634a}{setVehicle\_length}}(bsm.\mbox{\hyperlink{classmessage__services_1_1models_1_1bsm_ac9119ef3e4a5d64b493f49f06353b9d8}{getCore\_data}}().\mbox{\hyperlink{structmessage__services_1_1models_1_1bsmCoreData_a11ac591da5fdab224ecf04337797cd57}{size}}.\mbox{\hyperlink{structmessage__services_1_1models_1_1VehicleSize_a02f241146023ea7262630275e05601f4}{length}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00260}00260                 vsi.\mbox{\hyperlink{classmessage__services_1_1models_1_1vehicle__status__intent_a3fd11ec19fb3a5b14faacfca1a776bb6}{setCur\_speed}}(bsm.\mbox{\hyperlink{classmessage__services_1_1models_1_1bsm_ac9119ef3e4a5d64b493f49f06353b9d8}{getCore\_data}}().\mbox{\hyperlink{structmessage__services_1_1models_1_1bsmCoreData_a1bb652763866025572a769be1bc34965}{speed}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00261}00261                 vsi.\mbox{\hyperlink{classmessage__services_1_1models_1_1vehicle__status__intent_aaf76a35b3f6f0d7d5fa05baf753a309e}{setCur\_accel}}(bsm.\mbox{\hyperlink{classmessage__services_1_1models_1_1bsm_ac9119ef3e4a5d64b493f49f06353b9d8}{getCore\_data}}().\mbox{\hyperlink{structmessage__services_1_1models_1_1bsmCoreData_adb14f5bb5cbc6c5bfeafb1bfd19c8871}{accelSet}}.\mbox{\hyperlink{structmessage__services_1_1models_1_1AccelerationSet4Way_a2b255ad1e49f1e752f2fa4710d943eb0}{Long}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00262}00262                 std::string turn\_direction = mo.\mbox{\hyperlink{classmessage__services_1_1models_1_1mobilityoperation_a556c84b1faf40bbd5ec80daf36312ff6}{get\_value\_from\_strategy\_params}}(\textcolor{stringliteral}{"{}turn\_direction"{}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00263}00263                 vsi.\mbox{\hyperlink{classmessage__services_1_1models_1_1vehicle__status__intent_a2b58b6a7934632f68810871d4374f9de}{SetTurn\_direction}}(turn\_direction);}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00264}00264                 \textcolor{keywordtype}{double} cur\_lat = bsm.\mbox{\hyperlink{classmessage__services_1_1models_1_1bsm_ac9119ef3e4a5d64b493f49f06353b9d8}{getCore\_data}}().\mbox{\hyperlink{structmessage__services_1_1models_1_1bsmCoreData_ae96757537c164f592eeff804e4397947}{latitude}} / 10000000;}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00265}00265                 \textcolor{keywordtype}{double} cur\_lon = bsm.\mbox{\hyperlink{classmessage__services_1_1models_1_1bsm_ac9119ef3e4a5d64b493f49f06353b9d8}{getCore\_data}}().\mbox{\hyperlink{structmessage__services_1_1models_1_1bsmCoreData_a778dd89ea45af3e2681efac05abf4837}{longitude}} / 10000000;}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00266}00266                 \textcolor{keywordtype}{double} cur\_elev = bsm.\mbox{\hyperlink{classmessage__services_1_1models_1_1bsm_ac9119ef3e4a5d64b493f49f06353b9d8}{getCore\_data}}().\mbox{\hyperlink{structmessage__services_1_1models_1_1bsmCoreData_a99465f25b24825bb55f1fcec742bbdcd}{elev}};}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00267}00267                 SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}cur\_lat = \{0\}"{}}, cur\_lat);}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00268}00268                 SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}cur\_lon = \{0\}"{}}, cur\_lon);}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00269}00269                 SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}cur\_elev = \{0\}"{}}, cur\_elev);}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00270}00270 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00271}00271                 SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}MobilityPath trajectory offset size: \{0\}"{}}, mp.\mbox{\hyperlink{classmessage__services_1_1models_1_1mobilitypath_a120136307c1694b847f330a0b9ac046c}{getTrajectory}}().\mbox{\hyperlink{structmessage__services_1_1models_1_1trajectory_a150c97e34c1bdf6d9ed8f8908e521ef4}{offsets}}.size());}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00272}00272                 \mbox{\hyperlink{structmessage__services_1_1models_1_1trajectory}{message\_services::models::trajectory}} trajectory = mp.\mbox{\hyperlink{classmessage__services_1_1models_1_1mobilitypath_a120136307c1694b847f330a0b9ac046c}{getTrajectory}}();}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00273}00273                 lanelet::BasicPoint3d cur\_basic\_point3d = \mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a838f02c78c01aec373cc5e9dd62bd616}{\_msg\_lanelet2\_translate\_ptr}}-\/>gps\_2\_map\_point(cur\_lat, cur\_lon, cur\_elev);}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00274}00274                 lanelet::Lanelet cur\_lanelet = \mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a838f02c78c01aec373cc5e9dd62bd616}{\_msg\_lanelet2\_translate\_ptr}}-\/>get\_cur\_lanelet\_by\_point\_and\_direction(cur\_basic\_point3d, turn\_direction, trajectory);         }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00275}00275                 vsi.\mbox{\hyperlink{classmessage__services_1_1models_1_1vehicle__status__intent_a29973042d25f00d7a6ae4274199efaae}{setCur\_lanelet\_id}}(cur\_lanelet.id());}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00276}00276                 vsi.\mbox{\hyperlink{classmessage__services_1_1models_1_1vehicle__status__intent_a10b1b2d7aed2fc9206f3255319c6bc6e}{setCur\_distance}}(\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a838f02c78c01aec373cc5e9dd62bd616}{\_msg\_lanelet2\_translate\_ptr}}-\/>distance2\_cur\_lanelet\_end(cur\_basic\_point3d, cur\_lanelet, turn\_direction, trajectory));      }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00277}00277             }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00278}00278             \textcolor{keywordflow}{if}(!\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a489996d8e9d01a5562c94c02e37c7584}{disable\_est\_path}})}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00279}00279             \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00280}00280                 \textcolor{comment}{// Update vehicle status intent with MobilityPath}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00281}00281                 \mbox{\hyperlink{structmessage__services_1_1models_1_1est__path}{models::est\_path\_t}} est\_path;}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00282}00282                 std::vector<models::est\_path\_t> est\_path\_v;}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00283}00283                 int32\_t ecef\_x = mp.\mbox{\hyperlink{classmessage__services_1_1models_1_1mobilitypath_a120136307c1694b847f330a0b9ac046c}{getTrajectory}}().\mbox{\hyperlink{structmessage__services_1_1models_1_1trajectory_ab0eb62121303460bdd28cce240378592}{location}}.\mbox{\hyperlink{structmessage__services_1_1models_1_1locationECEF_a84d4dac32167a8ce7204edb46c4c56a9}{ecef\_x}};}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00284}00284                 int32\_t ecef\_y = mp.\mbox{\hyperlink{classmessage__services_1_1models_1_1mobilitypath_a120136307c1694b847f330a0b9ac046c}{getTrajectory}}().\mbox{\hyperlink{structmessage__services_1_1models_1_1trajectory_ab0eb62121303460bdd28cce240378592}{location}}.\mbox{\hyperlink{structmessage__services_1_1models_1_1locationECEF_aca77d28c85d51c76f60a3a2380ad55a4}{ecef\_y}};}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00285}00285                 int32\_t ecef\_z = mp.\mbox{\hyperlink{classmessage__services_1_1models_1_1mobilitypath_a120136307c1694b847f330a0b9ac046c}{getTrajectory}}().\mbox{\hyperlink{structmessage__services_1_1models_1_1trajectory_ab0eb62121303460bdd28cce240378592}{location}}.\mbox{\hyperlink{structmessage__services_1_1models_1_1locationECEF_af72f93d975711dc915ba7fecd5838fe5}{ecef\_z}};}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00286}00286                 \textcolor{keywordtype}{long} \mbox{\hyperlink{namespacesimulate__mobilityoperation_a53dff21a6d447ca660693de3432b79d0}{timestamp}} = mp.\mbox{\hyperlink{classmessage__services_1_1models_1_1mobilitypath_a5c2a26862cf57b6ecf5a925f877ab5dc}{getHeader}}().\mbox{\hyperlink{structmessage__services_1_1models_1_1mobility__header_a950a8571b2b4426afbe2d26979c2dff4}{timestamp}};}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00287}00287 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00288}00288                 SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}MobilityPath location ecef\_x: \{0\}"{}}, ecef\_x);}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00289}00289                 SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}MobilityPath location ecef\_y: \{0\}"{}}, ecef\_y);}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00290}00290                 SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}MobilityPath location ecef\_z: \{0\}"{}}, ecef\_z);}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00291}00291                 lanelet::BasicPoint3d mp\_start\_point = \mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a838f02c78c01aec373cc5e9dd62bd616}{\_msg\_lanelet2\_translate\_ptr}}-\/>ecef\_2\_map\_point(ecef\_x, ecef\_y, ecef\_z);}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00292}00292                 \textcolor{keywordflow}{if}(\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a229d4f5393c32a0d1c66ab186a821724}{is\_est\_path\_p2p\_distance\_only}})}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00293}00293                 \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00294}00294                     est\_path.\mbox{\hyperlink{structmessage__services_1_1models_1_1est__path_aa4a901e3e492bdaee4c13c19486ed17a}{distance}} = lanelet::geometry::distance(lanelet::utils::to2D(cur\_basic\_point3d),lanelet::utils::to2D(mp\_start\_point));}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00295}00295                     est\_path.\mbox{\hyperlink{structmessage__services_1_1models_1_1est__path_a834e7bd1bd36747b40248fe8e3b36d1c}{lanelet\_id}} = cur\_lanelet.id(); \textcolor{comment}{//Set the lanelet id to the current vehicle lanelet id}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00296}00296                 \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00297}00297                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00298}00298                 \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00299}00299                     lanelet::Lanelet mp\_point\_lanelet = \mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a838f02c78c01aec373cc5e9dd62bd616}{\_msg\_lanelet2\_translate\_ptr}}-\/>get\_cur\_lanelet\_by\_point\_and\_direction(mp\_start\_point, turn\_direction, trajectory);}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00300}00300                     est\_path.\mbox{\hyperlink{structmessage__services_1_1models_1_1est__path_aa4a901e3e492bdaee4c13c19486ed17a}{distance}} = \mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a838f02c78c01aec373cc5e9dd62bd616}{\_msg\_lanelet2\_translate\_ptr}}-\/>distance2\_cur\_lanelet\_end(mp\_start\_point,mp\_point\_lanelet, turn\_direction, trajectory);}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00301}00301                     est\_path.\mbox{\hyperlink{structmessage__services_1_1models_1_1est__path_a834e7bd1bd36747b40248fe8e3b36d1c}{lanelet\_id}} = mp\_point\_lanelet.id();}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00302}00302                 \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00303}00303                 est\_path.\mbox{\hyperlink{structmessage__services_1_1models_1_1est__path_ae38d3d8b5458e9235413297684b37e28}{timestamp}} = \mbox{\hyperlink{namespacesimulate__mobilityoperation_a53dff21a6d447ca660693de3432b79d0}{timestamp}};}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00304}00304                 est\_path\_v.push\_back(est\_path);}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00305}00305 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00306}00306                 int32\_t \mbox{\hyperlink{namespacesimulate__bsm_a76f645adf8af768fa959ecb6f90d7831}{count}} = 1;}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00307}00307                 \textcolor{keywordtype}{size\_t} next\_index = 0;}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00308}00308                 \textcolor{keywordtype}{double} accumulated\_distance\_to\_previous\_point = 0;}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00309}00309                 lanelet::BasicPoint3d mp\_cur\_point = mp\_start\_point;}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00310}00310                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} offset\_index = 0; offset\_index < trajectory.\mbox{\hyperlink{structmessage__services_1_1models_1_1trajectory_a150c97e34c1bdf6d9ed8f8908e521ef4}{offsets}}.size(); offset\_index++)}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00311}00311                 \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00312}00312                     ecef\_x += trajectory.\mbox{\hyperlink{structmessage__services_1_1models_1_1trajectory_a150c97e34c1bdf6d9ed8f8908e521ef4}{offsets}}.at(offset\_index).offset\_x;}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00313}00313                     ecef\_y += trajectory.\mbox{\hyperlink{structmessage__services_1_1models_1_1trajectory_a150c97e34c1bdf6d9ed8f8908e521ef4}{offsets}}.at(offset\_index).offset\_y;}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00314}00314                     ecef\_z += trajectory.\mbox{\hyperlink{structmessage__services_1_1models_1_1trajectory_a150c97e34c1bdf6d9ed8f8908e521ef4}{offsets}}.at(offset\_index).offset\_z;}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00315}00315 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00316}00316                     SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}MobilityPath location offset\_x: \{0\}"{}}, trajectory.\mbox{\hyperlink{structmessage__services_1_1models_1_1trajectory_a150c97e34c1bdf6d9ed8f8908e521ef4}{offsets}}.at(offset\_index).offset\_x);}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00317}00317                     SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}MobilityPath location offset\_y: \{0\}"{}}, trajectory.\mbox{\hyperlink{structmessage__services_1_1models_1_1trajectory_a150c97e34c1bdf6d9ed8f8908e521ef4}{offsets}}.at(offset\_index).offset\_y);}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00318}00318                     SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}MobilityPath location offset\_z: \{0\}"{}}, trajectory.\mbox{\hyperlink{structmessage__services_1_1models_1_1trajectory_a150c97e34c1bdf6d9ed8f8908e521ef4}{offsets}}.at(offset\_index).offset\_z);}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00319}00319                     est\_path.\mbox{\hyperlink{structmessage__services_1_1models_1_1est__path_ae38d3d8b5458e9235413297684b37e28}{timestamp}} += 100; \textcolor{comment}{// The duration between two points is 0.1 sec}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00320}00320                     }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00321}00321                     \textcolor{comment}{//Calculate the distance between two points (interval 0.1 secs) from the MobilityPath message starting from the current vehicle location                }}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00322}00322                     \textcolor{keywordflow}{if}(\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a229d4f5393c32a0d1c66ab186a821724}{is\_est\_path\_p2p\_distance\_only}})}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00323}00323                     \{   }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00324}00324                         lanelet::BasicPoint3d mp\_previous\_point = mp\_cur\_point;}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00325}00325                         mp\_cur\_point = \mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a838f02c78c01aec373cc5e9dd62bd616}{\_msg\_lanelet2\_translate\_ptr}}-\/>ecef\_2\_map\_point(ecef\_x, ecef\_y, ecef\_z);}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00326}00326                         accumulated\_distance\_to\_previous\_point += lanelet::geometry::distance2d(lanelet::utils::to2D(mp\_cur\_point),lanelet::utils::to2D(mp\_previous\_point));                        }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00327}00327                     \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00328}00328 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00329}00329                     \textcolor{keywordflow}{if} (next\_index != offset\_index)}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00330}00330                     \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00331}00331                         \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00332}00332                     \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00333}00333                     next\_index += this-\/>\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_afb8d701d325db8deb6755090db8026e3}{MOBILITY\_PATH\_TRAJECTORY\_OFFSET\_DURATION}};}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00334}00334 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00335}00335                     \textcolor{comment}{// Skip the first point}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00336}00336                     \textcolor{keywordflow}{if} (offset\_index == 0)}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00337}00337                     \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00338}00338                         \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00339}00339                     \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00340}00340 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00341}00341                     \textcolor{comment}{//If the est\_path only includes the distance to previous point, the distance is set to accumulated distance to previous point.}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00342}00342                     \textcolor{keywordflow}{if}(\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a229d4f5393c32a0d1c66ab186a821724}{is\_est\_path\_p2p\_distance\_only}})}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00343}00343                     \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00344}00344                         est\_path.\mbox{\hyperlink{structmessage__services_1_1models_1_1est__path_aa4a901e3e492bdaee4c13c19486ed17a}{distance}} = accumulated\_distance\_to\_previous\_point;}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00345}00345                         est\_path.\mbox{\hyperlink{structmessage__services_1_1models_1_1est__path_a834e7bd1bd36747b40248fe8e3b36d1c}{lanelet\_id}} = cur\_lanelet.id(); \textcolor{comment}{//Set the lanelet id to the current vehicle lanelet id}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00346}00346 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00347}00347                         \textcolor{comment}{//reset the accumulated distance, and start to calculate from the latest point}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00348}00348                         accumulated\_distance\_to\_previous\_point = 0;}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00349}00349                     \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00350}00350                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00351}00351                     \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00352}00352                         lanelet::BasicPoint3d trajectory\_point = \mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a838f02c78c01aec373cc5e9dd62bd616}{\_msg\_lanelet2\_translate\_ptr}}-\/>ecef\_2\_map\_point(ecef\_x, ecef\_y, ecef\_z);}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00353}00353                         lanelet::Lanelet trajectory\_point\_lanelet = \mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a838f02c78c01aec373cc5e9dd62bd616}{\_msg\_lanelet2\_translate\_ptr}}-\/>get\_cur\_lanelet\_by\_point\_and\_direction(trajectory\_point, turn\_direction, trajectory);            }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00354}00354                         est\_path.\mbox{\hyperlink{structmessage__services_1_1models_1_1est__path_aa4a901e3e492bdaee4c13c19486ed17a}{distance}} = \mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a838f02c78c01aec373cc5e9dd62bd616}{\_msg\_lanelet2\_translate\_ptr}}-\/>distance2\_cur\_lanelet\_end(trajectory\_point, trajectory\_point\_lanelet, turn\_direction, trajectory);}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00355}00355                         est\_path.\mbox{\hyperlink{structmessage__services_1_1models_1_1est__path_a834e7bd1bd36747b40248fe8e3b36d1c}{lanelet\_id}} = trajectory\_point\_lanelet.id();}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00356}00356                     \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00357}00357                     }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00358}00358                     est\_path\_v.push\_back(est\_path);}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00359}00359                     \mbox{\hyperlink{namespacesimulate__bsm_a76f645adf8af768fa959ecb6f90d7831}{count}}++;}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00360}00360 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00361}00361                     \textcolor{comment}{// Allow to configure the number of mobilityPath offsets sent as part of VSI (vehicle status and intent)}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00362}00362                     \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a8825fbe5dddce9c54ebd8d0e44cc92d5}{vsi\_est\_path\_point\_count}} != 0 \&\& count > this-\/>\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a8825fbe5dddce9c54ebd8d0e44cc92d5}{vsi\_est\_path\_point\_count}})}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00363}00363                     \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00364}00364                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00365}00365                     \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00366}00366                 \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00367}00367 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00368}00368                 vsi.\mbox{\hyperlink{classmessage__services_1_1models_1_1vehicle__status__intent_a75a4999e0b08e190076f4ffbc1520055}{setEst\_path\_v}}(est\_path\_v);}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00369}00369             \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00370}00370             }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00371}00371                 std::map<int64\_t, models::intersection\_lanelet\_type> lanelet\_id\_type\_m = \mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a838f02c78c01aec373cc5e9dd62bd616}{\_msg\_lanelet2\_translate\_ptr}}-\/>get\_lanelet\_types\_ids(cur\_lanelet, turn\_direction);}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00372}00372                 \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} itr = lanelet\_id\_type\_m.begin(); itr != lanelet\_id\_type\_m.end(); itr++)}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00373}00373                 \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00374}00374                     \textcolor{keywordflow}{if} (itr-\/>second == \mbox{\hyperlink{namespacemessage__services_1_1models_adadf916283b2bc01c875dce103fadcaea3d6232af1d94cb10e98b26b8c942c678}{models::intersection\_lanelet\_type::link}})}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00375}00375                     \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00376}00376                         vsi.\mbox{\hyperlink{classmessage__services_1_1models_1_1vehicle__status__intent_ae8b641c77189056ae6888378c25c1ba7}{setLink\_lanelet\_id}}(itr-\/>first);}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00377}00377                     \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00378}00378                     \textcolor{keywordflow}{if} (itr-\/>second == \mbox{\hyperlink{namespacemessage__services_1_1models_adadf916283b2bc01c875dce103fadcaeaa0d6503f4183b89238b86fd1e3d9ad7f}{models::intersection\_lanelet\_type::departure}})}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00379}00379                     \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00380}00380                         vsi.\mbox{\hyperlink{classmessage__services_1_1models_1_1vehicle__status__intent_a84ab6a699bf963ea2777278847561853}{setDest\_lanelet\_id}}(itr-\/>first);}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00381}00381                     \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00382}00382                     \textcolor{keywordflow}{if} (itr-\/>second == \mbox{\hyperlink{namespacemessage__services_1_1models_adadf916283b2bc01c875dce103fadcaea0fd5625d55960788c83ed1f2a6a81631}{models::intersection\_lanelet\_type::entry}})}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00383}00383                     \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00384}00384                         vsi.\mbox{\hyperlink{classmessage__services_1_1models_1_1vehicle__status__intent_a9865793f68579515f64b02b5994c7402}{setEnter\_lanelet\_id}}(itr-\/>first);}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00385}00385                     \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00386}00386                 \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00387}00387                 \textcolor{keywordflow}{return} vsi;               }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00388}00388             \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00389}00389             \textcolor{keywordflow}{catch} (...)}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00390}00390             \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00391}00391                 SPDLOG\_CRITICAL(\textcolor{stringliteral}{"{}Compose vehicle status intent Exception occur"{}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00392}00392                 \textcolor{keywordflow}{return} vsi;}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00393}00393             \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00394}00394         \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00395}00395 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00396}00396         \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00397}\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a98b6f8369a238e3e1b9504e806fcdc5f}{00397}}         \textcolor{keywordtype}{void} \mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_a98b6f8369a238e3e1b9504e806fcdc5f}{vehicle\_status\_intent\_service::msg\_consumer}}(std::shared\_ptr<T> msg\_w\_ptr, std::shared\_ptr<kafka\_clients::kafka\_consumer\_worker> consumer\_worker)}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00398}00398         \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00399}00399             \textcolor{keywordflow}{while} (consumer\_worker-\/>is\_running())}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00400}00400             \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00401}00401                 \textcolor{keyword}{const} std::string payload = consumer\_worker-\/>consume(1000);}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00402}00402                 \textcolor{keywordflow}{if} (payload.length() != 0 \&\& msg\_w\_ptr)}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00403}00403                 \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00404}00404                     std::unique\_lock<std::mutex> lck(\mbox{\hyperlink{namespacemessage__services_1_1services_a4b7d4a8ab4ecfa31372593ca82fc843b}{worker\_mtx}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00405}00405                     msg\_w\_ptr-\/>process\_incoming\_msg(payload);}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00406}00406                 \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00407}00407 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00408}00408                 \textcolor{keywordflow}{if} (!msg\_w\_ptr)}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00409}00409                 \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00410}00410                     SPDLOG\_CRITICAL(\textcolor{stringliteral}{"{}Message worker is not initialized"{}});}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00411}00411                 \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00412}00412             \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00413}00413             \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00414}00414         \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00415}00415 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00416}00416         \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00417}\mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_af352d0ba25bcc6b1ddb30efd1a76889c}{00417}}         \textcolor{keywordtype}{void} \mbox{\hyperlink{classmessage__services_1_1services_1_1vehicle__status__intent__service_af352d0ba25bcc6b1ddb30efd1a76889c}{vehicle\_status\_intent\_service::publish\_msg}}(T msg,  std::shared\_ptr<kafka\_clients::kafka\_producer\_worker> producer\_worker)}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00418}00418         \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00419}00419             std::string msg\_to\_send = \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00420}00420             msg\_to\_send = (\textcolor{keywordtype}{char} *)msg;}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00421}00421 }
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00422}00422             \textcolor{keywordflow}{if} (msg\_to\_send.length() > 0)}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00423}00423             \{}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00424}00424                 producer\_worker-\/>send(msg\_to\_send);}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00425}00425             \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00426}00426             \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00427}00427         \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00428}00428     \}}
\DoxyCodeLine{\Hypertarget{vehicle__status__intent__service_8cpp_source_l00429}00429 \}}

\end{DoxyCode}
