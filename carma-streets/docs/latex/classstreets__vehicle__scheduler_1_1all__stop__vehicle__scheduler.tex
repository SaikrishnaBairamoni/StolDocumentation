\hypertarget{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler}{}\doxysection{streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+scheduler Class Reference}
\label{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler}\index{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}}


{\ttfamily \#include $<$all\+\_\+stop\+\_\+vehicle\+\_\+scheduler.\+h$>$}



Inheritance diagram for streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+scheduler\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=550pt]{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+scheduler\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler__coll__graph}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_ab4a2d24aef35503f3ff8eeaacc07bb9d}{all\+\_\+stop\+\_\+vehicle\+\_\+scheduler}} ()=default
\begin{DoxyCompactList}\small\item\em Construct a new all stop vehicle scheduler object. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_ad40be3e19c0eca5e076b1e5831a7e85f}{$\sim$all\+\_\+stop\+\_\+vehicle\+\_\+scheduler}} () override=default
\begin{DoxyCompactList}\small\item\em Destroy the all stop vehicle scheduler object. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a930961b3e285b2a2d08f4276ffa22658}{schedule\+\_\+vehicles}} (std\+::unordered\+\_\+map$<$ std\+::string, \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\+\_\+vehicles\+::vehicle}} $>$ \&vehicles, std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{structstreets__vehicle__scheduler_1_1intersection__schedule}{intersection\+\_\+schedule}} $>$ \&schedule) override
\begin{DoxyCompactList}\small\item\em Method to schedule vehicles. Given and empty \mbox{\hyperlink{structstreets__vehicle__scheduler_1_1intersection__schedule}{intersection\+\_\+schedule}} object and a map of vehicles and vehicle ids. This method will populate the intersection schedule with a schedule for each EV,RDV and DV in the vehicle map based on UC 1 scheduling logic to minimize delay for a all way stop intersection. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a37514ae17d938eff80b44304ab81cdda}{set\+\_\+entering\+\_\+time\+\_\+buffer}} (const uint64\+\_\+t buffer)
\begin{DoxyCompactList}\small\item\em Set the entering time buffer (ms). This value is used to account for the time it takes a vehicle stopped before the stop bar at an entry lane to exit the entry lane and enter the link lane once given access. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a4b4afb653bc02a75e3c113806c9f4004}{set\+\_\+flexibility\+\_\+limit}} (const int limit)
\begin{DoxyCompactList}\small\item\em Set the flexibility limit. This limit controls how much departure position can change for any given vehicle between successive intersection schedule calculations. Each subsequent intersection scheduling calculation may have a slightly different departure order. This value controls how much this departure order can change.\+A value of 1 represents that vehicles departure position can change by one between two intersection schedules. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Private Member Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a16230014f5d43ef2546a54496c08a9cd}{schedule\+\_\+dvs}} (std\+::list$<$ \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\+\_\+vehicles\+::vehicle}} $>$ \&dvs, const std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__intersection__schedule}{all\+\_\+stop\+\_\+intersection\+\_\+schedule}} $>$ \&schedule) const
\begin{DoxyCompactList}\small\item\em Schedule all currently Departing Vehicle (DVs). Estimate intersection departure times (dt\textquotesingle{}s) for each vehicle based on kinematic vehicle information and intersection geometry. Method assumes empty \mbox{\hyperlink{structstreets__vehicle__scheduler_1_1intersection__schedule}{intersection\+\_\+schedule}} is passed in. Method will add vehicle\+\_\+schedule(s) for each DV in the vector. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a0729a968f0b8f0b0ec11453157df101c}{schedule\+\_\+rdvs}} (std\+::list$<$ \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\+\_\+vehicles\+::vehicle}} $>$ \&rdvs, const std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__intersection__schedule}{all\+\_\+stop\+\_\+intersection\+\_\+schedule}} $>$ \&schedule)
\begin{DoxyCompactList}\small\item\em Schedule all currently Ready to Depart Vehicles (RDVs). Consider all possible RDV departure orders. Select the one with the least calculated delay. Delay for a given vehicle is the difference between Entering Time and Stopping Time. Method assumes \mbox{\hyperlink{structstreets__vehicle__scheduler_1_1intersection__schedule}{intersection\+\_\+schedule}} only populated with DV(s) vehicle\+\_\+schedules. Method will add vehicle\+\_\+schedule(s) for each RDV in vector. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a35eb7b98052f4ef88850471478fcdddb}{is\+\_\+rdv\+\_\+previously\+\_\+granted\+\_\+access}} (const \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\+\_\+vehicles\+::vehicle}} \&veh) const
\begin{DoxyCompactList}\small\item\em Method to determine whether vehicle was granted access to the intersection in previous schedules. To avoid granting conflicting vehicles intersection access simultaneously, the scheduling service maintains a list of vehicles it has granted access to in the past. Vehicles are removed from this list once their update reflects that they have received and processed this access. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a223e57041ae7ca6c4810877c8c74a49e}{remove\+\_\+rdv\+\_\+previously\+\_\+granted\+\_\+access}} (const \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\+\_\+vehicles\+::vehicle}} \&veh)
\begin{DoxyCompactList}\small\item\em This method will remove a vehicle (DV) once it\textquotesingle{}s updates reflect that is has received access from the list of previously granted access RDVs. This method should be called once a RDV received the schedule update that grants it access to the intersection. This is indicated by the vehicle no longer being a RDV and instead being a DV (. \end{DoxyCompactList}\item 
\mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\+\_\+vehicles\+::vehicle}} \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a0cf6941cc406bbd51889c129231e9443}{get\+\_\+vehicle\+\_\+with\+\_\+id}} (const std\+::list$<$ \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\+\_\+vehicles\+::vehicle}} $>$ \&veh\+\_\+list, const std\+::string \&veh\+\_\+id) const
\begin{DoxyCompactList}\small\item\em Given a list of vehicles and a vehicle id, this method returns the vehicle with a matching vehicle id if there is one. This method will throw a \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1scheduling__exception}{scheduling\+\_\+exception}} if no vehicle with the given id is found. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_acd0ec98c5efc93aadb38563e3b98d1bb}{schedule\+\_\+evs}} (std\+::list$<$ \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\+\_\+vehicles\+::vehicle}} $>$ \&evs, const std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__intersection__schedule}{all\+\_\+stop\+\_\+intersection\+\_\+schedule}} $>$ \&schedule) const
\begin{DoxyCompactList}\small\item\em Schedule all Entering Vehicles (EVs). Method first organizes all EVs into lists based on their entry lane. These list are order in ascending order with the vehicle closest to the intersection in a given lane being the first vehicle in that entry lanes vehicle list. Then stopping time (ST) for the unscheduled front EVs from every approach are calculated and the vehicle with the lowest (earliest) stopping times is scheduled. This is repeated until all evs from all approach lanelets are scheduled. \end{DoxyCompactList}\item 
uint64\+\_\+t \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a9b5ee4ffdbd82cbf0c48f7981e7dff9c}{estimate\+\_\+entering\+\_\+time\+\_\+for\+\_\+ev}} (const std\+::vector$<$ \mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule}{all\+\_\+stop\+\_\+vehicle\+\_\+schedule}} $>$ \&vehicle\+\_\+schedules, const \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\+\_\+vehicles\+::vehicle}} \&ev, const uint64\+\_\+t st) const
\begin{DoxyCompactList}\small\item\em Estimates an entering time (ET) for a given Entering Vehicle (EV). This method first searches among the existing scheduled vehicles and find the departure time (DT) of the last scheduled vehicle with conflicting direction. The ET of the vehicle is calculated based on this DT (if exist) and the estimated stopping time (ST) oft the vehicle. ~\newline
 \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a77c415e3ef29a00acc67c7aac87a270b}{consider\+\_\+departure\+\_\+position\+\_\+permutation}} (const std\+::list$<$ \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\+\_\+vehicles\+::vehicle}} $>$ \&rdvs, const std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__intersection__schedule}{all\+\_\+stop\+\_\+intersection\+\_\+schedule}} $>$ \&option, int starting\+\_\+departure\+\_\+position) const
\begin{DoxyCompactList}\small\item\em Creates and intersection schedule for a given RDV departure order. RDV departure order is based on rdvs order. Returns reference to \mbox{\hyperlink{structstreets__vehicle__scheduler_1_1intersection__schedule}{intersection\+\_\+schedule}} option/possibility with given departure order. Assumes \mbox{\hyperlink{structstreets__vehicle__scheduler_1_1intersection__schedule}{intersection\+\_\+schedule}} option only contains schedules for DVs. Populates \mbox{\hyperlink{structstreets__vehicle__scheduler_1_1intersection__schedule}{intersection\+\_\+schedule}} with RDV vehicle\+\_\+schedules. \end{DoxyCompactList}\item 
uint64\+\_\+t \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a15b4da36dba827263da4c844028c6db1}{estimate\+\_\+clearance\+\_\+time}} (const \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\+\_\+vehicles\+::vehicle}} \&veh, const \mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info}{Open\+API\+::\+OAILanelet\+\_\+info}} \&link\+\_\+lane\+\_\+info) const
\begin{DoxyCompactList}\small\item\em Estimate clearance time any vehicle given it\textquotesingle{}s link lanelet information. ~\newline
 \end{DoxyCompactList}\item 
std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule}{all\+\_\+stop\+\_\+vehicle\+\_\+schedule}} $>$ \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_aa06721804b8a4075b98c2e8ad40c84da}{get\+\_\+latest\+\_\+conflicting}} (const \mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info}{Open\+API\+::\+OAILanelet\+\_\+info}} \&link\+\_\+lane, const std\+::vector$<$ \mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule}{all\+\_\+stop\+\_\+vehicle\+\_\+schedule}} $>$ \&schedules) const
\begin{DoxyCompactList}\small\item\em Given a link lane and a vector of vehicle schedules, this method returns a pointer to a vehicle schedule with a conflicting direction and the latest departure time. If no vehicle schedules have conflicting directions it returns nullptr. This method is meant to return the limiting conflicting vehicle for scheduling new RDVs in a link lane. \end{DoxyCompactList}\item 
uint64\+\_\+t \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_ad5f0462b2d82168b7b71dcfd15eaa7f2}{estimate\+\_\+earliest\+\_\+time\+\_\+to\+\_\+stop\+\_\+bar}} (const \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\+\_\+vehicles\+::vehicle}} \&veh) const
\begin{DoxyCompactList}\small\item\em Method to use vehicle kinematic information to estimate earliest possible time stopping time for a vehicle. Does not consider any other vehicles. Limiting factors are the vehicles current kinematic information, lane speed limits and vehicle acceleration and deceleration limits. \end{DoxyCompactList}\item 
double \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_acab5956159419bef2c5391d59e3fe9ee}{estimate\+\_\+delta\+\_\+x\+\_\+prime}} (const \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\+\_\+vehicles\+::vehicle}} \&veh, const \mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info}{Open\+API\+::\+OAILanelet\+\_\+info}} \&entry\+\_\+lane) const
\begin{DoxyCompactList}\small\item\em Calculate minumum distance required to speed up to lane speed limit with maximum acceleration, cruise at lane speed limit for some time, then decelerate with maximum deceleration. This is used to determine the trajectory to provide the vehicle. \end{DoxyCompactList}\item 
double \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_ae5a42af1af20b06df9ad6af5d3170406}{calculate\+\_\+v\+\_\+hat}} (const \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\+\_\+vehicles\+::vehicle}} \&veh) const
\begin{DoxyCompactList}\small\item\em Method to calculate v\+\_\+hat. This is the maximum speed reached between maximum speed reached between acceleration and deceleration periods for a vehicle trajectory towards stopping at a stop bar. \end{DoxyCompactList}\item 
double \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a3ba56cc964002b21475a475995938b89}{calculate\+\_\+acceleration\+\_\+time}} (const \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\+\_\+vehicles\+::vehicle}} \&veh, const double v\+\_\+hat) const
\begin{DoxyCompactList}\small\item\em Method to calculate time interval necessary for accelerating to speed v\+\_\+hat for a given vehicle. Will return 0 if v\+\_\+hat is less than vehicle speed. \end{DoxyCompactList}\item 
double \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a63107a1e136be3a00f3a1445531904aa}{calculate\+\_\+deceleration\+\_\+time}} (const \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\+\_\+vehicles\+::vehicle}} \&veh, const double v\+\_\+hat) const
\begin{DoxyCompactList}\small\item\em Method to calculate time interval necessary for deceleration from v\+\_\+hat to 0 to stop at stop bar. Assumes trajectory with constant maximum deceleration. \end{DoxyCompactList}\item 
double \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_afedbbc9205b39ceb8707d950b5c26556}{calculate\+\_\+cruising\+\_\+time}} (const \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\+\_\+vehicles\+::vehicle}} \&veh, const double v\+\_\+hat, const double delta\+\_\+x\+\_\+prime) const
\begin{DoxyCompactList}\small\item\em Method to calculate time interval necessary for cruising at a constant speed v\+\_\+hat (speed limit) greater than current vehicle speed.\+If vehicle speed is greater that v\+\_\+hat, this method will return 0. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Private Attributes}
\begin{DoxyCompactItemize}
\item 
std\+::list$<$ \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\+\_\+vehicles\+::vehicle}} $>$ \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a77c53828e29e53a9a7ff752afb65b549}{rdvs\+\_\+previously\+\_\+granted\+\_\+access}}
\begin{DoxyCompactList}\small\item\em A list of RDV vehicles granted access by the \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1vehicle__scheduler}{vehicle\+\_\+scheduler}}, who\textquotesingle{}s updates do not yet reflect they have received access (still considered RDV by all\+\_\+stop\+\_\+status\+\_\+intent\+\_\+processor). We maintain this list to ensure we do not grant conflicting vehicles access to the intersection simultaneously in back to back scheduling calculations where the first RDV granted access in the first schedule has not yet provided a vehicle update the reflects this access by the time we calculate the second schedule. \end{DoxyCompactList}\item 
uint64\+\_\+t \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a13124a205e1c6615f6a137c507b2a4eb}{entering\+\_\+time\+\_\+buffer}} = 0
\begin{DoxyCompactList}\small\item\em Configurable time buffer in milliseconds for estimating the time it takes a vehicle to leave its entry lane and enter the intersection box once granted access to the intersection. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a004c41012f860faa9634e42c7d5740f7}{flexibility\+\_\+limit}} = 5
\begin{DoxyCompactList}\small\item\em Limits how much departure position for a given vehicle can change from current reported departure position. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Additional Inherited Members}


\doxysubsection{Detailed Description}


Definition at line \mbox{\hyperlink{all__stop__vehicle__scheduler_8h_source_l00016}{16}} of file \mbox{\hyperlink{all__stop__vehicle__scheduler_8h_source}{all\+\_\+stop\+\_\+vehicle\+\_\+scheduler.\+h}}.



\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_ab4a2d24aef35503f3ff8eeaacc07bb9d}\label{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_ab4a2d24aef35503f3ff8eeaacc07bb9d}} 
\index{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}!all\_stop\_vehicle\_scheduler@{all\_stop\_vehicle\_scheduler}}
\index{all\_stop\_vehicle\_scheduler@{all\_stop\_vehicle\_scheduler}!streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}}
\doxysubsubsection{\texorpdfstring{all\_stop\_vehicle\_scheduler()}{all\_stop\_vehicle\_scheduler()}}
{\footnotesize\ttfamily streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+scheduler (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [default]}}



Construct a new all stop vehicle scheduler object. 

\mbox{\Hypertarget{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_ad40be3e19c0eca5e076b1e5831a7e85f}\label{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_ad40be3e19c0eca5e076b1e5831a7e85f}} 
\index{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}!````~all\_stop\_vehicle\_scheduler@{$\sim$all\_stop\_vehicle\_scheduler}}
\index{````~all\_stop\_vehicle\_scheduler@{$\sim$all\_stop\_vehicle\_scheduler}!streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}}
\doxysubsubsection{\texorpdfstring{$\sim$all\_stop\_vehicle\_scheduler()}{~all\_stop\_vehicle\_scheduler()}}
{\footnotesize\ttfamily streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+scheduler\+::$\sim$all\+\_\+stop\+\_\+vehicle\+\_\+scheduler (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [default]}}



Destroy the all stop vehicle scheduler object. 



\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a3ba56cc964002b21475a475995938b89}\label{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a3ba56cc964002b21475a475995938b89}} 
\index{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}!calculate\_acceleration\_time@{calculate\_acceleration\_time}}
\index{calculate\_acceleration\_time@{calculate\_acceleration\_time}!streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}}
\doxysubsubsection{\texorpdfstring{calculate\_acceleration\_time()}{calculate\_acceleration\_time()}}
{\footnotesize\ttfamily double streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+scheduler\+::calculate\+\_\+acceleration\+\_\+time (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\+\_\+vehicles\+::vehicle}} \&}]{veh,  }\item[{const double}]{v\+\_\+hat }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [private]}}



Method to calculate time interval necessary for accelerating to speed v\+\_\+hat for a given vehicle. Will return 0 if v\+\_\+hat is less than vehicle speed. 


\begin{DoxyParams}{Parameters}
{\em veh} & vehicle for which to calculate trajectory. \\
\hline
{\em v\+\_\+hat} & maximum speed to reach during acceleration in m/s. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
double time interval necessary for acceleration in seconds. 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00093}{93}} of file \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source}{all\+\_\+stop\+\_\+vehicle\+\_\+scheduler.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00093                                                                                                                                 \{}
\DoxyCodeLine{00094         \textcolor{comment}{// If v\_hat is less than current vehicle speed there is only time for deceleration}}
\DoxyCodeLine{00095         \textcolor{comment}{// Note: This is an error case and means stopping before the stop bar is not possible given current kinematic information}}
\DoxyCodeLine{00096         \textcolor{comment}{// and deceleration limits}}
\DoxyCodeLine{00097         \textcolor{keywordflow}{if} ( v\_hat < veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a026375b9e6ffc8f8c8aee72465f352dc}{\_cur\_speed}} )\{}
\DoxyCodeLine{00098             \textcolor{keywordflow}{return} 0.0;}
\DoxyCodeLine{00099         \} }
\DoxyCodeLine{00100         \textcolor{keywordflow}{return} (v\_hat-\/veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a026375b9e6ffc8f8c8aee72465f352dc}{\_cur\_speed}})/veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a1180998ca4eeb7d695d135a1e4a75424}{\_accel\_max}};}
\DoxyCodeLine{00101     \}}

\end{DoxyCode}


References \mbox{\hyperlink{vehicle_8h_source_l00045}{streets\+\_\+vehicles\+::vehicle\+::\+\_\+accel\+\_\+max}}, and \mbox{\hyperlink{vehicle_8h_source_l00075}{streets\+\_\+vehicles\+::vehicle\+::\+\_\+cur\+\_\+speed}}.



Referenced by \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00390}{estimate\+\_\+earliest\+\_\+time\+\_\+to\+\_\+stop\+\_\+bar()}}.

Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a3ba56cc964002b21475a475995938b89_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_afedbbc9205b39ceb8707d950b5c26556}\label{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_afedbbc9205b39ceb8707d950b5c26556}} 
\index{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}!calculate\_cruising\_time@{calculate\_cruising\_time}}
\index{calculate\_cruising\_time@{calculate\_cruising\_time}!streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}}
\doxysubsubsection{\texorpdfstring{calculate\_cruising\_time()}{calculate\_cruising\_time()}}
{\footnotesize\ttfamily double streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+scheduler\+::calculate\+\_\+cruising\+\_\+time (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\+\_\+vehicles\+::vehicle}} \&}]{veh,  }\item[{const double}]{v\+\_\+hat,  }\item[{const double}]{delta\+\_\+x\+\_\+prime }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [private]}}



Method to calculate time interval necessary for cruising at a constant speed v\+\_\+hat (speed limit) greater than current vehicle speed.\+If vehicle speed is greater that v\+\_\+hat, this method will return 0. 


\begin{DoxyParams}{Parameters}
{\em veh} & vehicle for which to calculate trajectory for. \\
\hline
{\em v\+\_\+hat} & cruising speed, usually lane speed limit, in m/s. \\
\hline
{\em delta\+\_\+x\+\_\+prime} & the distance necessary for vehicle to accelerate to speed limit with maximum acceleration and then decelerate back to a stop in meters.\+The difference the distance to the stop bar and this distance is the part of the trajectory for which the vehicle can cruise at the speed limit. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
double time interval necessary for cruising at speed limit in seconds. 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00103}{103}} of file \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source}{all\+\_\+stop\+\_\+vehicle\+\_\+scheduler.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00103                                                                                                                                                         \{}
\DoxyCodeLine{00104         \textcolor{comment}{// If v\_hat is less than current speed there is only time for deceleration}}
\DoxyCodeLine{00105         \textcolor{comment}{// Note: This is an error case and means stopping before the stop bar is not possible given current kinematic information}}
\DoxyCodeLine{00106         \textcolor{comment}{// and deceleration limits}}
\DoxyCodeLine{00107         \textcolor{keywordflow}{if} ( v\_hat < veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a026375b9e6ffc8f8c8aee72465f352dc}{\_cur\_speed}} ) \{}
\DoxyCodeLine{00108             \textcolor{keywordflow}{return} 0.0;}
\DoxyCodeLine{00109         \}}
\DoxyCodeLine{00110         \textcolor{keywordflow}{return} (veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a21a6378ca2401ac4bc9ca6f6364833fb}{\_cur\_distance}} -\/ delta\_x\_prime)/v\_hat; }
\DoxyCodeLine{00111     \}}

\end{DoxyCode}


References \mbox{\hyperlink{vehicle_8h_source_l00073}{streets\+\_\+vehicles\+::vehicle\+::\+\_\+cur\+\_\+distance}}, and \mbox{\hyperlink{vehicle_8h_source_l00075}{streets\+\_\+vehicles\+::vehicle\+::\+\_\+cur\+\_\+speed}}.



Referenced by \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00390}{estimate\+\_\+earliest\+\_\+time\+\_\+to\+\_\+stop\+\_\+bar()}}.

Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_afedbbc9205b39ceb8707d950b5c26556_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a63107a1e136be3a00f3a1445531904aa}\label{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a63107a1e136be3a00f3a1445531904aa}} 
\index{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}!calculate\_deceleration\_time@{calculate\_deceleration\_time}}
\index{calculate\_deceleration\_time@{calculate\_deceleration\_time}!streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}}
\doxysubsubsection{\texorpdfstring{calculate\_deceleration\_time()}{calculate\_deceleration\_time()}}
{\footnotesize\ttfamily double streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+scheduler\+::calculate\+\_\+deceleration\+\_\+time (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\+\_\+vehicles\+::vehicle}} \&}]{veh,  }\item[{const double}]{v\+\_\+hat }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [private]}}



Method to calculate time interval necessary for deceleration from v\+\_\+hat to 0 to stop at stop bar. Assumes trajectory with constant maximum deceleration. 


\begin{DoxyParams}{Parameters}
{\em veh} & vehicle for which to calculate trajectory. \\
\hline
{\em v\+\_\+hat} & max speed from which to decelerate from in m/s \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
double time interval necessary for acceleration in seconds. 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00113}{113}} of file \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source}{all\+\_\+stop\+\_\+vehicle\+\_\+scheduler.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00113                                                                                                                                 \{}
\DoxyCodeLine{00114         \textcolor{keywordflow}{return} -\/v\_hat/veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a253341595deb3473620116dcf63d9927}{\_decel\_max}};}
\DoxyCodeLine{00115     \}}

\end{DoxyCode}


References \mbox{\hyperlink{vehicle_8h_source_l00047}{streets\+\_\+vehicles\+::vehicle\+::\+\_\+decel\+\_\+max}}.



Referenced by \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00390}{estimate\+\_\+earliest\+\_\+time\+\_\+to\+\_\+stop\+\_\+bar()}}.

Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a63107a1e136be3a00f3a1445531904aa_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_ae5a42af1af20b06df9ad6af5d3170406}\label{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_ae5a42af1af20b06df9ad6af5d3170406}} 
\index{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}!calculate\_v\_hat@{calculate\_v\_hat}}
\index{calculate\_v\_hat@{calculate\_v\_hat}!streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}}
\doxysubsubsection{\texorpdfstring{calculate\_v\_hat()}{calculate\_v\_hat()}}
{\footnotesize\ttfamily double streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+scheduler\+::calculate\+\_\+v\+\_\+hat (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\+\_\+vehicles\+::vehicle}} \&}]{veh }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [private]}}



Method to calculate v\+\_\+hat. This is the maximum speed reached between maximum speed reached between acceleration and deceleration periods for a vehicle trajectory towards stopping at a stop bar. 


\begin{DoxyParams}{Parameters}
{\em veh} & vehicle to calculate trajectory for. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
double v\+\_\+hat in m/s 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00082}{82}} of file \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source}{all\+\_\+stop\+\_\+vehicle\+\_\+scheduler.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00082                                                                                                \{}
\DoxyCodeLine{00083         \textcolor{keywordtype}{double} numerator = veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a253341595deb3473620116dcf63d9927}{\_decel\_max}} *( 2 * veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a21a6378ca2401ac4bc9ca6f6364833fb}{\_cur\_distance}}*veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a1180998ca4eeb7d695d135a1e4a75424}{\_accel\_max}} + pow(veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a026375b9e6ffc8f8c8aee72465f352dc}{\_cur\_speed}}, 2));}
\DoxyCodeLine{00084         \textcolor{keywordtype}{double} denominator = veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a253341595deb3473620116dcf63d9927}{\_decel\_max}}-\/veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a1180998ca4eeb7d695d135a1e4a75424}{\_accel\_max}};}
\DoxyCodeLine{00085         \textcolor{keywordtype}{double} v\_hat = sqrt(numerator/denominator);}
\DoxyCodeLine{00086         \textcolor{comment}{// If v\_hat is less that current vehicle speed, const maximum deceleration will not stop before stop bar}}
\DoxyCodeLine{00087         \textcolor{keywordflow}{if} ( v\_hat < veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a026375b9e6ffc8f8c8aee72465f352dc}{\_cur\_speed}}) \{}
\DoxyCodeLine{00088             SPDLOG\_ERROR(\textcolor{stringliteral}{"{}Stopping trajectory not possible for vehicle \{0\} with speed \{1\} m/s and v\_hat \{2\} m/s!"{}}, veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a470605f661a8f625329ebbb10888e2b8}{\_id}}, veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a026375b9e6ffc8f8c8aee72465f352dc}{\_cur\_speed}}, v\_hat);}
\DoxyCodeLine{00089         \}}
\DoxyCodeLine{00090         \textcolor{keywordflow}{return} v\_hat;}
\DoxyCodeLine{00091     \}}

\end{DoxyCode}


References \mbox{\hyperlink{vehicle_8h_source_l00045}{streets\+\_\+vehicles\+::vehicle\+::\+\_\+accel\+\_\+max}}, \mbox{\hyperlink{vehicle_8h_source_l00073}{streets\+\_\+vehicles\+::vehicle\+::\+\_\+cur\+\_\+distance}}, \mbox{\hyperlink{vehicle_8h_source_l00075}{streets\+\_\+vehicles\+::vehicle\+::\+\_\+cur\+\_\+speed}}, \mbox{\hyperlink{vehicle_8h_source_l00047}{streets\+\_\+vehicles\+::vehicle\+::\+\_\+decel\+\_\+max}}, and \mbox{\hyperlink{vehicle_8h_source_l00037}{streets\+\_\+vehicles\+::vehicle\+::\+\_\+id}}.



Referenced by \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00390}{estimate\+\_\+earliest\+\_\+time\+\_\+to\+\_\+stop\+\_\+bar()}}.

Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_ae5a42af1af20b06df9ad6af5d3170406_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a77c415e3ef29a00acc67c7aac87a270b}\label{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a77c415e3ef29a00acc67c7aac87a270b}} 
\index{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}!consider\_departure\_position\_permutation@{consider\_departure\_position\_permutation}}
\index{consider\_departure\_position\_permutation@{consider\_departure\_position\_permutation}!streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}}
\doxysubsubsection{\texorpdfstring{consider\_departure\_position\_permutation()}{consider\_departure\_position\_permutation()}}
{\footnotesize\ttfamily bool streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+scheduler\+::consider\+\_\+departure\+\_\+position\+\_\+permutation (\begin{DoxyParamCaption}\item[{const std\+::list$<$ \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\+\_\+vehicles\+::vehicle}} $>$ \&}]{rdvs,  }\item[{const std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__intersection__schedule}{all\+\_\+stop\+\_\+intersection\+\_\+schedule}} $>$ \&}]{option,  }\item[{int}]{starting\+\_\+departure\+\_\+position }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [private]}}



Creates and intersection schedule for a given RDV departure order. RDV departure order is based on rdvs order. Returns reference to \mbox{\hyperlink{structstreets__vehicle__scheduler_1_1intersection__schedule}{intersection\+\_\+schedule}} option/possibility with given departure order. Assumes \mbox{\hyperlink{structstreets__vehicle__scheduler_1_1intersection__schedule}{intersection\+\_\+schedule}} option only contains schedules for DVs. Populates \mbox{\hyperlink{structstreets__vehicle__scheduler_1_1intersection__schedule}{intersection\+\_\+schedule}} with RDV vehicle\+\_\+schedules. 


\begin{DoxyParams}{Parameters}
{\em rdvs} & vector of unscheduled RDVs \\
\hline
{\em option} & \mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__intersection__schedule}{all\+\_\+stop\+\_\+intersection\+\_\+schedule}} possibility. \\
\hline
{\em starting\+\_\+departure\+\_\+position} & first available departure position given already scheduled vehicle (e.\+i. DVs) \\
\hline
{\em scheduled\+\_\+dvs} & a vector of scheduled dvs, This includes dvs already schedules and any RDVs scheduled in this permutation. This is necessary for calculating the current RDVs entering time based on already scheduled DVs and RDVs conflicts. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
true if departure order is valid and does not violate flexibility\+\_\+limit for any vehicle. 

false if departure order is invalid and does violate flexibility\+\_\+limit for any vehicle. 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00432}{432}} of file \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source}{all\+\_\+stop\+\_\+vehicle\+\_\+scheduler.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00435                                                                                                                         \{}
\DoxyCodeLine{00436         \textcolor{keywordflow}{for} ( \textcolor{keyword}{const} \textcolor{keyword}{auto} \&veh : rdvs ) \{}
\DoxyCodeLine{00437             \textcolor{comment}{// If scheduling option moves vehicle departure position more than flexibility limit it is not a valid option.}}
\DoxyCodeLine{00438             \textcolor{keywordflow}{if} ( abs(starting\_departure\_position -\/ veh.\_departure\_position) > \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a004c41012f860faa9634e42c7d5740f7}{flexibility\_limit}} ) \{}
\DoxyCodeLine{00439                 SPDLOG\_WARN(}
\DoxyCodeLine{00440                     \textcolor{stringliteral}{"{}Not considering scheduling option since change in departure position for vehicle \{0\} exceeds flexibility limit \{1\}!"{}},}
\DoxyCodeLine{00441                     veh.\_id, \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a004c41012f860faa9634e42c7d5740f7}{flexibility\_limit}});}
\DoxyCodeLine{00442                 \textcolor{comment}{// Break out of scheduling estimation loop and do not consider this scheduling option}}
\DoxyCodeLine{00443                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00444             \}}
\DoxyCodeLine{00445             all\_stop\_vehicle\_schedule sched;}
\DoxyCodeLine{00446             \textcolor{comment}{// Populate common vehicle schedule information}}
\DoxyCodeLine{00447             sched.v\_id = veh.\_id;}
\DoxyCodeLine{00448             \textcolor{comment}{// RDVs should have already stopped}}
\DoxyCodeLine{00449             sched.st = veh.\_actual\_st;}
\DoxyCodeLine{00450             sched.est =  veh.\_actual\_st;}
\DoxyCodeLine{00451             \textcolor{comment}{// set dp position for current permutation                      }}
\DoxyCodeLine{00452             sched.dp = starting\_departure\_position;}
\DoxyCodeLine{00453             \textcolor{comment}{// Set connection link lanelet id}}
\DoxyCodeLine{00454             sched.link\_id = veh.\_link\_id;}
\DoxyCodeLine{00455             \textcolor{comment}{// Set entry lanelet id }}
\DoxyCodeLine{00456             sched.entry\_lane = veh.\_entry\_lane\_id;}
\DoxyCodeLine{00457             \textcolor{comment}{// Get vehicle lane info}}
\DoxyCodeLine{00458             \mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info}{OpenAPI::OAILanelet\_info}} veh\_lane = \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1vehicle__scheduler_af2c80eb87e5a9cabaad660544003663c}{get\_link\_lanelet\_info}}(veh);}
\DoxyCodeLine{00459             std::shared\_ptr<all\_stop\_vehicle\_schedule> latest\_conflicting\_vehicle = \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_aa06721804b8a4075b98c2e8ad40c84da}{get\_latest\_conflicting}}( veh\_lane, option-\/>vehicle\_schedules);}
\DoxyCodeLine{00460             \textcolor{comment}{// If there is no conflicting scheduled vehicle (RDVs and DVs)}}
\DoxyCodeLine{00461             \textcolor{keywordflow}{if} ( latest\_conflicting\_vehicle == \textcolor{keyword}{nullptr}) \{}
\DoxyCodeLine{00462                 \textcolor{comment}{// Consider previously scheduled vehicle. Current vehicle cannot be granted access}}
\DoxyCodeLine{00463                 \textcolor{comment}{// to intersection regardless of conflict status before previously scheduled vehicle}}
\DoxyCodeLine{00464                 \textcolor{comment}{// to preserve departure order}}
\DoxyCodeLine{00465                 \textcolor{keywordflow}{if} ( option-\/>vehicle\_schedules.empty() || option-\/>vehicle\_schedules.back().access ) \{}
\DoxyCodeLine{00466                     \textcolor{comment}{// Give vehicle access since there are no proceeding vehicles}}
\DoxyCodeLine{00467                     sched.access = \textcolor{keyword}{true};}
\DoxyCodeLine{00468                     \textcolor{comment}{// Set vehicle state. Will not impact clearance time estimation since set on schedule}}
\DoxyCodeLine{00469                     sched.state = \mbox{\hyperlink{namespacestreets__vehicles_a41f5c896d8020c141aa96235cf1405aca58d6a88f13e2db7f5059c41047876f00}{streets\_vehicles::vehicle\_state::DV}};}
\DoxyCodeLine{00470                     \textcolor{comment}{// Entering time equals schedule time}}
\DoxyCodeLine{00471                     sched.et = option-\/>timestamp;}
\DoxyCodeLine{00472                     \textcolor{comment}{// Departure time equals entering time + clearance time}}
\DoxyCodeLine{00473                     sched.dt =  sched.et + \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a15b4da36dba827263da4c844028c6db1}{estimate\_clearance\_time}}( veh, veh\_lane);}
\DoxyCodeLine{00474                 \}}
\DoxyCodeLine{00475                 \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00476                     \textcolor{comment}{// Can not grant access to vehicle if previous vehicle does not have access yet.}}
\DoxyCodeLine{00477                     sched.access = \textcolor{keyword}{false};}
\DoxyCodeLine{00478                     \textcolor{comment}{// Set vehicle state. Will not impact clearance time estimation since set on schedule}}
\DoxyCodeLine{00479                     sched.state = \mbox{\hyperlink{namespacestreets__vehicles_a41f5c896d8020c141aa96235cf1405acab08ef04fe84cf4f6645fef073717f36f}{streets\_vehicles::vehicle\_state::RDV}};}
\DoxyCodeLine{00480                     \textcolor{comment}{// Entering time equals schedule time}}
\DoxyCodeLine{00481                     sched.et = option-\/>vehicle\_schedules.back().et;}
\DoxyCodeLine{00482                     \textcolor{comment}{// Departure time equals entering time + clearance time}}
\DoxyCodeLine{00483                     sched.dt =  sched.et + \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a15b4da36dba827263da4c844028c6db1}{estimate\_clearance\_time}}( veh, veh\_lane); }
\DoxyCodeLine{00484                 \}}
\DoxyCodeLine{00485             \}}
\DoxyCodeLine{00486             \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00487                 SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Latest conflicting vehicle is \{0\} and next vehicle is \{1\}"{}}, latest\_conflicting\_vehicle-\/>v\_id, veh.\_id);}
\DoxyCodeLine{00488                 sched.access = \textcolor{keyword}{false};}
\DoxyCodeLine{00489                 sched.state =  \mbox{\hyperlink{namespacestreets__vehicles_a41f5c896d8020c141aa96235cf1405acab08ef04fe84cf4f6645fef073717f36f}{streets\_vehicles::vehicle\_state::RDV}};}
\DoxyCodeLine{00490                 sched.et =  std::max(latest\_conflicting\_vehicle-\/>dt, option-\/>vehicle\_schedules.back().et);}
\DoxyCodeLine{00491                 \textcolor{comment}{// Departure time is estimated clearance time for vehicle and link lane plus entering time}}
\DoxyCodeLine{00492                 sched.dt = sched.et + \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a15b4da36dba827263da4c844028c6db1}{estimate\_clearance\_time}}( veh, veh\_lane );}
\DoxyCodeLine{00493 }
\DoxyCodeLine{00494                 }
\DoxyCodeLine{00495             \}}
\DoxyCodeLine{00496             \textcolor{comment}{// Add vehicle schedule to option}}
\DoxyCodeLine{00497             option-\/>vehicle\_schedules.push\_back(sched);}
\DoxyCodeLine{00498             \textcolor{comment}{// Point to new previously scheduled vehicle}}
\DoxyCodeLine{00499             \textcolor{comment}{// Increment departure position}}
\DoxyCodeLine{00500             starting\_departure\_position++;}
\DoxyCodeLine{00501 }
\DoxyCodeLine{00502             }
\DoxyCodeLine{00503         \}}
\DoxyCodeLine{00504         SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Schedule Option: \(\backslash\)n"{}}+option-\/>toCSV());}
\DoxyCodeLine{00505         SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}With delay \{0\}."{}} ,option-\/>get\_delay() );}
\DoxyCodeLine{00506         \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00507 }
\DoxyCodeLine{00508             }
\DoxyCodeLine{00509     \}}

\end{DoxyCode}


References \mbox{\hyperlink{all__stop__intersection__schedule_8h_source_l00056}{streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+schedule\+::access}}, \mbox{\hyperlink{all__stop__intersection__schedule_8h_source_l00052}{streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+schedule\+::dp}}, \mbox{\hyperlink{all__stop__intersection__schedule_8h_source_l00045}{streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+schedule\+::dt}}, \mbox{\hyperlink{namespacestreets__vehicles_a41f5c896d8020c141aa96235cf1405aca58d6a88f13e2db7f5059c41047876f00}{streets\+\_\+vehicles\+::\+DV}}, \mbox{\hyperlink{intersection__schedule_8h_source_l00032}{streets\+\_\+vehicle\+\_\+scheduler\+::vehicle\+\_\+schedule\+::entry\+\_\+lane}}, \mbox{\hyperlink{all__stop__intersection__schedule_8h_source_l00029}{streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+schedule\+::est}}, \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00511}{estimate\+\_\+clearance\+\_\+time()}}, \mbox{\hyperlink{all__stop__intersection__schedule_8h_source_l00039}{streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+schedule\+::et}}, \mbox{\hyperlink{all__stop__vehicle__scheduler_8h_source_l00036}{flexibility\+\_\+limit}}, \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00547}{get\+\_\+latest\+\_\+conflicting()}}, \mbox{\hyperlink{vehicle__scheduler_8cpp_source_l00031}{streets\+\_\+vehicle\+\_\+scheduler\+::vehicle\+\_\+scheduler\+::get\+\_\+link\+\_\+lanelet\+\_\+info()}}, \mbox{\hyperlink{intersection__schedule_8h_source_l00036}{streets\+\_\+vehicle\+\_\+scheduler\+::vehicle\+\_\+schedule\+::link\+\_\+id}}, \mbox{\hyperlink{namespacestreets__vehicles_a41f5c896d8020c141aa96235cf1405acab08ef04fe84cf4f6645fef073717f36f}{streets\+\_\+vehicles\+::\+RDV}}, \mbox{\hyperlink{all__stop__intersection__schedule_8h_source_l00034}{streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+schedule\+::st}}, \mbox{\hyperlink{all__stop__intersection__schedule_8h_source_l00060}{streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+schedule\+::state}}, and \mbox{\hyperlink{intersection__schedule_8h_source_l00028}{streets\+\_\+vehicle\+\_\+scheduler\+::vehicle\+\_\+schedule\+::v\+\_\+id}}.



Referenced by \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00171}{schedule\+\_\+rdvs()}}.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a77c415e3ef29a00acc67c7aac87a270b_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a77c415e3ef29a00acc67c7aac87a270b_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a15b4da36dba827263da4c844028c6db1}\label{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a15b4da36dba827263da4c844028c6db1}} 
\index{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}!estimate\_clearance\_time@{estimate\_clearance\_time}}
\index{estimate\_clearance\_time@{estimate\_clearance\_time}!streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}}
\doxysubsubsection{\texorpdfstring{estimate\_clearance\_time()}{estimate\_clearance\_time()}}
{\footnotesize\ttfamily uint64\+\_\+t streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+scheduler\+::estimate\+\_\+clearance\+\_\+time (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\+\_\+vehicles\+::vehicle}} \&}]{veh,  }\item[{const \mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info}{Open\+API\+::\+OAILanelet\+\_\+info}} \&}]{link\+\_\+lane\+\_\+info }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [private]}}



Estimate clearance time any vehicle given it\textquotesingle{}s link lanelet information. ~\newline
 


\begin{DoxyParams}{Parameters}
{\em veh} & vehicle to estimate clearance time for. \\
\hline
{\em link\+\_\+lane\+\_\+info} & link lanelet vehicle is attempting to clear. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
uint64\+\_\+t clearance time in milliseconds. 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00511}{511}} of file \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source}{all\+\_\+stop\+\_\+vehicle\+\_\+scheduler.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00512                                                                                                                        \{}
\DoxyCodeLine{00513         \textcolor{comment}{// Clearance time in seconds }}
\DoxyCodeLine{00514         \textcolor{keywordtype}{double} clearance\_time = 0;}
\DoxyCodeLine{00515         \textcolor{comment}{// If vehicle is Departing Vehicle consider its location in the link lanelet.}}
\DoxyCodeLine{00516         \textcolor{keywordflow}{if} ( veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a54872859b3a12ee290b98e0eedd2864f}{\_cur\_state}} == \mbox{\hyperlink{namespacestreets__vehicles_a41f5c896d8020c141aa96235cf1405aca58d6a88f13e2db7f5059c41047876f00}{streets\_vehicles::vehicle\_state::DV}} ) \{}
\DoxyCodeLine{00517             \textcolor{comment}{// Distance covered during constant max acceleration to speed limit}}
\DoxyCodeLine{00518             \textcolor{keywordtype}{double} constant\_acceleration\_delta\_x = (pow(link\_lane\_info.\mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info_a9ed2860829d5aeba3062f26e78afcbdc}{getSpeedLimit}}(), 2) -\/ pow( veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a026375b9e6ffc8f8c8aee72465f352dc}{\_cur\_speed}}, 2))/(2* veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a1180998ca4eeb7d695d135a1e4a75424}{\_accel\_max}});}
\DoxyCodeLine{00519             \textcolor{comment}{// If vehicle accelerates to speed limit with max acceleration is it still in link lanelet}}
\DoxyCodeLine{00520             \textcolor{keywordflow}{if} ( veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a21a6378ca2401ac4bc9ca6f6364833fb}{\_cur\_distance}} > constant\_acceleration\_delta\_x ) \{}
\DoxyCodeLine{00521                 clearance\_time = ( 2 * veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a1180998ca4eeb7d695d135a1e4a75424}{\_accel\_max}} * veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a21a6378ca2401ac4bc9ca6f6364833fb}{\_cur\_distance}} -\/ link\_lane\_info.\mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info_a9ed2860829d5aeba3062f26e78afcbdc}{getSpeedLimit}}()*veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a026375b9e6ffc8f8c8aee72465f352dc}{\_cur\_speed}} + pow(veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a026375b9e6ffc8f8c8aee72465f352dc}{\_cur\_speed}}, 2))/}
\DoxyCodeLine{00522                     (2*veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a1180998ca4eeb7d695d135a1e4a75424}{\_accel\_max}}*link\_lane\_info.\mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info_a9ed2860829d5aeba3062f26e78afcbdc}{getSpeedLimit}}());}
\DoxyCodeLine{00523             \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00524                 clearance\_time = (sqrt(pow(veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a026375b9e6ffc8f8c8aee72465f352dc}{\_cur\_speed}}, 2)+2*veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a1180998ca4eeb7d695d135a1e4a75424}{\_accel\_max}}*veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a21a6378ca2401ac4bc9ca6f6364833fb}{\_cur\_distance}}) -\/veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a026375b9e6ffc8f8c8aee72465f352dc}{\_cur\_speed}})/}
\DoxyCodeLine{00525                         veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a1180998ca4eeb7d695d135a1e4a75424}{\_accel\_max}};}
\DoxyCodeLine{00526             \}}
\DoxyCodeLine{00527 }
\DoxyCodeLine{00528         \}}
\DoxyCodeLine{00529         \textcolor{comment}{// Consider vehicle is stopped at stop bar}}
\DoxyCodeLine{00530         \textcolor{keywordflow}{else}  \{}
\DoxyCodeLine{00531             \textcolor{comment}{// Distance covered during constant max acceleration to speed limit assuming initial 0 speed.}}
\DoxyCodeLine{00532             \textcolor{keywordtype}{double} constant\_acceleration\_delta\_x = pow(link\_lane\_info.\mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info_a9ed2860829d5aeba3062f26e78afcbdc}{getSpeedLimit}}(), 2) / (2 * veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a1180998ca4eeb7d695d135a1e4a75424}{\_accel\_max}});}
\DoxyCodeLine{00533             \textcolor{comment}{// If vehicle accelerates to speed limit with max acceleration is it still in the link lanelet}}
\DoxyCodeLine{00534             \textcolor{keywordflow}{if} ( constant\_acceleration\_delta\_x < link\_lane\_info.\mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info_abc1c4d5d24a2dafb175874ecad09cfad}{getLength}}())\{}
\DoxyCodeLine{00535                 \textcolor{comment}{// If yes assume vehicle cruises at speed limit for the duration of the lanelet}}
\DoxyCodeLine{00536                 clearance\_time = link\_lane\_info.\mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info_abc1c4d5d24a2dafb175874ecad09cfad}{getLength}}() / link\_lane\_info.\mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info_a9ed2860829d5aeba3062f26e78afcbdc}{getSpeedLimit}}() + }
\DoxyCodeLine{00537                             link\_lane\_info.\mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info_a9ed2860829d5aeba3062f26e78afcbdc}{getSpeedLimit}}() / (2 *veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a1180998ca4eeb7d695d135a1e4a75424}{\_accel\_max}});}
\DoxyCodeLine{00538             \} \textcolor{keywordflow}{else}\{}
\DoxyCodeLine{00539                 \textcolor{comment}{// If not assume vehicle trajectory is constant acceleration from initial speed of 0}}
\DoxyCodeLine{00540                 clearance\_time = sqrt(2 * link\_lane\_info.\mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info_abc1c4d5d24a2dafb175874ecad09cfad}{getLength}}() / veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a1180998ca4eeb7d695d135a1e4a75424}{\_accel\_max}}) ;}
\DoxyCodeLine{00541             \}}
\DoxyCodeLine{00542         \}}
\DoxyCodeLine{00543         \textcolor{comment}{// Convert time to milliseconds and round up.}}
\DoxyCodeLine{00544         \textcolor{keywordflow}{return} \textcolor{keyword}{static\_cast<}uint64\_t\textcolor{keyword}{>}(ceil(1000.0* clearance\_time));}
\DoxyCodeLine{00545     \}}

\end{DoxyCode}


References \mbox{\hyperlink{vehicle_8h_source_l00045}{streets\+\_\+vehicles\+::vehicle\+::\+\_\+accel\+\_\+max}}, \mbox{\hyperlink{vehicle_8h_source_l00073}{streets\+\_\+vehicles\+::vehicle\+::\+\_\+cur\+\_\+distance}}, \mbox{\hyperlink{vehicle_8h_source_l00075}{streets\+\_\+vehicles\+::vehicle\+::\+\_\+cur\+\_\+speed}}, \mbox{\hyperlink{vehicle_8h_source_l00079}{streets\+\_\+vehicles\+::vehicle\+::\+\_\+cur\+\_\+state}}, \mbox{\hyperlink{namespacestreets__vehicles_a41f5c896d8020c141aa96235cf1405aca58d6a88f13e2db7f5059c41047876f00}{streets\+\_\+vehicles\+::\+DV}}, \mbox{\hyperlink{intersection__client__api_2OAILanelet__info_8cpp_source_l00169}{Open\+API\+::\+OAILanelet\+\_\+info\+::get\+Length()}}, and \mbox{\hyperlink{intersection__client__api_2OAILanelet__info_8cpp_source_l00137}{Open\+API\+::\+OAILanelet\+\_\+info\+::get\+Speed\+Limit()}}.



Referenced by \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00432}{consider\+\_\+departure\+\_\+position\+\_\+permutation()}}, \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00117}{schedule\+\_\+dvs()}}, and \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00230}{schedule\+\_\+evs()}}.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a15b4da36dba827263da4c844028c6db1_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a15b4da36dba827263da4c844028c6db1_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_acab5956159419bef2c5391d59e3fe9ee}\label{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_acab5956159419bef2c5391d59e3fe9ee}} 
\index{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}!estimate\_delta\_x\_prime@{estimate\_delta\_x\_prime}}
\index{estimate\_delta\_x\_prime@{estimate\_delta\_x\_prime}!streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}}
\doxysubsubsection{\texorpdfstring{estimate\_delta\_x\_prime()}{estimate\_delta\_x\_prime()}}
{\footnotesize\ttfamily double streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+scheduler\+::estimate\+\_\+delta\+\_\+x\+\_\+prime (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\+\_\+vehicles\+::vehicle}} \&}]{veh,  }\item[{const \mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info}{Open\+API\+::\+OAILanelet\+\_\+info}} \&}]{entry\+\_\+lane }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [private]}}



Calculate minumum distance required to speed up to lane speed limit with maximum acceleration, cruise at lane speed limit for some time, then decelerate with maximum deceleration. This is used to determine the trajectory to provide the vehicle. 


\begin{DoxyParams}{Parameters}
{\em veh} & vehicle for which to calculate distance. \\
\hline
{\em entry\+\_\+lane} & entry lane information. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
double distance in meters 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00068}{68}} of file \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source}{all\+\_\+stop\+\_\+vehicle\+\_\+scheduler.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00069                                                                                                                \{}
\DoxyCodeLine{00070         \textcolor{keywordflow}{if} ( veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a54872859b3a12ee290b98e0eedd2864f}{\_cur\_state}} == \mbox{\hyperlink{namespacestreets__vehicles_a41f5c896d8020c141aa96235cf1405aca834d41112f2943c357f660165b6eb6de}{streets\_vehicles::vehicle\_state::EV}} ) \{}
\DoxyCodeLine{00071             \textcolor{comment}{// Get Entry Lanelet}}
\DoxyCodeLine{00072             \textcolor{keywordtype}{double} delta\_x\_prime = (pow(entry\_lane.\mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info_a9ed2860829d5aeba3062f26e78afcbdc}{getSpeedLimit}}(),2)-\/pow(veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a026375b9e6ffc8f8c8aee72465f352dc}{\_cur\_speed}},2))/(2*veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a1180998ca4eeb7d695d135a1e4a75424}{\_accel\_max}}) -\/ }
\DoxyCodeLine{00073                 pow(entry\_lane.\mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info_a9ed2860829d5aeba3062f26e78afcbdc}{getSpeedLimit}}(), 2)/(2*veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a253341595deb3473620116dcf63d9927}{\_decel\_max}}); }
\DoxyCodeLine{00074             \textcolor{keywordflow}{return}  delta\_x\_prime;}
\DoxyCodeLine{00075         \}}
\DoxyCodeLine{00076         \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00077             SPDLOG\_WARN(\textcolor{stringliteral}{"{}Cannot estimate delta x prime for vehicle \{0\} because it's state \{1\} != EV !"{}} );}
\DoxyCodeLine{00078         \}}
\DoxyCodeLine{00079         \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{00080     \}}

\end{DoxyCode}


References \mbox{\hyperlink{vehicle_8h_source_l00045}{streets\+\_\+vehicles\+::vehicle\+::\+\_\+accel\+\_\+max}}, \mbox{\hyperlink{vehicle_8h_source_l00075}{streets\+\_\+vehicles\+::vehicle\+::\+\_\+cur\+\_\+speed}}, \mbox{\hyperlink{vehicle_8h_source_l00079}{streets\+\_\+vehicles\+::vehicle\+::\+\_\+cur\+\_\+state}}, \mbox{\hyperlink{vehicle_8h_source_l00047}{streets\+\_\+vehicles\+::vehicle\+::\+\_\+decel\+\_\+max}}, \mbox{\hyperlink{namespacestreets__vehicles_a41f5c896d8020c141aa96235cf1405aca834d41112f2943c357f660165b6eb6de}{streets\+\_\+vehicles\+::\+EV}}, and \mbox{\hyperlink{intersection__client__api_2OAILanelet__info_8cpp_source_l00137}{Open\+API\+::\+OAILanelet\+\_\+info\+::get\+Speed\+Limit()}}.



Referenced by \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00390}{estimate\+\_\+earliest\+\_\+time\+\_\+to\+\_\+stop\+\_\+bar()}}.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_acab5956159419bef2c5391d59e3fe9ee_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_acab5956159419bef2c5391d59e3fe9ee_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_ad5f0462b2d82168b7b71dcfd15eaa7f2}\label{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_ad5f0462b2d82168b7b71dcfd15eaa7f2}} 
\index{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}!estimate\_earliest\_time\_to\_stop\_bar@{estimate\_earliest\_time\_to\_stop\_bar}}
\index{estimate\_earliest\_time\_to\_stop\_bar@{estimate\_earliest\_time\_to\_stop\_bar}!streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}}
\doxysubsubsection{\texorpdfstring{estimate\_earliest\_time\_to\_stop\_bar()}{estimate\_earliest\_time\_to\_stop\_bar()}}
{\footnotesize\ttfamily uint64\+\_\+t streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+scheduler\+::estimate\+\_\+earliest\+\_\+time\+\_\+to\+\_\+stop\+\_\+bar (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\+\_\+vehicles\+::vehicle}} \&}]{veh }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [private]}}



Method to use vehicle kinematic information to estimate earliest possible time stopping time for a vehicle. Does not consider any other vehicles. Limiting factors are the vehicles current kinematic information, lane speed limits and vehicle acceleration and deceleration limits. 


\begin{DoxyParams}{Parameters}
{\em veh} & vehicle for which to calculate trajectory \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
uint64\+\_\+t time in milliseconds. 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00390}{390}} of file \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source}{all\+\_\+stop\+\_\+vehicle\+\_\+scheduler.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00390                                                                                                                    \{}
\DoxyCodeLine{00391         \textcolor{comment}{// Distance to stop bar }}
\DoxyCodeLine{00392         \textcolor{keywordtype}{double} delta\_x = veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a21a6378ca2401ac4bc9ca6f6364833fb}{\_cur\_distance}};}
\DoxyCodeLine{00393         \textcolor{comment}{// Get Entry Lane}}
\DoxyCodeLine{00394         \mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info}{OpenAPI::OAILanelet\_info}} lane\_info =  \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1vehicle__scheduler_af8916add714bef70d8f48efc0ccfca7b}{get\_entry\_lanelet\_info}}( veh );}
\DoxyCodeLine{00395         \textcolor{comment}{// Distance necessary to get to max speed and decelerate with decel\_max}}
\DoxyCodeLine{00396         \textcolor{keywordtype}{double} delta\_x\_prime =  \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_acab5956159419bef2c5391d59e3fe9ee}{estimate\_delta\_x\_prime}}( veh, lane\_info );}
\DoxyCodeLine{00397         SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Delta X Prime = \{0\}."{}}, delta\_x\_prime);}
\DoxyCodeLine{00398 }
\DoxyCodeLine{00399         \textcolor{comment}{// Calculate v\_hat and planned cruising time interval}}
\DoxyCodeLine{00400         \textcolor{keywordtype}{double} v\_hat;}
\DoxyCodeLine{00401         \textcolor{keywordtype}{double} t\_cruising;}
\DoxyCodeLine{00402         \textcolor{keywordflow}{if} ( delta\_x >= delta\_x\_prime ) \{}
\DoxyCodeLine{00403             v\_hat = lane\_info.\mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info_a9ed2860829d5aeba3062f26e78afcbdc}{getSpeedLimit}}();}
\DoxyCodeLine{00404             SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}V hat = \{0\}."{}}, v\_hat);}
\DoxyCodeLine{00405 }
\DoxyCodeLine{00406             t\_cruising = \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_afedbbc9205b39ceb8707d950b5c26556}{calculate\_cruising\_time}}(veh, v\_hat, delta\_x\_prime); }
\DoxyCodeLine{00407             SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}T cruising = \{0\}."{}},t\_cruising);}
\DoxyCodeLine{00408 }
\DoxyCodeLine{00409         \}}
\DoxyCodeLine{00410         \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00411             v\_hat =  \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_ae5a42af1af20b06df9ad6af5d3170406}{calculate\_v\_hat}}(veh);}
\DoxyCodeLine{00412             SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}V hat = \{0\}."{}}, v\_hat);}
\DoxyCodeLine{00413 }
\DoxyCodeLine{00414             t\_cruising = 0.0;}
\DoxyCodeLine{00415             SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}T cruising = \{0\}."{}},t\_cruising);}
\DoxyCodeLine{00416 }
\DoxyCodeLine{00417         \}}
\DoxyCodeLine{00418         }
\DoxyCodeLine{00419         \textcolor{comment}{// calculate planned acceleration time interval}}
\DoxyCodeLine{00420         \textcolor{keywordtype}{double} t\_accel = \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a3ba56cc964002b21475a475995938b89}{calculate\_acceleration\_time}}(veh, v\_hat);}
\DoxyCodeLine{00421         SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}T accel = \{0\}."{}},t\_accel);}
\DoxyCodeLine{00422 }
\DoxyCodeLine{00423         \textcolor{comment}{// calculate planned deceleration time interval}}
\DoxyCodeLine{00424         \textcolor{keywordtype}{double} t\_decel = \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a63107a1e136be3a00f3a1445531904aa}{calculate\_deceleration\_time}}(veh, v\_hat);}
\DoxyCodeLine{00425         SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}T decel = \{0\}."{}},t\_decel);}
\DoxyCodeLine{00426 }
\DoxyCodeLine{00427         \textcolor{comment}{// calculate time to stop bar}}
\DoxyCodeLine{00428         \textcolor{keywordtype}{double} time\_to\_stop\_bar = t\_accel + t\_cruising + t\_decel;}
\DoxyCodeLine{00429         \textcolor{keywordflow}{return} \textcolor{keyword}{static\_cast<}uint64\_t\textcolor{keyword}{>}(ceil(time\_to\_stop\_bar * 1000.0)) + veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a278b51810d25efcfcfb91bb13e43e6f3}{\_cur\_time}};}
\DoxyCodeLine{00430     \}}

\end{DoxyCode}


References \mbox{\hyperlink{vehicle_8h_source_l00073}{streets\+\_\+vehicles\+::vehicle\+::\+\_\+cur\+\_\+distance}}, \mbox{\hyperlink{vehicle_8h_source_l00071}{streets\+\_\+vehicles\+::vehicle\+::\+\_\+cur\+\_\+time}}, \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00093}{calculate\+\_\+acceleration\+\_\+time()}}, \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00103}{calculate\+\_\+cruising\+\_\+time()}}, \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00113}{calculate\+\_\+deceleration\+\_\+time()}}, \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00082}{calculate\+\_\+v\+\_\+hat()}}, \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00068}{estimate\+\_\+delta\+\_\+x\+\_\+prime()}}, \mbox{\hyperlink{vehicle__scheduler_8cpp_source_l00013}{streets\+\_\+vehicle\+\_\+scheduler\+::vehicle\+\_\+scheduler\+::get\+\_\+entry\+\_\+lanelet\+\_\+info()}}, and \mbox{\hyperlink{intersection__client__api_2OAILanelet__info_8cpp_source_l00137}{Open\+API\+::\+OAILanelet\+\_\+info\+::get\+Speed\+Limit()}}.



Referenced by \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00230}{schedule\+\_\+evs()}}.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_ad5f0462b2d82168b7b71dcfd15eaa7f2_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_ad5f0462b2d82168b7b71dcfd15eaa7f2_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a9b5ee4ffdbd82cbf0c48f7981e7dff9c}\label{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a9b5ee4ffdbd82cbf0c48f7981e7dff9c}} 
\index{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}!estimate\_entering\_time\_for\_ev@{estimate\_entering\_time\_for\_ev}}
\index{estimate\_entering\_time\_for\_ev@{estimate\_entering\_time\_for\_ev}!streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}}
\doxysubsubsection{\texorpdfstring{estimate\_entering\_time\_for\_ev()}{estimate\_entering\_time\_for\_ev()}}
{\footnotesize\ttfamily uint64\+\_\+t streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+scheduler\+::estimate\+\_\+entering\+\_\+time\+\_\+for\+\_\+ev (\begin{DoxyParamCaption}\item[{const std\+::vector$<$ \mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule}{all\+\_\+stop\+\_\+vehicle\+\_\+schedule}} $>$ \&}]{vehicle\+\_\+schedules,  }\item[{const \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\+\_\+vehicles\+::vehicle}} \&}]{ev,  }\item[{const uint64\+\_\+t}]{st }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [private]}}



Estimates an entering time (ET) for a given Entering Vehicle (EV). This method first searches among the existing scheduled vehicles and find the departure time (DT) of the last scheduled vehicle with conflicting direction. The ET of the vehicle is calculated based on this DT (if exist) and the estimated stopping time (ST) oft the vehicle. ~\newline
 


\begin{DoxyParams}{Parameters}
{\em schedule} & \mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__intersection__schedule}{all\+\_\+stop\+\_\+intersection\+\_\+schedule}}. \\
\hline
{\em ev} & vehicle for which to estimate ET. \\
\hline
{\em st} & estimated stopping time. \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00368}{368}} of file \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source}{all\+\_\+stop\+\_\+vehicle\+\_\+scheduler.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00368                                                                                                                                                                                                  \{}
\DoxyCodeLine{00369         \textcolor{comment}{// Get link lanelet information for ev}}
\DoxyCodeLine{00370         \mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info}{OpenAPI::OAILanelet\_info}} link\_lane = \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1vehicle__scheduler_af2c80eb87e5a9cabaad660544003663c}{get\_link\_lanelet\_info}}( ev );}
\DoxyCodeLine{00371         \textcolor{comment}{// Get schedule of conflicting vehicle with largest dt from already scheduled vehicles}}
\DoxyCodeLine{00372         \textcolor{keywordflow}{if} ( !vehicle\_schedules.empty() ) \{}
\DoxyCodeLine{00373             std::shared\_ptr<all\_stop\_vehicle\_schedule> conflict\_with\_largest\_dt = \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_aa06721804b8a4075b98c2e8ad40c84da}{get\_latest\_conflicting}}(link\_lane, vehicle\_schedules);}
\DoxyCodeLine{00374             }
\DoxyCodeLine{00375             \textcolor{keywordflow}{if} ( conflict\_with\_largest\_dt != \textcolor{keyword}{nullptr}) \{}
\DoxyCodeLine{00376                 SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Vehicle with largest conflict to \{0\} is \{1\}."{}}, ev.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a470605f661a8f625329ebbb10888e2b8}{\_id}}, conflict\_with\_largest\_dt-\/>v\_id);}
\DoxyCodeLine{00377                 \textcolor{comment}{// Entering time is the maximum between the conflicting vehicles departure time and the current vehicles stopping time}}
\DoxyCodeLine{00378                 \textcolor{keywordflow}{return} std::max(conflict\_with\_largest\_dt-\/>dt, st);}
\DoxyCodeLine{00379             \}\textcolor{keywordflow}{else}\{}
\DoxyCodeLine{00380                 \textcolor{comment}{// If there is no conflicting scheduled vehicle, st == et}}
\DoxyCodeLine{00381                 \textcolor{keywordflow}{return} st;}
\DoxyCodeLine{00382             \}}
\DoxyCodeLine{00383         \}}
\DoxyCodeLine{00384         \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00385             \textcolor{comment}{// If schedule is empty there can be no conflict}}
\DoxyCodeLine{00386             \textcolor{keywordflow}{return} st;}
\DoxyCodeLine{00387         \}}
\DoxyCodeLine{00388     \}}

\end{DoxyCode}


References \mbox{\hyperlink{vehicle_8h_source_l00037}{streets\+\_\+vehicles\+::vehicle\+::\+\_\+id}}, \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00547}{get\+\_\+latest\+\_\+conflicting()}}, and \mbox{\hyperlink{vehicle__scheduler_8cpp_source_l00031}{streets\+\_\+vehicle\+\_\+scheduler\+::vehicle\+\_\+scheduler\+::get\+\_\+link\+\_\+lanelet\+\_\+info()}}.



Referenced by \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00230}{schedule\+\_\+evs()}}.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a9b5ee4ffdbd82cbf0c48f7981e7dff9c_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a9b5ee4ffdbd82cbf0c48f7981e7dff9c_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_aa06721804b8a4075b98c2e8ad40c84da}\label{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_aa06721804b8a4075b98c2e8ad40c84da}} 
\index{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}!get\_latest\_conflicting@{get\_latest\_conflicting}}
\index{get\_latest\_conflicting@{get\_latest\_conflicting}!streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}}
\doxysubsubsection{\texorpdfstring{get\_latest\_conflicting()}{get\_latest\_conflicting()}}
{\footnotesize\ttfamily std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule}{all\+\_\+stop\+\_\+vehicle\+\_\+schedule}} $>$ streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+scheduler\+::get\+\_\+latest\+\_\+conflicting (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info}{Open\+API\+::\+OAILanelet\+\_\+info}} \&}]{link\+\_\+lane,  }\item[{const std\+::vector$<$ \mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__vehicle__schedule}{all\+\_\+stop\+\_\+vehicle\+\_\+schedule}} $>$ \&}]{schedules }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [private]}}



Given a link lane and a vector of vehicle schedules, this method returns a pointer to a vehicle schedule with a conflicting direction and the latest departure time. If no vehicle schedules have conflicting directions it returns nullptr. This method is meant to return the limiting conflicting vehicle for scheduling new RDVs in a link lane. 


\begin{DoxyParams}{Parameters}
{\em link\+\_\+lane} & the linking lane to be traveled \\
\hline
{\em schedules} & Already scheduled vehicles \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
std\+::shared\+\_\+ptr$<$vehicle\+\_\+schedule$>$ pointer to vehicle schedule with conflicting direction and latest departure time. 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00547}{547}} of file \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source}{all\+\_\+stop\+\_\+vehicle\+\_\+scheduler.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00548                                                                                                                                              \{       }
\DoxyCodeLine{00549         std::shared\_ptr<all\_stop\_vehicle\_schedule> conflict = \textcolor{keyword}{nullptr}; }
\DoxyCodeLine{00550 }
\DoxyCodeLine{00551         \textcolor{comment}{// Loop through all scheduled vehicles and return conflict with largest dt}}
\DoxyCodeLine{00552         \textcolor{keywordflow}{for} ( \textcolor{keyword}{const} \textcolor{keyword}{auto} \&sched : schedules ) \{}
\DoxyCodeLine{00553             \textcolor{comment}{// check if that have conflict with link\_lane}}
\DoxyCodeLine{00554             \textcolor{keywordflow}{if} ( link\_lane.\mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info_ae71cdbd0f92de4b223a654f03d2112c6}{getConflictLaneletIds}}().contains(sched.link\_id)) \{}
\DoxyCodeLine{00555                 \textcolor{comment}{// If no conflicting schedule has been set yet set conflict to first conflicting }}
\DoxyCodeLine{00556                 \textcolor{keywordflow}{if} ( conflict == \textcolor{keyword}{nullptr} ) \{}
\DoxyCodeLine{00557                     conflict = std::make\_shared<all\_stop\_vehicle\_schedule>( sched);}
\DoxyCodeLine{00558                 \}}
\DoxyCodeLine{00559                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( conflict-\/>dt < sched.dt ) \{}
\DoxyCodeLine{00560                     conflict = std::make\_shared<all\_stop\_vehicle\_schedule>( sched);}
\DoxyCodeLine{00561                 \}}
\DoxyCodeLine{00562             \}}
\DoxyCodeLine{00563             }
\DoxyCodeLine{00564         \}}
\DoxyCodeLine{00565         \textcolor{keywordflow}{return} conflict;                                              }
\DoxyCodeLine{00566     \}}

\end{DoxyCode}


References \mbox{\hyperlink{intersection__client__api_2OAILanelet__info_8cpp_source_l00153}{Open\+API\+::\+OAILanelet\+\_\+info\+::get\+Conflict\+Lanelet\+Ids()}}.



Referenced by \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00432}{consider\+\_\+departure\+\_\+position\+\_\+permutation()}}, and \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00368}{estimate\+\_\+entering\+\_\+time\+\_\+for\+\_\+ev()}}.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_aa06721804b8a4075b98c2e8ad40c84da_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_aa06721804b8a4075b98c2e8ad40c84da_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a0cf6941cc406bbd51889c129231e9443}\label{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a0cf6941cc406bbd51889c129231e9443}} 
\index{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}!get\_vehicle\_with\_id@{get\_vehicle\_with\_id}}
\index{get\_vehicle\_with\_id@{get\_vehicle\_with\_id}!streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}}
\doxysubsubsection{\texorpdfstring{get\_vehicle\_with\_id()}{get\_vehicle\_with\_id()}}
{\footnotesize\ttfamily \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\+\_\+vehicles\+::vehicle}} streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+scheduler\+::get\+\_\+vehicle\+\_\+with\+\_\+id (\begin{DoxyParamCaption}\item[{const std\+::list$<$ \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\+\_\+vehicles\+::vehicle}} $>$ \&}]{veh\+\_\+list,  }\item[{const std\+::string \&}]{veh\+\_\+id }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [private]}}



Given a list of vehicles and a vehicle id, this method returns the vehicle with a matching vehicle id if there is one. This method will throw a \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1scheduling__exception}{scheduling\+\_\+exception}} if no vehicle with the given id is found. 


\begin{DoxyParams}{Parameters}
{\em veh\+\_\+list} & list to search. \\
\hline
{\em veh\+\_\+id} & vehicle id to search for. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\+\_\+vehicles\+::vehicle}} vehicle with matching vehicle id 
\end{DoxyReturn}

\begin{DoxyExceptions}{Exceptions}
{\em \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1scheduling__exception}{scheduling\+\_\+exception}}} & if vehicle is not in list. \\
\hline
\end{DoxyExceptions}


Definition at line \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00595}{595}} of file \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source}{all\+\_\+stop\+\_\+vehicle\+\_\+scheduler.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00595                                                                                                                                                              \{}
\DoxyCodeLine{00596         \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\_vehicles::vehicle}} rtn;}
\DoxyCodeLine{00597         \textcolor{keywordtype}{bool} found\_veh = \textcolor{keyword}{false};}
\DoxyCodeLine{00598         \textcolor{keywordflow}{if} ( veh\_list.empty() ) \{}
\DoxyCodeLine{00599             \textcolor{keywordflow}{throw} scheduling\_exception(\textcolor{stringliteral}{"{}Vehicle List is empty!"{}});}
\DoxyCodeLine{00600             }
\DoxyCodeLine{00601         \}}
\DoxyCodeLine{00602         \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00603             \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto} \&veh : veh\_list ) \{}
\DoxyCodeLine{00604                 \textcolor{keywordflow}{if} ( veh.\_id == veh\_id ) \{}
\DoxyCodeLine{00605                     rtn = veh; }
\DoxyCodeLine{00606                     found\_veh = \textcolor{keyword}{true};}
\DoxyCodeLine{00607                 \}}
\DoxyCodeLine{00608             \}}
\DoxyCodeLine{00609         \}}
\DoxyCodeLine{00610         \textcolor{keywordflow}{if} (!found\_veh) \{}
\DoxyCodeLine{00611             \textcolor{keywordflow}{throw} scheduling\_exception(\textcolor{stringliteral}{"{}Vehicle"{}} +  veh\_id + \textcolor{stringliteral}{"{} not found!"{}});}
\DoxyCodeLine{00612  }
\DoxyCodeLine{00613         \}}
\DoxyCodeLine{00614         \textcolor{keywordflow}{return} rtn;}
\DoxyCodeLine{00615     \}}

\end{DoxyCode}


Referenced by \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00171}{schedule\+\_\+rdvs()}}.

Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a0cf6941cc406bbd51889c129231e9443_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a35eb7b98052f4ef88850471478fcdddb}\label{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a35eb7b98052f4ef88850471478fcdddb}} 
\index{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}!is\_rdv\_previously\_granted\_access@{is\_rdv\_previously\_granted\_access}}
\index{is\_rdv\_previously\_granted\_access@{is\_rdv\_previously\_granted\_access}!streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}}
\doxysubsubsection{\texorpdfstring{is\_rdv\_previously\_granted\_access()}{is\_rdv\_previously\_granted\_access()}}
{\footnotesize\ttfamily bool streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+scheduler\+::is\+\_\+rdv\+\_\+previously\+\_\+granted\+\_\+access (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\+\_\+vehicles\+::vehicle}} \&}]{veh }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [private]}}



Method to determine whether vehicle was granted access to the intersection in previous schedules. To avoid granting conflicting vehicles intersection access simultaneously, the scheduling service maintains a list of vehicles it has granted access to in the past. Vehicles are removed from this list once their update reflects that they have received and processed this access. 


\begin{DoxyParams}{Parameters}
{\em veh} & \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
true if vehicle is in list of vehicles previously granted access. 

false if vehicle is not in list of vehicles previously granted access. 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00580}{580}} of file \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source}{all\+\_\+stop\+\_\+vehicle\+\_\+scheduler.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00580                                                                                                                \{}
\DoxyCodeLine{00581         \textcolor{keywordflow}{if} ( \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a77c53828e29e53a9a7ff752afb65b549}{rdvs\_previously\_granted\_access}}.empty() ) \{}
\DoxyCodeLine{00582             \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00583         \}}
\DoxyCodeLine{00584         \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00585             \textcolor{keywordflow}{for} ( \textcolor{keyword}{const} \textcolor{keyword}{auto} \&rdv: \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a77c53828e29e53a9a7ff752afb65b549}{rdvs\_previously\_granted\_access}} ) \{}
\DoxyCodeLine{00586                 \textcolor{keywordflow}{if} ( rdv.\_id == veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a470605f661a8f625329ebbb10888e2b8}{\_id}} ) \{}
\DoxyCodeLine{00587                     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00588                 \}}
\DoxyCodeLine{00589             \}}
\DoxyCodeLine{00590             \textcolor{comment}{// not in list}}
\DoxyCodeLine{00591             \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00592         \}}
\DoxyCodeLine{00593     \}}

\end{DoxyCode}


References \mbox{\hyperlink{vehicle_8h_source_l00037}{streets\+\_\+vehicles\+::vehicle\+::\+\_\+id}}, and \mbox{\hyperlink{all__stop__vehicle__scheduler_8h_source_l00027}{rdvs\+\_\+previously\+\_\+granted\+\_\+access}}.



Referenced by \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00117}{schedule\+\_\+dvs()}}, and \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00009}{schedule\+\_\+vehicles()}}.

Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a35eb7b98052f4ef88850471478fcdddb_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a223e57041ae7ca6c4810877c8c74a49e}\label{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a223e57041ae7ca6c4810877c8c74a49e}} 
\index{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}!remove\_rdv\_previously\_granted\_access@{remove\_rdv\_previously\_granted\_access}}
\index{remove\_rdv\_previously\_granted\_access@{remove\_rdv\_previously\_granted\_access}!streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}}
\doxysubsubsection{\texorpdfstring{remove\_rdv\_previously\_granted\_access()}{remove\_rdv\_previously\_granted\_access()}}
{\footnotesize\ttfamily void streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+scheduler\+::remove\+\_\+rdv\+\_\+previously\+\_\+granted\+\_\+access (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\+\_\+vehicles\+::vehicle}} \&}]{veh }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



This method will remove a vehicle (DV) once it\textquotesingle{}s updates reflect that is has received access from the list of previously granted access RDVs. This method should be called once a RDV received the schedule update that grants it access to the intersection. This is indicated by the vehicle no longer being a RDV and instead being a DV (. 

\begin{DoxySeeAlso}{See also}
streets\+\_\+vehicle\+\_\+list library).
\end{DoxySeeAlso}

\begin{DoxyParams}{Parameters}
{\em veh} & DV to be removed from list \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00567}{567}} of file \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source}{all\+\_\+stop\+\_\+vehicle\+\_\+scheduler.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00567                                                                                                              \{}
\DoxyCodeLine{00568         \textcolor{keyword}{auto} previously\_granted\_itr = \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a77c53828e29e53a9a7ff752afb65b549}{rdvs\_previously\_granted\_access}}.begin();}
\DoxyCodeLine{00569         \textcolor{keywordflow}{while} ( previously\_granted\_itr != \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a77c53828e29e53a9a7ff752afb65b549}{rdvs\_previously\_granted\_access}}.end() ) \{}
\DoxyCodeLine{00570             \textcolor{keywordflow}{if} ( previously\_granted\_itr-\/>\_id == veh.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a470605f661a8f625329ebbb10888e2b8}{\_id}} ) \{}
\DoxyCodeLine{00571                 SPDLOG\_INFO(\textcolor{stringliteral}{"{}Removing DV \{0\} from list of RDVs previously granted access."{}}, previously\_granted\_itr-\/>\_id);}
\DoxyCodeLine{00572                 \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a77c53828e29e53a9a7ff752afb65b549}{rdvs\_previously\_granted\_access}}.erase(previously\_granted\_itr);}
\DoxyCodeLine{00573                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{00574             \}\textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00575                 previously\_granted\_itr++;}
\DoxyCodeLine{00576             \}}
\DoxyCodeLine{00577         \}}
\DoxyCodeLine{00578     \}}

\end{DoxyCode}


References \mbox{\hyperlink{vehicle_8h_source_l00037}{streets\+\_\+vehicles\+::vehicle\+::\+\_\+id}}, and \mbox{\hyperlink{all__stop__vehicle__scheduler_8h_source_l00027}{rdvs\+\_\+previously\+\_\+granted\+\_\+access}}.



Referenced by \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00009}{schedule\+\_\+vehicles()}}.

Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a223e57041ae7ca6c4810877c8c74a49e_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a16230014f5d43ef2546a54496c08a9cd}\label{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a16230014f5d43ef2546a54496c08a9cd}} 
\index{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}!schedule\_dvs@{schedule\_dvs}}
\index{schedule\_dvs@{schedule\_dvs}!streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}}
\doxysubsubsection{\texorpdfstring{schedule\_dvs()}{schedule\_dvs()}}
{\footnotesize\ttfamily void streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+scheduler\+::schedule\+\_\+dvs (\begin{DoxyParamCaption}\item[{std\+::list$<$ \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\+\_\+vehicles\+::vehicle}} $>$ \&}]{dvs,  }\item[{const std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__intersection__schedule}{all\+\_\+stop\+\_\+intersection\+\_\+schedule}} $>$ \&}]{schedule }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [private]}}



Schedule all currently Departing Vehicle (DVs). Estimate intersection departure times (dt\textquotesingle{}s) for each vehicle based on kinematic vehicle information and intersection geometry. Method assumes empty \mbox{\hyperlink{structstreets__vehicle__scheduler_1_1intersection__schedule}{intersection\+\_\+schedule}} is passed in. Method will add vehicle\+\_\+schedule(s) for each DV in the vector. 


\begin{DoxyParams}{Parameters}
{\em dvs} & vector of unscheduled DVs \\
\hline
{\em schedule} & \mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__intersection__schedule}{all\+\_\+stop\+\_\+intersection\+\_\+schedule}} to add DV scheduling information to. \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00117}{117}} of file \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source}{all\+\_\+stop\+\_\+vehicle\+\_\+scheduler.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00118                                                                                                                     \{       }
\DoxyCodeLine{00119         \textcolor{comment}{// Sort based on departure position}}
\DoxyCodeLine{00120         dvs.sort( \mbox{\hyperlink{namespacestreets__vehicle__scheduler_aa9f946d7c588b2697fd379fbed72f382}{departure\_position\_comparator}});}
\DoxyCodeLine{00121         \textcolor{comment}{// Regardless of previously set departure index, set DV with lowest departure position to departure position 1}}
\DoxyCodeLine{00122         \textcolor{comment}{// to account for DVs that have become LVs}}
\DoxyCodeLine{00123         \textcolor{keywordtype}{int} departure\_position\_index = 1;                                                    }
\DoxyCodeLine{00124         \textcolor{keywordflow}{for} ( \textcolor{keyword}{const} \textcolor{keyword}{auto} \&departing\_veh : dvs ) \{}
\DoxyCodeLine{00125             SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Scheduling DV with ID \{0\} ."{}}, departing\_veh.\_id);}
\DoxyCodeLine{00126             \textcolor{comment}{// get link lane info}}
\DoxyCodeLine{00127             \mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info}{OpenAPI::OAILanelet\_info}} lane\_info =  \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1vehicle__scheduler_af2c80eb87e5a9cabaad660544003663c}{get\_link\_lanelet\_info}}( departing\_veh );}
\DoxyCodeLine{00128             \textcolor{comment}{// calculate clearance time in milliseconds }}
\DoxyCodeLine{00129             uint64\_t clearance\_time = \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a15b4da36dba827263da4c844028c6db1}{estimate\_clearance\_time}}(departing\_veh, lane\_info);}
\DoxyCodeLine{00130 }
\DoxyCodeLine{00131             all\_stop\_vehicle\_schedule veh\_sched;}
\DoxyCodeLine{00132             \textcolor{comment}{// set id}}
\DoxyCodeLine{00133             veh\_sched.v\_id = departing\_veh.\_id;}
\DoxyCodeLine{00134             \textcolor{comment}{// set est }}
\DoxyCodeLine{00135             veh\_sched.est = departing\_veh.\_actual\_st;}
\DoxyCodeLine{00136             \textcolor{comment}{// set st}}
\DoxyCodeLine{00137             veh\_sched.st = departing\_veh.\_actual\_st;}
\DoxyCodeLine{00138             \textcolor{comment}{// set et}}
\DoxyCodeLine{00139             \textcolor{comment}{// if the vehicle is a previously granted access rdv but did not confirm it has received access and thus, doesn't have an actual et}}
\DoxyCodeLine{00140             \textcolor{keywordflow}{if} (\mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a35eb7b98052f4ef88850471478fcdddb}{is\_rdv\_previously\_granted\_access}}(departing\_veh))}
\DoxyCodeLine{00141             \{}
\DoxyCodeLine{00142                 veh\_sched.et =  schedule-\/>timestamp;}
\DoxyCodeLine{00143             \}}
\DoxyCodeLine{00144             \textcolor{comment}{// otherwise}}
\DoxyCodeLine{00145             \textcolor{keywordflow}{else}}
\DoxyCodeLine{00146             \{}
\DoxyCodeLine{00147                 veh\_sched.et =  departing\_veh.\_actual\_et;}
\DoxyCodeLine{00148             \}}
\DoxyCodeLine{00149             \textcolor{comment}{// departure time is equal to current time plus clearance time for DVs}}
\DoxyCodeLine{00150             veh\_sched.dt =  schedule-\/>timestamp + clearance\_time;}
\DoxyCodeLine{00151             \textcolor{comment}{// set departure position to departure position index}}
\DoxyCodeLine{00152             veh\_sched.dp = departure\_position\_index;}
\DoxyCodeLine{00153             \textcolor{comment}{// Increment index for next DV}}
\DoxyCodeLine{00154             departure\_position\_index++;}
\DoxyCodeLine{00155             \textcolor{comment}{// set state}}
\DoxyCodeLine{00156             veh\_sched.state = departing\_veh.\_cur\_state;}
\DoxyCodeLine{00157             \textcolor{comment}{// set vehicle link id}}
\DoxyCodeLine{00158             veh\_sched.link\_id =  departing\_veh.\_link\_id;}
\DoxyCodeLine{00159             \textcolor{comment}{// set vehicle entry lane id}}
\DoxyCodeLine{00160             veh\_sched.entry\_lane =  departing\_veh.\_entry\_lane\_id;}
\DoxyCodeLine{00161             \textcolor{comment}{// set access}}
\DoxyCodeLine{00162             veh\_sched.access =  \textcolor{keyword}{true};}
\DoxyCodeLine{00163             SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Added schedule for \{0\} with dt \{1\}."{}}, veh\_sched.v\_id, veh\_sched.dt);}
\DoxyCodeLine{00164             \textcolor{comment}{// add vehicle\_schedule}}
\DoxyCodeLine{00165             schedule-\/>vehicle\_schedules.push\_back(veh\_sched);}
\DoxyCodeLine{00166 }
\DoxyCodeLine{00167         \}}
\DoxyCodeLine{00168 }
\DoxyCodeLine{00169     \}}

\end{DoxyCode}


References \mbox{\hyperlink{all__stop__intersection__schedule_8h_source_l00056}{streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+schedule\+::access}}, \mbox{\hyperlink{vehicle__sorting_8cpp_source_l00004}{streets\+\_\+vehicle\+\_\+scheduler\+::departure\+\_\+position\+\_\+comparator()}}, \mbox{\hyperlink{all__stop__intersection__schedule_8h_source_l00052}{streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+schedule\+::dp}}, \mbox{\hyperlink{all__stop__intersection__schedule_8h_source_l00045}{streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+schedule\+::dt}}, \mbox{\hyperlink{intersection__schedule_8h_source_l00032}{streets\+\_\+vehicle\+\_\+scheduler\+::vehicle\+\_\+schedule\+::entry\+\_\+lane}}, \mbox{\hyperlink{all__stop__intersection__schedule_8h_source_l00029}{streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+schedule\+::est}}, \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00511}{estimate\+\_\+clearance\+\_\+time()}}, \mbox{\hyperlink{all__stop__intersection__schedule_8h_source_l00039}{streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+schedule\+::et}}, \mbox{\hyperlink{vehicle__scheduler_8cpp_source_l00031}{streets\+\_\+vehicle\+\_\+scheduler\+::vehicle\+\_\+scheduler\+::get\+\_\+link\+\_\+lanelet\+\_\+info()}}, \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00580}{is\+\_\+rdv\+\_\+previously\+\_\+granted\+\_\+access()}}, \mbox{\hyperlink{intersection__schedule_8h_source_l00036}{streets\+\_\+vehicle\+\_\+scheduler\+::vehicle\+\_\+schedule\+::link\+\_\+id}}, \mbox{\hyperlink{all__stop__intersection__schedule_8h_source_l00034}{streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+schedule\+::st}}, \mbox{\hyperlink{all__stop__intersection__schedule_8h_source_l00060}{streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+schedule\+::state}}, and \mbox{\hyperlink{intersection__schedule_8h_source_l00028}{streets\+\_\+vehicle\+\_\+scheduler\+::vehicle\+\_\+schedule\+::v\+\_\+id}}.



Referenced by \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00009}{schedule\+\_\+vehicles()}}.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a16230014f5d43ef2546a54496c08a9cd_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a16230014f5d43ef2546a54496c08a9cd_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_acd0ec98c5efc93aadb38563e3b98d1bb}\label{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_acd0ec98c5efc93aadb38563e3b98d1bb}} 
\index{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}!schedule\_evs@{schedule\_evs}}
\index{schedule\_evs@{schedule\_evs}!streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}}
\doxysubsubsection{\texorpdfstring{schedule\_evs()}{schedule\_evs()}}
{\footnotesize\ttfamily void streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+scheduler\+::schedule\+\_\+evs (\begin{DoxyParamCaption}\item[{std\+::list$<$ \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\+\_\+vehicles\+::vehicle}} $>$ \&}]{evs,  }\item[{const std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__intersection__schedule}{all\+\_\+stop\+\_\+intersection\+\_\+schedule}} $>$ \&}]{schedule }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [private]}}



Schedule all Entering Vehicles (EVs). Method first organizes all EVs into lists based on their entry lane. These list are order in ascending order with the vehicle closest to the intersection in a given lane being the first vehicle in that entry lanes vehicle list. Then stopping time (ST) for the unscheduled front EVs from every approach are calculated and the vehicle with the lowest (earliest) stopping times is scheduled. This is repeated until all evs from all approach lanelets are scheduled. 


\begin{DoxyParams}{Parameters}
{\em evs} & vector of unscheduled EVs. \\
\hline
{\em schedule} & \mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__intersection__schedule}{all\+\_\+stop\+\_\+intersection\+\_\+schedule}} to add EV scheduling information to. \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00230}{230}} of file \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source}{all\+\_\+stop\+\_\+vehicle\+\_\+scheduler.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00230                                                                                                                                                               \{}
\DoxyCodeLine{00231         \textcolor{comment}{// Map of entry lane ids to preceding already scheduled vehicle}}
\DoxyCodeLine{00232         std::unordered\_map<int , all\_stop\_vehicle\_schedule> preceding\_vehicle\_entry\_lane\_map;}
\DoxyCodeLine{00233         \textcolor{keywordflow}{for} ( \textcolor{keyword}{const} \textcolor{keyword}{auto} \&entry\_lane : \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1vehicle__scheduler_a5fa37276e5ccb41e38cbef573e830e8e}{intersection\_info}}-\/>getEntryLanelets() ) \{}
\DoxyCodeLine{00234             \textcolor{keywordtype}{int} lane\_id = entry\_lane.getId();}
\DoxyCodeLine{00235             all\_stop\_vehicle\_schedule preceding\_veh;}
\DoxyCodeLine{00236             \textcolor{comment}{// Only one RDV can exist for each approach}}
\DoxyCodeLine{00237             \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto} \&veh\_sched : schedule-\/>vehicle\_schedules ) \{}
\DoxyCodeLine{00238                 \textcolor{keywordflow}{if} ( veh\_sched.state == \mbox{\hyperlink{namespacestreets__vehicles_a41f5c896d8020c141aa96235cf1405acab08ef04fe84cf4f6645fef073717f36f}{streets\_vehicles::vehicle\_state::RDV}}) \{}
\DoxyCodeLine{00239                     \textcolor{comment}{// All RDVs}}
\DoxyCodeLine{00240                     preceding\_veh = veh\_sched;}
\DoxyCodeLine{00241                     preceding\_vehicle\_entry\_lane\_map.try\_emplace(lane\_id, preceding\_veh);  }
\DoxyCodeLine{00242 }
\DoxyCodeLine{00243                 \}}
\DoxyCodeLine{00244                 \textcolor{comment}{// Consider vehicles recently granted access}}
\DoxyCodeLine{00245                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( veh\_sched.state == \mbox{\hyperlink{namespacestreets__vehicles_a41f5c896d8020c141aa96235cf1405aca58d6a88f13e2db7f5059c41047876f00}{streets\_vehicles::vehicle\_state::DV}} \&\& (veh\_sched.et-\/schedule-\/>timestamp) <= \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a13124a205e1c6615f6a137c507b2a4eb}{entering\_time\_buffer}}) \{}
\DoxyCodeLine{00246                     SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Considering DV \{0\} as still in entry since entering time \{1\} -\/ timestamp \{2\} does not exceed buffer \{3\}"{}},}
\DoxyCodeLine{00247                             veh\_sched.v\_id, veh\_sched.et, schedule-\/>timestamp, \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a13124a205e1c6615f6a137c507b2a4eb}{entering\_time\_buffer}});}
\DoxyCodeLine{00248                     preceding\_veh = veh\_sched;}
\DoxyCodeLine{00249                     preceding\_vehicle\_entry\_lane\_map.try\_emplace(lane\_id, preceding\_veh);}
\DoxyCodeLine{00250                 \}}
\DoxyCodeLine{00251             \}}
\DoxyCodeLine{00252         \}}
\DoxyCodeLine{00253 }
\DoxyCodeLine{00254         \textcolor{comment}{// Sort vehicles based on distance}}
\DoxyCodeLine{00255         evs.sort(\mbox{\hyperlink{namespacestreets__vehicle__scheduler_ab550673e6a269f9f374ca3ca7ff6ba82}{distance\_comparator}});}
\DoxyCodeLine{00256         }
\DoxyCodeLine{00257         \textcolor{comment}{// Create a map of entry lane id keys and list of vehicle to be scheduled next in each lane.}}
\DoxyCodeLine{00258         std::unordered\_map<int, std::list<streets\_vehicles::vehicle>> vehicle\_to\_be\_scheduled\_next;}
\DoxyCodeLine{00259         \textcolor{keywordflow}{for} ( \textcolor{keyword}{const} \textcolor{keyword}{auto} \&entry\_lane : \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1vehicle__scheduler_a5fa37276e5ccb41e38cbef573e830e8e}{intersection\_info}}-\/>getEntryLanelets() ) \{}
\DoxyCodeLine{00260             std::list<streets\_vehicles::vehicle> vehicles\_in\_lane;}
\DoxyCodeLine{00261             \textcolor{keywordflow}{for} ( \textcolor{keyword}{const} \textcolor{keyword}{auto} \&ev : evs ) \{}
\DoxyCodeLine{00262                 \textcolor{keywordflow}{if} ( ev.\_entry\_lane\_id == entry\_lane.getId()) \{}
\DoxyCodeLine{00263                     SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Adding vehicle \{0\} to EVs list in entry lane \{1\}"{}}, ev.\_id, ev.\_entry\_lane\_id);}
\DoxyCodeLine{00264                     vehicles\_in\_lane.push\_back(ev);}
\DoxyCodeLine{00265                 \}}
\DoxyCodeLine{00266             \}}
\DoxyCodeLine{00267             \textcolor{keywordflow}{if} ( !vehicles\_in\_lane.empty())}
\DoxyCodeLine{00268                 vehicle\_to\_be\_scheduled\_next.try\_emplace( entry\_lane.getId(), vehicles\_in\_lane );}
\DoxyCodeLine{00269             \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00270                 SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}No EVs in lane \{0\}."{}},\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(entry\_lane.getId()) );}
\DoxyCodeLine{00271             \}}
\DoxyCodeLine{00272         \}}
\DoxyCodeLine{00273         \textcolor{keywordflow}{if} ( !vehicle\_to\_be\_scheduled\_next.empty()) \{}
\DoxyCodeLine{00274             \textcolor{keywordflow}{for} ( \textcolor{keyword}{const} \textcolor{keyword}{auto} \&[entry\_lane, next\_veh] : vehicle\_to\_be\_scheduled\_next ) \{}
\DoxyCodeLine{00275                 SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Next Vehicle \{0\} to be scheduled in lane \{1\}"{}},next\_veh.front().\_id, entry\_lane);}
\DoxyCodeLine{00276             \}}
\DoxyCodeLine{00277         \}}
\DoxyCodeLine{00278         \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00279             \textcolor{keywordflow}{throw} scheduling\_exception(\textcolor{stringliteral}{"{}Map of vehicles to be scheduled is empty but list of EVs to be scheduled is not!"{}});}
\DoxyCodeLine{00280         \}}
\DoxyCodeLine{00281         \textcolor{comment}{// Get next available departure index, default to 1 if schedule is empty}}
\DoxyCodeLine{00282         \textcolor{keywordtype}{int} last\_departure\_index = 1;}
\DoxyCodeLine{00283         \textcolor{keywordflow}{if} ( !schedule-\/>vehicle\_schedules.empty()) \{}
\DoxyCodeLine{00284             last\_departure\_index =  schedule-\/>vehicle\_schedules.back().dp + 1;}
\DoxyCodeLine{00285         \}}
\DoxyCodeLine{00286         \textcolor{keywordflow}{do} \{}
\DoxyCodeLine{00287             all\_stop\_vehicle\_schedule sched;}
\DoxyCodeLine{00288             \textcolor{comment}{// Calculate ST for each next vehicle in each lane and schedule the vehicle with the lowest ST}}
\DoxyCodeLine{00289             uint64\_t lowest\_st = 0;}
\DoxyCodeLine{00290 }
\DoxyCodeLine{00291             \textcolor{comment}{// Populate Map}}
\DoxyCodeLine{00292             \textcolor{comment}{// Find next vehicle for each entry lanelet}}
\DoxyCodeLine{00293             \textcolor{keywordflow}{for} ( \textcolor{keyword}{const} \textcolor{keyword}{auto} \&[entry\_lane, evs\_in\_lane] : vehicle\_to\_be\_scheduled\_next ) \{}
\DoxyCodeLine{00294                 \textcolor{comment}{// Take first vehicle to be scheduled in lane.}}
\DoxyCodeLine{00295                 \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\_vehicles::vehicle}} ev = evs\_in\_lane.front();}
\DoxyCodeLine{00296                 SPDLOG\_DEBUG( \textcolor{stringliteral}{"{}Estimating schedule for \{0\}."{}}, ev.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a470605f661a8f625329ebbb10888e2b8}{\_id}});}
\DoxyCodeLine{00297 }
\DoxyCodeLine{00298                 \textcolor{comment}{// Get link lanelet information for ev}}
\DoxyCodeLine{00299                 \mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info}{OpenAPI::OAILanelet\_info}} link\_lane = \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1vehicle__scheduler_af2c80eb87e5a9cabaad660544003663c}{get\_link\_lanelet\_info}}( ev );}
\DoxyCodeLine{00300                 SPDLOG\_DEBUG( \textcolor{stringliteral}{"{}Link lanelet for \{0\} is \{1\}."{}}, ev.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a470605f661a8f625329ebbb10888e2b8}{\_id}}, link\_lane.\mbox{\hyperlink{classOpenAPI_1_1OAILanelet__info_a489d1a475686159298697bccabd2bd52}{getId}}());}
\DoxyCodeLine{00301                 \textcolor{comment}{// Calculate EST for vehicle}}
\DoxyCodeLine{00302                 uint64\_t est = \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_ad5f0462b2d82168b7b71dcfd15eaa7f2}{estimate\_earliest\_time\_to\_stop\_bar}}(ev);}
\DoxyCodeLine{00303                 SPDLOG\_DEBUG( \textcolor{stringliteral}{"{}EST for vehicle \{0\} is \{1\}."{}} ,ev.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a470605f661a8f625329ebbb10888e2b8}{\_id}}, est ) ;}
\DoxyCodeLine{00304                 \textcolor{comment}{// Store ST value for vehicle}}
\DoxyCodeLine{00305                 uint64\_t st;}
\DoxyCodeLine{00306 }
\DoxyCodeLine{00307 }
\DoxyCodeLine{00308                 \textcolor{comment}{// If there is a preceding vehicle scheduled in this lane}}
\DoxyCodeLine{00309                 \textcolor{keywordflow}{if} ( preceding\_vehicle\_entry\_lane\_map.find( ev.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_adc3dab0260f149fc908b9b7d49e1ba99}{\_cur\_lane\_id}} )  != preceding\_vehicle\_entry\_lane\_map.end() ) \{}
\DoxyCodeLine{00310                     \textcolor{comment}{// Get preceding vehicle in lane}}
\DoxyCodeLine{00311                     all\_stop\_vehicle\_schedule preceding\_veh = preceding\_vehicle\_entry\_lane\_map.find( ev.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_adc3dab0260f149fc908b9b7d49e1ba99}{\_cur\_lane\_id}} )-\/>second;}
\DoxyCodeLine{00312                     SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Preceding vehicle schedule in lane \{0\} is \{1\}."{}}, preceding\_veh.entry\_lane, preceding\_veh.v\_id);}
\DoxyCodeLine{00313                     \textcolor{comment}{// If there is a preceding vehicle the st is calculated as max of EST and preceding vehicle ET plus a time}}
\DoxyCodeLine{00314                     \textcolor{comment}{// buffer to account for the time it takes the preceding vehicle to enter the intersection}}
\DoxyCodeLine{00315                     SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Preceding vehicle et \{0\}"{}}, preceding\_veh.et);}
\DoxyCodeLine{00316                     st =  std::max( est, preceding\_veh.et + \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a13124a205e1c6615f6a137c507b2a4eb}{entering\_time\_buffer}} );}
\DoxyCodeLine{00317                     SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Setting st for vehicle \{0\} to max of \{1\} , \{2\}."{}}, ev.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a470605f661a8f625329ebbb10888e2b8}{\_id}}, est, preceding\_veh.et + \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a13124a205e1c6615f6a137c507b2a4eb}{entering\_time\_buffer}});}
\DoxyCodeLine{00318 }
\DoxyCodeLine{00319                 \}}
\DoxyCodeLine{00320                 \textcolor{comment}{// IF there is no preceding vehicle ST == EST}}
\DoxyCodeLine{00321                 \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00322                     SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}No proceeding vehicle for \{0\}"{}}, ev.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a470605f661a8f625329ebbb10888e2b8}{\_id}});}
\DoxyCodeLine{00323                     st = est;}
\DoxyCodeLine{00324                 \}}
\DoxyCodeLine{00325                 \textcolor{comment}{// If lowest st has not been set yet. This is currently the lowest st}}
\DoxyCodeLine{00326                 \textcolor{keywordflow}{if} ( lowest\_st == 0 || lowest\_st > st ) \{}
\DoxyCodeLine{00327                     lowest\_st = st;}
\DoxyCodeLine{00328                     \textcolor{comment}{// Set schedule properties}}
\DoxyCodeLine{00329                     sched.v\_id =  ev.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a470605f661a8f625329ebbb10888e2b8}{\_id}};}
\DoxyCodeLine{00330                     sched.est = est;}
\DoxyCodeLine{00331                     sched.st = st;}
\DoxyCodeLine{00332                     sched.entry\_lane =  ev.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a4ef0e2e811b0f5cb00f14b89a353c3b5}{\_entry\_lane\_id}};}
\DoxyCodeLine{00333                     sched.link\_id = ev.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_aaa9cbe97b2343b3f14841c1ed2bc8e3d}{\_link\_id}};}
\DoxyCodeLine{00334                     sched.state = \mbox{\hyperlink{namespacestreets__vehicles_a41f5c896d8020c141aa96235cf1405aca834d41112f2943c357f660165b6eb6de}{streets\_vehicles::vehicle\_state::EV}};}
\DoxyCodeLine{00335                     sched.access = \textcolor{keyword}{false};}
\DoxyCodeLine{00336                     sched.dp = last\_departure\_index;}
\DoxyCodeLine{00337                     sched.et = \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a9b5ee4ffdbd82cbf0c48f7981e7dff9c}{estimate\_entering\_time\_for\_ev}}(schedule-\/>vehicle\_schedules, ev, st);}
\DoxyCodeLine{00338                     \textcolor{comment}{// Departure time is equal to entering time + clearance time}}
\DoxyCodeLine{00339                     sched.dt = sched.et + \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a15b4da36dba827263da4c844028c6db1}{estimate\_clearance\_time}}( ev, link\_lane );}
\DoxyCodeLine{00340             }
\DoxyCodeLine{00341                 \}}
\DoxyCodeLine{00342                }
\DoxyCodeLine{00343             \}}
\DoxyCodeLine{00344             SPDLOG\_DEBUG( \textcolor{stringliteral}{"{}Found vehicle \{0\} with lowest stopping time \{1\} in lane \{2\}"{}}, sched.v\_id, sched.st, sched.entry\_lane);}
\DoxyCodeLine{00345             \textcolor{comment}{// Add lowest ST to schedule}}
\DoxyCodeLine{00346             schedule-\/>vehicle\_schedules.push\_back(sched);}
\DoxyCodeLine{00347             \textcolor{comment}{// Increment departure index}}
\DoxyCodeLine{00348             last\_departure\_index++;}
\DoxyCodeLine{00349             \textcolor{comment}{// Replace previous preceeding vehicle for lane with scheduled vehicle}}
\DoxyCodeLine{00350             \textcolor{keywordflow}{if} ( preceding\_vehicle\_entry\_lane\_map.find(sched.entry\_lane) != preceding\_vehicle\_entry\_lane\_map.end()) \{}
\DoxyCodeLine{00351                 preceding\_vehicle\_entry\_lane\_map.find(sched.entry\_lane)-\/>second =  sched;}
\DoxyCodeLine{00352             \}}
\DoxyCodeLine{00353             \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00354                 preceding\_vehicle\_entry\_lane\_map.try\_emplace(sched.entry\_lane, sched);}
\DoxyCodeLine{00355             \}}
\DoxyCodeLine{00356             \textcolor{comment}{// Pop vehicle off of list of vehicles to be scheduled for each lane}}
\DoxyCodeLine{00357             vehicle\_to\_be\_scheduled\_next.find(sched.entry\_lane)-\/>second.pop\_front();}
\DoxyCodeLine{00358             \textcolor{comment}{// If pop makes list empty remove map entry}}
\DoxyCodeLine{00359             \textcolor{keywordflow}{if} ( vehicle\_to\_be\_scheduled\_next.find(sched.entry\_lane)-\/>second.empty() ) \{}
\DoxyCodeLine{00360                 SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}All vehicles in approach lanelet \{0\} have been scheduled!"{}}, sched.entry\_lane);}
\DoxyCodeLine{00361                 vehicle\_to\_be\_scheduled\_next.erase(sched.entry\_lane);}
\DoxyCodeLine{00362             \}}
\DoxyCodeLine{00363             }
\DoxyCodeLine{00364         \}}
\DoxyCodeLine{00365         \textcolor{keywordflow}{while} ( !vehicle\_to\_be\_scheduled\_next.empty() );}
\DoxyCodeLine{00366     \}}

\end{DoxyCode}


References \mbox{\hyperlink{vehicle_8h_source_l00049}{streets\+\_\+vehicles\+::vehicle\+::\+\_\+cur\+\_\+lane\+\_\+id}}, \mbox{\hyperlink{vehicle_8h_source_l00051}{streets\+\_\+vehicles\+::vehicle\+::\+\_\+entry\+\_\+lane\+\_\+id}}, \mbox{\hyperlink{vehicle_8h_source_l00037}{streets\+\_\+vehicles\+::vehicle\+::\+\_\+id}}, \mbox{\hyperlink{vehicle_8h_source_l00055}{streets\+\_\+vehicles\+::vehicle\+::\+\_\+link\+\_\+id}}, \mbox{\hyperlink{all__stop__intersection__schedule_8h_source_l00056}{streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+schedule\+::access}}, \mbox{\hyperlink{vehicle__sorting_8cpp_source_l00029}{streets\+\_\+vehicle\+\_\+scheduler\+::distance\+\_\+comparator()}}, \mbox{\hyperlink{all__stop__intersection__schedule_8h_source_l00052}{streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+schedule\+::dp}}, \mbox{\hyperlink{all__stop__intersection__schedule_8h_source_l00045}{streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+schedule\+::dt}}, \mbox{\hyperlink{namespacestreets__vehicles_a41f5c896d8020c141aa96235cf1405aca58d6a88f13e2db7f5059c41047876f00}{streets\+\_\+vehicles\+::\+DV}}, \mbox{\hyperlink{all__stop__vehicle__scheduler_8h_source_l00032}{entering\+\_\+time\+\_\+buffer}}, \mbox{\hyperlink{intersection__schedule_8h_source_l00032}{streets\+\_\+vehicle\+\_\+scheduler\+::vehicle\+\_\+schedule\+::entry\+\_\+lane}}, \mbox{\hyperlink{all__stop__intersection__schedule_8h_source_l00029}{streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+schedule\+::est}}, \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00511}{estimate\+\_\+clearance\+\_\+time()}}, \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00390}{estimate\+\_\+earliest\+\_\+time\+\_\+to\+\_\+stop\+\_\+bar()}}, \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00368}{estimate\+\_\+entering\+\_\+time\+\_\+for\+\_\+ev()}}, \mbox{\hyperlink{all__stop__intersection__schedule_8h_source_l00039}{streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+schedule\+::et}}, \mbox{\hyperlink{namespacestreets__vehicles_a41f5c896d8020c141aa96235cf1405aca834d41112f2943c357f660165b6eb6de}{streets\+\_\+vehicles\+::\+EV}}, \mbox{\hyperlink{vehicle__scheduler_8cpp_source_l00031}{streets\+\_\+vehicle\+\_\+scheduler\+::vehicle\+\_\+scheduler\+::get\+\_\+link\+\_\+lanelet\+\_\+info()}}, \mbox{\hyperlink{intersection__client__api_2OAILanelet__info_8cpp_source_l00121}{Open\+API\+::\+OAILanelet\+\_\+info\+::get\+Id()}}, \mbox{\hyperlink{vehicle__scheduler_8h_source_l00026}{streets\+\_\+vehicle\+\_\+scheduler\+::vehicle\+\_\+scheduler\+::intersection\+\_\+info}}, \mbox{\hyperlink{intersection__schedule_8h_source_l00036}{streets\+\_\+vehicle\+\_\+scheduler\+::vehicle\+\_\+schedule\+::link\+\_\+id}}, \mbox{\hyperlink{namespacestreets__vehicles_a41f5c896d8020c141aa96235cf1405acab08ef04fe84cf4f6645fef073717f36f}{streets\+\_\+vehicles\+::\+RDV}}, \mbox{\hyperlink{all__stop__intersection__schedule_8h_source_l00034}{streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+schedule\+::st}}, \mbox{\hyperlink{all__stop__intersection__schedule_8h_source_l00060}{streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+schedule\+::state}}, and \mbox{\hyperlink{intersection__schedule_8h_source_l00028}{streets\+\_\+vehicle\+\_\+scheduler\+::vehicle\+\_\+schedule\+::v\+\_\+id}}.



Referenced by \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00009}{schedule\+\_\+vehicles()}}.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_acd0ec98c5efc93aadb38563e3b98d1bb_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_acd0ec98c5efc93aadb38563e3b98d1bb_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a0729a968f0b8f0b0ec11453157df101c}\label{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a0729a968f0b8f0b0ec11453157df101c}} 
\index{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}!schedule\_rdvs@{schedule\_rdvs}}
\index{schedule\_rdvs@{schedule\_rdvs}!streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}}
\doxysubsubsection{\texorpdfstring{schedule\_rdvs()}{schedule\_rdvs()}}
{\footnotesize\ttfamily void streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+scheduler\+::schedule\+\_\+rdvs (\begin{DoxyParamCaption}\item[{std\+::list$<$ \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\+\_\+vehicles\+::vehicle}} $>$ \&}]{rdvs,  }\item[{const std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__intersection__schedule}{all\+\_\+stop\+\_\+intersection\+\_\+schedule}} $>$ \&}]{schedule }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Schedule all currently Ready to Depart Vehicles (RDVs). Consider all possible RDV departure orders. Select the one with the least calculated delay. Delay for a given vehicle is the difference between Entering Time and Stopping Time. Method assumes \mbox{\hyperlink{structstreets__vehicle__scheduler_1_1intersection__schedule}{intersection\+\_\+schedule}} only populated with DV(s) vehicle\+\_\+schedules. Method will add vehicle\+\_\+schedule(s) for each RDV in vector. 


\begin{DoxyParams}{Parameters}
{\em rdvs} & vector of unscheduled RDVs \\
\hline
{\em schedule} & \mbox{\hyperlink{structstreets__vehicle__scheduler_1_1all__stop__intersection__schedule}{all\+\_\+stop\+\_\+intersection\+\_\+schedule}} to add RDV scheduling information to. \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00171}{171}} of file \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source}{all\+\_\+stop\+\_\+vehicle\+\_\+scheduler.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00171                                                                                                                                                           \{}
\DoxyCodeLine{00172         \textcolor{comment}{// Vector of considered intersection\_schedule\_options}}
\DoxyCodeLine{00173         std::vector<std::shared\_ptr<all\_stop\_intersection\_schedule>> schedule\_options;}
\DoxyCodeLine{00174         \textcolor{comment}{// Sort rdvs ascending order based on departure position}}
\DoxyCodeLine{00175         rdvs.sort(\mbox{\hyperlink{namespacestreets__vehicle__scheduler_aa9f946d7c588b2697fd379fbed72f382}{departure\_position\_comparator}});}
\DoxyCodeLine{00176         \textcolor{comment}{// Earliest possible departure position for RDVs is last scheduled DV departure position +1 }}
\DoxyCodeLine{00177         \textcolor{keywordtype}{int} starting\_departure\_position;}
\DoxyCodeLine{00178         \textcolor{keywordflow}{if} ( !schedule-\/>vehicle\_schedules.empty() ) \{}
\DoxyCodeLine{00179             starting\_departure\_position = schedule-\/>vehicle\_schedules.back().dp +1;}
\DoxyCodeLine{00180         \}}
\DoxyCodeLine{00181         \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00182             \textcolor{comment}{// If no scheduled DVs, first available departure position is 1}}
\DoxyCodeLine{00183             starting\_departure\_position =  1;}
\DoxyCodeLine{00184         \}}
\DoxyCodeLine{00185         SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Staring the schedule RDVs from departure index \{0\}!"{}}, starting\_departure\_position );}
\DoxyCodeLine{00186         \textcolor{comment}{// TODO: for 8 possible approaches this may need to be optimized (greedy search)}}
\DoxyCodeLine{00187         \textcolor{keywordflow}{do} \{ }
\DoxyCodeLine{00188             SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Considering scheduling options with \{0\} as first RDV."{}} ,rdvs.front().\_id);}
\DoxyCodeLine{00189             \textcolor{comment}{// update schedule option to include already scheduled vehicles}}
\DoxyCodeLine{00190             \textcolor{keyword}{auto} option = std::make\_shared<all\_stop\_intersection\_schedule> (*schedule);}
\DoxyCodeLine{00191             \textcolor{comment}{// consider current permutation of RDV departure order}}
\DoxyCodeLine{00192             \textcolor{keywordtype}{bool} valid\_option =  \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a77c415e3ef29a00acc67c7aac87a270b}{consider\_departure\_position\_permutation}}(rdvs, option, starting\_departure\_position);}
\DoxyCodeLine{00193             SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Scheduling option is valid : \{0\}."{}}, valid\_option);}
\DoxyCodeLine{00194             \textcolor{comment}{// is permutation valid in terms of flexibility limit? Has any vehicle's departure index changed by more}}
\DoxyCodeLine{00195             \textcolor{comment}{// than the current flexibility limit.}}
\DoxyCodeLine{00196             \textcolor{keywordflow}{if} ( valid\_option ) \{}
\DoxyCodeLine{00197                 schedule\_options.push\_back(option);}
\DoxyCodeLine{00198             \}}
\DoxyCodeLine{00199 }
\DoxyCodeLine{00200         \}}
\DoxyCodeLine{00201         \textcolor{keywordflow}{while} (std::next\_permutation( rdvs.begin(), rdvs.end(), \mbox{\hyperlink{namespacestreets__vehicle__scheduler_aa9f946d7c588b2697fd379fbed72f382}{departure\_position\_comparator}}));}
\DoxyCodeLine{00202         \textcolor{comment}{// If no valid options were added.}}
\DoxyCodeLine{00203         \textcolor{keywordflow}{if} ( schedule\_options.empty()) \{}
\DoxyCodeLine{00204             \textcolor{keywordflow}{throw} scheduling\_exception(\textcolor{stringliteral}{"{}There are no valid schedules for RDVs! Please check flexibility\_limit setting."{}});}
\DoxyCodeLine{00205         \}}
\DoxyCodeLine{00206         \textcolor{comment}{// Sort in ascending order based on delay.}}
\DoxyCodeLine{00207         std::sort(schedule\_options.begin(), schedule\_options.end(), \mbox{\hyperlink{namespacestreets__vehicle__scheduler_ab6598f6bcdf2edaadecc3f4b68debb66}{delay\_comparator}});}
\DoxyCodeLine{00208 }
\DoxyCodeLine{00209         SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}All all scheduling options, the option with RDV \{0\} first has the least delay of \{1\}."{}},}
\DoxyCodeLine{00210                                 schedule\_options.front()-\/>vehicle\_schedules[starting\_departure\_position-\/1].v\_id,}
\DoxyCodeLine{00211                                 schedule\_options.front()-\/>get\_delay());}
\DoxyCodeLine{00212        }
\DoxyCodeLine{00213         \textcolor{comment}{// Add scheduled RDVs starting at last scheduled DV position to schedule}}
\DoxyCodeLine{00214         \textcolor{keywordflow}{for} ( \textcolor{keyword}{const} \textcolor{keyword}{auto} \&sched : schedule\_options.front()-\/>vehicle\_schedules)\{}
\DoxyCodeLine{00215             \textcolor{comment}{// starting at first available departure position for dvs, add rdvs from best option to current schedule}}
\DoxyCodeLine{00216             \textcolor{keywordflow}{if} (starting\_departure\_position <= sched.dp ) \{}
\DoxyCodeLine{00217                 \textcolor{comment}{// if rdv was granted access in this schedule add it to the list of RDVs granted access}}
\DoxyCodeLine{00218                 \textcolor{keywordflow}{if} ( sched.access ) \{}
\DoxyCodeLine{00219                         \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\_vehicles::vehicle}} rdv\_granted\_access = \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a0cf6941cc406bbd51889c129231e9443}{get\_vehicle\_with\_id}}( rdvs, sched.v\_id );}
\DoxyCodeLine{00220                         SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Added RDV \{0\} to list of RDVs previously granted access."{}}, rdv\_granted\_access.\mbox{\hyperlink{structstreets__vehicles_1_1vehicle_a470605f661a8f625329ebbb10888e2b8}{\_id}});}
\DoxyCodeLine{00221                         \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a77c53828e29e53a9a7ff752afb65b549}{rdvs\_previously\_granted\_access}}.push\_back(rdv\_granted\_access);}
\DoxyCodeLine{00222                 \}}
\DoxyCodeLine{00223                 schedule-\/>vehicle\_schedules.push\_back( sched );}
\DoxyCodeLine{00224                 starting\_departure\_position ++;}
\DoxyCodeLine{00225             \}}
\DoxyCodeLine{00226         \}}
\DoxyCodeLine{00227         SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Schedule for RDVs: \(\backslash\)n"{}} + schedule-\/>toCSV());}
\DoxyCodeLine{00228     \}}

\end{DoxyCode}


References \mbox{\hyperlink{vehicle_8h_source_l00037}{streets\+\_\+vehicles\+::vehicle\+::\+\_\+id}}, \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00432}{consider\+\_\+departure\+\_\+position\+\_\+permutation()}}, \mbox{\hyperlink{vehicle__sorting_8cpp_source_l00033}{streets\+\_\+vehicle\+\_\+scheduler\+::delay\+\_\+comparator()}}, \mbox{\hyperlink{vehicle__sorting_8cpp_source_l00004}{streets\+\_\+vehicle\+\_\+scheduler\+::departure\+\_\+position\+\_\+comparator()}}, \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00595}{get\+\_\+vehicle\+\_\+with\+\_\+id()}}, and \mbox{\hyperlink{all__stop__vehicle__scheduler_8h_source_l00027}{rdvs\+\_\+previously\+\_\+granted\+\_\+access}}.



Referenced by \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00009}{schedule\+\_\+vehicles()}}.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a0729a968f0b8f0b0ec11453157df101c_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a0729a968f0b8f0b0ec11453157df101c_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a930961b3e285b2a2d08f4276ffa22658}\label{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a930961b3e285b2a2d08f4276ffa22658}} 
\index{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}!schedule\_vehicles@{schedule\_vehicles}}
\index{schedule\_vehicles@{schedule\_vehicles}!streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}}
\doxysubsubsection{\texorpdfstring{schedule\_vehicles()}{schedule\_vehicles()}}
{\footnotesize\ttfamily void streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+scheduler\+::schedule\+\_\+vehicles (\begin{DoxyParamCaption}\item[{std\+::unordered\+\_\+map$<$ std\+::string, \mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\+\_\+vehicles\+::vehicle}} $>$ \&}]{vehicles,  }\item[{std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{structstreets__vehicle__scheduler_1_1intersection__schedule}{intersection\+\_\+schedule}} $>$ \&}]{schedule }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Method to schedule vehicles. Given and empty \mbox{\hyperlink{structstreets__vehicle__scheduler_1_1intersection__schedule}{intersection\+\_\+schedule}} object and a map of vehicles and vehicle ids. This method will populate the intersection schedule with a schedule for each EV,RDV and DV in the vehicle map based on UC 1 scheduling logic to minimize delay for a all way stop intersection. 


\begin{DoxyParams}{Parameters}
{\em vehicles} & A map of the vehicles to schedule, with vehicle id as keys \\
\hline
{\em schedule} & An all\+\_\+stop\+\_\+intersection schedule object populated with a vehicle schedule for each EV,RDV and DV in the map. \\
\hline
\end{DoxyParams}


Implements \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1vehicle__scheduler_a68ae44ddfa8ae16f298b2798ed93b9d2}{streets\+\_\+vehicle\+\_\+scheduler\+::vehicle\+\_\+scheduler}}.



Definition at line \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00009}{9}} of file \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source}{all\+\_\+stop\+\_\+vehicle\+\_\+scheduler.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00010                                                                                                            \{}
\DoxyCodeLine{00011         }
\DoxyCodeLine{00012         \textcolor{keywordflow}{try} }
\DoxyCodeLine{00013         \{}
\DoxyCodeLine{00014             \textcolor{keyword}{auto} schedule = std::dynamic\_pointer\_cast<all\_stop\_intersection\_schedule> (i\_sched);}
\DoxyCodeLine{00015 }
\DoxyCodeLine{00016             \textcolor{keywordflow}{if} ( vehicles.empty() ) \{}
\DoxyCodeLine{00017                 SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}No vehicles to schedule."{}});}
\DoxyCodeLine{00018                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{00019             \}}
\DoxyCodeLine{00020             \textcolor{comment}{// Estimate Vehicles at common time }}
\DoxyCodeLine{00021             \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1vehicle__scheduler_a85947f43b293504a108619374c0c0dae}{estimate\_vehicles\_at\_common\_time}}( vehicles, schedule-\/>timestamp);}
\DoxyCodeLine{00022             \textcolor{comment}{// Create vectors of EVs RDVs and DVs}}
\DoxyCodeLine{00023             std::list<streets\_vehicles::vehicle> DVs;}
\DoxyCodeLine{00024             std::list<streets\_vehicles::vehicle> RDVs;}
\DoxyCodeLine{00025 }
\DoxyCodeLine{00026             std::list<streets\_vehicles::vehicle> EVs;}
\DoxyCodeLine{00027             \textcolor{keywordflow}{for} ( \textcolor{keyword}{const} \textcolor{keyword}{auto} \&[v\_id, veh] : vehicles) \{}
\DoxyCodeLine{00028                 \textcolor{keywordflow}{if} ( veh.\_cur\_state == \mbox{\hyperlink{namespacestreets__vehicles_a41f5c896d8020c141aa96235cf1405aca58d6a88f13e2db7f5059c41047876f00}{streets\_vehicles::vehicle\_state::DV}} ) \{}
\DoxyCodeLine{00029                     \textcolor{comment}{// Once vehicle is considered as DV it has confirmed that it has received access.}}
\DoxyCodeLine{00030                     \textcolor{keywordflow}{if} ( \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a35eb7b98052f4ef88850471478fcdddb}{is\_rdv\_previously\_granted\_access}}(veh) ) \{}
\DoxyCodeLine{00031                         \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a223e57041ae7ca6c4810877c8c74a49e}{remove\_rdv\_previously\_granted\_access}}(veh);}
\DoxyCodeLine{00032                     \}}
\DoxyCodeLine{00033                     DVs.push\_back(veh);}
\DoxyCodeLine{00034                 \}}
\DoxyCodeLine{00035                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( veh.\_cur\_state == \mbox{\hyperlink{namespacestreets__vehicles_a41f5c896d8020c141aa96235cf1405acab08ef04fe84cf4f6645fef073717f36f}{streets\_vehicles::vehicle\_state::RDV}} ) \{}
\DoxyCodeLine{00036                     \textcolor{comment}{// Consider any RDVs previously granted access as a DV}}
\DoxyCodeLine{00037                     \textcolor{keywordflow}{if} ( \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a35eb7b98052f4ef88850471478fcdddb}{is\_rdv\_previously\_granted\_access}}(veh) ) \{}
\DoxyCodeLine{00038                         DVs.push\_back(veh);}
\DoxyCodeLine{00039                     \} }
\DoxyCodeLine{00040                     \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00041                         RDVs.push\_back(veh);}
\DoxyCodeLine{00042                     \}}
\DoxyCodeLine{00043                 \}}
\DoxyCodeLine{00044                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( veh.\_cur\_state == \mbox{\hyperlink{namespacestreets__vehicles_a41f5c896d8020c141aa96235cf1405aca834d41112f2943c357f660165b6eb6de}{streets\_vehicles::vehicle\_state::EV}}) \{}
\DoxyCodeLine{00045                     EVs.push\_back(veh);}
\DoxyCodeLine{00046                 \}}
\DoxyCodeLine{00047             \}}
\DoxyCodeLine{00048             }
\DoxyCodeLine{00049             SPDLOG\_DEBUG(\textcolor{stringliteral}{"{}Vehicles to schedule are DVs : \{0\}, RDVs : \{1\}, EVs \{2\} "{}}, DVs.size(), RDVs.size(), EVs.size());}
\DoxyCodeLine{00050 }
\DoxyCodeLine{00051             \textcolor{comment}{// Schedule DVs}}
\DoxyCodeLine{00052             \textcolor{keywordflow}{if} ( !DVs.empty() )}
\DoxyCodeLine{00053                 \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a16230014f5d43ef2546a54496c08a9cd}{schedule\_dvs}}( DVs, schedule);}
\DoxyCodeLine{00054             \textcolor{comment}{// Schedule RDVs}}
\DoxyCodeLine{00055             \textcolor{keywordflow}{if} ( !RDVs.empty() )}
\DoxyCodeLine{00056                 \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a0729a968f0b8f0b0ec11453157df101c}{schedule\_rdvs}}( RDVs, schedule);}
\DoxyCodeLine{00057             \textcolor{comment}{// Schedule EVs}}
\DoxyCodeLine{00058             \textcolor{keywordflow}{if} ( !EVs.empty() )}
\DoxyCodeLine{00059                 \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_acd0ec98c5efc93aadb38563e3b98d1bb}{schedule\_evs}}( EVs, schedule);}
\DoxyCodeLine{00060         }
\DoxyCodeLine{00061         \}}
\DoxyCodeLine{00062         \textcolor{keywordflow}{catch} ( \textcolor{keyword}{const} \mbox{\hyperlink{classstreets__service_1_1streets__configuration__exception}{streets\_service::streets\_configuration\_exception}} \&ex ) \{}
\DoxyCodeLine{00063             SPDLOG\_ERROR(\textcolor{stringliteral}{"{}all stop scheduler failure: \{0\} "{}}, ex.what());}
\DoxyCodeLine{00064         \}}
\DoxyCodeLine{00065 }
\DoxyCodeLine{00066     \}}

\end{DoxyCode}


References \mbox{\hyperlink{namespacestreets__vehicles_a41f5c896d8020c141aa96235cf1405aca58d6a88f13e2db7f5059c41047876f00}{streets\+\_\+vehicles\+::\+DV}}, \mbox{\hyperlink{vehicle__scheduler_8cpp_source_l00049}{streets\+\_\+vehicle\+\_\+scheduler\+::vehicle\+\_\+scheduler\+::estimate\+\_\+vehicles\+\_\+at\+\_\+common\+\_\+time()}}, \mbox{\hyperlink{namespacestreets__vehicles_a41f5c896d8020c141aa96235cf1405aca834d41112f2943c357f660165b6eb6de}{streets\+\_\+vehicles\+::\+EV}}, \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00580}{is\+\_\+rdv\+\_\+previously\+\_\+granted\+\_\+access()}}, \mbox{\hyperlink{namespacestreets__vehicles_a41f5c896d8020c141aa96235cf1405acab08ef04fe84cf4f6645fef073717f36f}{streets\+\_\+vehicles\+::\+RDV}}, \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00567}{remove\+\_\+rdv\+\_\+previously\+\_\+granted\+\_\+access()}}, \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00117}{schedule\+\_\+dvs()}}, \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00230}{schedule\+\_\+evs()}}, and \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00171}{schedule\+\_\+rdvs()}}.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a930961b3e285b2a2d08f4276ffa22658_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a37514ae17d938eff80b44304ab81cdda}\label{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a37514ae17d938eff80b44304ab81cdda}} 
\index{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}!set\_entering\_time\_buffer@{set\_entering\_time\_buffer}}
\index{set\_entering\_time\_buffer@{set\_entering\_time\_buffer}!streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}}
\doxysubsubsection{\texorpdfstring{set\_entering\_time\_buffer()}{set\_entering\_time\_buffer()}}
{\footnotesize\ttfamily void streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+scheduler\+::set\+\_\+entering\+\_\+time\+\_\+buffer (\begin{DoxyParamCaption}\item[{const uint64\+\_\+t}]{buffer }\end{DoxyParamCaption})}



Set the entering time buffer (ms). This value is used to account for the time it takes a vehicle stopped before the stop bar at an entry lane to exit the entry lane and enter the link lane once given access. 


\begin{DoxyParams}{Parameters}
{\em buffer} & entering time buff in milliseconds. \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a4b4afb653bc02a75e3c113806c9f4004}\label{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a4b4afb653bc02a75e3c113806c9f4004}} 
\index{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}!set\_flexibility\_limit@{set\_flexibility\_limit}}
\index{set\_flexibility\_limit@{set\_flexibility\_limit}!streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}}
\doxysubsubsection{\texorpdfstring{set\_flexibility\_limit()}{set\_flexibility\_limit()}}
{\footnotesize\ttfamily void streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+scheduler\+::set\+\_\+flexibility\+\_\+limit (\begin{DoxyParamCaption}\item[{const int}]{limit }\end{DoxyParamCaption})}



Set the flexibility limit. This limit controls how much departure position can change for any given vehicle between successive intersection schedule calculations. Each subsequent intersection scheduling calculation may have a slightly different departure order. This value controls how much this departure order can change.\+A value of 1 represents that vehicles departure position can change by one between two intersection schedules. 


\begin{DoxyParams}{Parameters}
{\em limit} & How much can departure position change between schedules for any vehicle. \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00005}{5}} of file \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source}{all\+\_\+stop\+\_\+vehicle\+\_\+scheduler.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00005                                                                             \{}
\DoxyCodeLine{00006         \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a004c41012f860faa9634e42c7d5740f7}{flexibility\_limit}} = limit;}
\DoxyCodeLine{00007     \}}

\end{DoxyCode}


References \mbox{\hyperlink{all__stop__vehicle__scheduler_8h_source_l00036}{flexibility\+\_\+limit}}.



\doxysubsection{Member Data Documentation}
\mbox{\Hypertarget{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a13124a205e1c6615f6a137c507b2a4eb}\label{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a13124a205e1c6615f6a137c507b2a4eb}} 
\index{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}!entering\_time\_buffer@{entering\_time\_buffer}}
\index{entering\_time\_buffer@{entering\_time\_buffer}!streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}}
\doxysubsubsection{\texorpdfstring{entering\_time\_buffer}{entering\_time\_buffer}}
{\footnotesize\ttfamily uint64\+\_\+t streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+scheduler\+::entering\+\_\+time\+\_\+buffer = 0\hspace{0.3cm}{\ttfamily [private]}}



Configurable time buffer in milliseconds for estimating the time it takes a vehicle to leave its entry lane and enter the intersection box once granted access to the intersection. 



Definition at line \mbox{\hyperlink{all__stop__vehicle__scheduler_8h_source_l00032}{32}} of file \mbox{\hyperlink{all__stop__vehicle__scheduler_8h_source}{all\+\_\+stop\+\_\+vehicle\+\_\+scheduler.\+h}}.



Referenced by \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00230}{schedule\+\_\+evs()}}.

\mbox{\Hypertarget{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a004c41012f860faa9634e42c7d5740f7}\label{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a004c41012f860faa9634e42c7d5740f7}} 
\index{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}!flexibility\_limit@{flexibility\_limit}}
\index{flexibility\_limit@{flexibility\_limit}!streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}}
\doxysubsubsection{\texorpdfstring{flexibility\_limit}{flexibility\_limit}}
{\footnotesize\ttfamily int streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+scheduler\+::flexibility\+\_\+limit = 5\hspace{0.3cm}{\ttfamily [private]}}



Limits how much departure position for a given vehicle can change from current reported departure position. 



Definition at line \mbox{\hyperlink{all__stop__vehicle__scheduler_8h_source_l00036}{36}} of file \mbox{\hyperlink{all__stop__vehicle__scheduler_8h_source}{all\+\_\+stop\+\_\+vehicle\+\_\+scheduler.\+h}}.



Referenced by \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00432}{consider\+\_\+departure\+\_\+position\+\_\+permutation()}}, and \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00005}{set\+\_\+flexibility\+\_\+limit()}}.

\mbox{\Hypertarget{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a77c53828e29e53a9a7ff752afb65b549}\label{classstreets__vehicle__scheduler_1_1all__stop__vehicle__scheduler_a77c53828e29e53a9a7ff752afb65b549}} 
\index{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}!rdvs\_previously\_granted\_access@{rdvs\_previously\_granted\_access}}
\index{rdvs\_previously\_granted\_access@{rdvs\_previously\_granted\_access}!streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler@{streets\_vehicle\_scheduler::all\_stop\_vehicle\_scheduler}}
\doxysubsubsection{\texorpdfstring{rdvs\_previously\_granted\_access}{rdvs\_previously\_granted\_access}}
{\footnotesize\ttfamily std\+::list$<$\mbox{\hyperlink{structstreets__vehicles_1_1vehicle}{streets\+\_\+vehicles\+::vehicle}}$>$ streets\+\_\+vehicle\+\_\+scheduler\+::all\+\_\+stop\+\_\+vehicle\+\_\+scheduler\+::rdvs\+\_\+previously\+\_\+granted\+\_\+access\hspace{0.3cm}{\ttfamily [private]}}



A list of RDV vehicles granted access by the \mbox{\hyperlink{classstreets__vehicle__scheduler_1_1vehicle__scheduler}{vehicle\+\_\+scheduler}}, who\textquotesingle{}s updates do not yet reflect they have received access (still considered RDV by all\+\_\+stop\+\_\+status\+\_\+intent\+\_\+processor). We maintain this list to ensure we do not grant conflicting vehicles access to the intersection simultaneously in back to back scheduling calculations where the first RDV granted access in the first schedule has not yet provided a vehicle update the reflects this access by the time we calculate the second schedule. 



Definition at line \mbox{\hyperlink{all__stop__vehicle__scheduler_8h_source_l00027}{27}} of file \mbox{\hyperlink{all__stop__vehicle__scheduler_8h_source}{all\+\_\+stop\+\_\+vehicle\+\_\+scheduler.\+h}}.



Referenced by \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00580}{is\+\_\+rdv\+\_\+previously\+\_\+granted\+\_\+access()}}, \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00567}{remove\+\_\+rdv\+\_\+previously\+\_\+granted\+\_\+access()}}, and \mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp_source_l00171}{schedule\+\_\+rdvs()}}.



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
streets\+\_\+utils/streets\+\_\+vehicle\+\_\+scheduler/include/\mbox{\hyperlink{all__stop__vehicle__scheduler_8h}{all\+\_\+stop\+\_\+vehicle\+\_\+scheduler.\+h}}\item 
streets\+\_\+utils/streets\+\_\+vehicle\+\_\+scheduler/src/\mbox{\hyperlink{all__stop__vehicle__scheduler_8cpp}{all\+\_\+stop\+\_\+vehicle\+\_\+scheduler.\+cpp}}\end{DoxyCompactItemize}
